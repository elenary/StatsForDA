<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>14 Введение в анализ данных в R | Статистика для анализа данных</title>
  <meta name="description" content="Семинарские занятия по статистике для анализа данных" />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="14 Введение в анализ данных в R | Статистика для анализа данных" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Семинарские занятия по статистике для анализа данных" />
  <meta name="github-repo" content="elenary/StatsForDA" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="14 Введение в анализ данных в R | Статистика для анализа данных" />
  
  <meta name="twitter:description" content="Семинарские занятия по статистике для анализа данных" />
  

<meta name="author" content="Елена Рыбина" />


<meta name="date" content="2024-01-30" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="cluster_analysis.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Статистика для анализа данных</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Статистика и ее место в жизни</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#вероятности-формулировки-и-выводы"><i class="fa fa-check"></i><b>1.1</b> Вероятности, формулировки и выводы</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#определение-статистики"><i class="fa fa-check"></i><b>1.2</b> Определение статистики</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#применение-статистики"><i class="fa fa-check"></i><b>1.2.1</b> Применение статистики</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#виды-статистики"><i class="fa fa-check"></i><b>1.3</b> Виды статистики</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="sample.html"><a href="sample.html"><i class="fa fa-check"></i><b>2</b> Выборка</a>
<ul>
<li class="chapter" data-level="2.1" data-path="sample.html"><a href="sample.html#выборочные-оценки"><i class="fa fa-check"></i><b>2.1</b> Выборочные оценки</a></li>
<li class="chapter" data-level="2.2" data-path="sample.html"><a href="sample.html#репрезентативность-выборки"><i class="fa fa-check"></i><b>2.2</b> Репрезентативность выборки</a></li>
<li class="chapter" data-level="2.3" data-path="sample.html"><a href="sample.html#dependent_samples"><i class="fa fa-check"></i><b>2.3</b> Зависимые и независимые выборки</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="scales.html"><a href="scales.html"><i class="fa fa-check"></i><b>3</b> Данные и типы шкал</a>
<ul>
<li class="chapter" data-level="3.1" data-path="scales.html"><a href="scales.html#измерение-и-переменная"><i class="fa fa-check"></i><b>3.1</b> Измерение и переменная</a></li>
<li class="chapter" data-level="3.2" data-path="scales.html"><a href="scales.html#количественные-и-неколичественные-данные"><i class="fa fa-check"></i><b>3.2</b> Количественные и неколичественные данные</a></li>
<li class="chapter" data-level="3.3" data-path="scales.html"><a href="scales.html#типы-шкал"><i class="fa fa-check"></i><b>3.3</b> Типы шкал</a></li>
<li class="chapter" data-level="3.4" data-path="scales.html"><a href="scales.html#непрерывные-и-дискретные-данные"><i class="fa fa-check"></i><b>3.4</b> Непрерывные и дискретные данные</a></li>
<li class="chapter" data-level="3.5" data-path="scales.html"><a href="scales.html#как-определить-в-какой-шкале-данные"><i class="fa fa-check"></i><b>3.5</b> Как определить, в какой шкале данные?</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="probability.html"><a href="probability.html"><i class="fa fa-check"></i><b>4</b> Вероятность и случайные величины</a>
<ul>
<li class="chapter" data-level="4.1" data-path="probability.html"><a href="probability.html#random-variable"><i class="fa fa-check"></i><b>4.1</b> Случайная величина</a></li>
<li class="chapter" data-level="4.2" data-path="probability.html"><a href="probability.html#вероятность"><i class="fa fa-check"></i><b>4.2</b> Вероятность</a></li>
<li class="chapter" data-level="4.3" data-path="probability.html"><a href="probability.html#дискретные-св-и-статистическое-определение-вероятности"><i class="fa fa-check"></i><b>4.3</b> Дискретные СВ и статистическое определение вероятности</a></li>
<li class="chapter" data-level="4.4" data-path="probability.html"><a href="probability.html#barplot"><i class="fa fa-check"></i><b>4.4</b> Столбчатая диаграмма (barplot)</a></li>
<li class="chapter" data-level="4.5" data-path="probability.html"><a href="probability.html#непрерывные-св-и-геометрическое-определение-вероятности"><i class="fa fa-check"></i><b>4.5</b> Непрерывные СВ и геометрическое определение вероятности</a></li>
<li class="chapter" data-level="4.6" data-path="probability.html"><a href="probability.html#histogram"><i class="fa fa-check"></i><b>4.6</b> Гистограмма (histogram)</a></li>
<li class="chapter" data-level="4.7" data-path="probability.html"><a href="probability.html#densityplot"><i class="fa fa-check"></i><b>4.7</b> график плотности вероятности (density plot)</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="distributions.html"><a href="distributions.html"><i class="fa fa-check"></i><b>5</b> Распределения</a>
<ul>
<li class="chapter" data-level="5.1" data-path="distributions.html"><a href="distributions.html#виды-распределений"><i class="fa fa-check"></i><b>5.1</b> Виды распределений</a></li>
<li class="chapter" data-level="5.2" data-path="distributions.html"><a href="distributions.html#функции-распределения"><i class="fa fa-check"></i><b>5.2</b> Функции распределения</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="descriptives.html"><a href="descriptives.html"><i class="fa fa-check"></i><b>6</b> Описательная статистика</a>
<ul>
<li class="chapter" data-level="6.1" data-path="descriptives.html"><a href="descriptives.html#descriptive_vis"><i class="fa fa-check"></i><b>6.1</b> Описательные визуализации</a></li>
<li class="chapter" data-level="6.2" data-path="descriptives.html"><a href="descriptives.html#ctm"><i class="fa fa-check"></i><b>6.2</b> Меры центральной тенденции</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="descriptives.html"><a href="descriptives.html#среднее-медиана-мода"><i class="fa fa-check"></i><b>6.2.1</b> Среднее, медиана, мода</a></li>
<li class="chapter" data-level="6.2.2" data-path="descriptives.html"><a href="descriptives.html#особенности-использования"><i class="fa fa-check"></i><b>6.2.2</b> Особенности использования</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="descriptives.html"><a href="descriptives.html#квантили-квартили-и-перцентили"><i class="fa fa-check"></i><b>6.3</b> Квантили, квартили и перцентили</a></li>
<li class="chapter" data-level="6.4" data-path="descriptives.html"><a href="descriptives.html#varm"><i class="fa fa-check"></i><b>6.4</b> Меры вариативности (изменчивости)</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="descriptives.html"><a href="descriptives.html#размах-стандартное-отклонение-и-дисперсия"><i class="fa fa-check"></i><b>6.4.1</b> Размах, стандартное отклонение и дисперсия</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="descriptives.html"><a href="descriptives.html#боксплот-и-вайолинплот"><i class="fa fa-check"></i><b>6.5</b> Боксплот и вайолинплот</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="normdist.html"><a href="normdist.html"><i class="fa fa-check"></i><b>7</b> Нормальное распределение и стандартизация</a>
<ul>
<li class="chapter" data-level="7.1" data-path="normdist.html"><a href="normdist.html#нормальное-распределение-и-его-свойства"><i class="fa fa-check"></i><b>7.1</b> Нормальное распределение и его свойства</a></li>
<li class="chapter" data-level="7.2" data-path="normdist.html"><a href="normdist.html#стандартное-нормальное-распределение-z-распределение"><i class="fa fa-check"></i><b>7.2</b> Стандартное нормальное распределение (z-распределение)</a></li>
<li class="chapter" data-level="7.3" data-path="normdist.html"><a href="normdist.html#z-преобразование-и-стандартизация"><i class="fa fa-check"></i><b>7.3</b> Z-преобразование и стандартизация</a></li>
<li class="chapter" data-level="7.4" data-path="normdist.html"><a href="normdist.html#clt"><i class="fa fa-check"></i><b>7.4</b> Центральная предельная теорема</a></li>
<li class="chapter" data-level="7.5" data-path="normdist.html"><a href="normdist.html#ci"><i class="fa fa-check"></i><b>7.5</b> Доверительный интервал</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="inference.html"><a href="inference.html"><i class="fa fa-check"></i><b>8</b> Статистический вывод</a>
<ul>
<li class="chapter" data-level="8.1" data-path="inference.html"><a href="inference.html#идея-статистического-вывода"><i class="fa fa-check"></i><b>8.1</b> Идея статистического вывода</a></li>
<li class="chapter" data-level="8.2" data-path="inference.html"><a href="inference.html#nhst"><i class="fa fa-check"></i><b>8.2</b> NHST: алгоритм проверки гипотезы и анализа данных</a></li>
<li class="chapter" data-level="8.3" data-path="inference.html"><a href="inference.html#эмпирические-гипотезы-и-переменные"><i class="fa fa-check"></i><b>8.3</b> Эмпирические гипотезы и переменные</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="inference.html"><a href="inference.html#variables"><i class="fa fa-check"></i><b>8.3.1</b> Зависимые и независимые переменные</a></li>
<li class="chapter" data-level="8.3.2" data-path="inference.html"><a href="inference.html#уровни-нп-в-категориальных-переменных"><i class="fa fa-check"></i><b>8.3.2</b> Уровни НП в категориальных переменных</a></li>
<li class="chapter" data-level="8.3.3" data-path="inference.html"><a href="inference.html#relationship"><i class="fa fa-check"></i><b>8.3.3</b> Связь между ЗП и НП</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="inference.html"><a href="inference.html#нулевая-и-альтернативные-статистические-гипотезы"><i class="fa fa-check"></i><b>8.4</b> Нулевая и альтернативные статистические гипотезы</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="inference.html"><a href="inference.html#направленные-и-ненаправленные-гипотезы"><i class="fa fa-check"></i><b>8.4.1</b> Направленные и ненаправленные гипотезы</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="inference.html"><a href="inference.html#уровень-значимости-и-статистическая-мощность"><i class="fa fa-check"></i><b>8.5</b> Уровень значимости и статистическая мощность</a></li>
<li class="chapter" data-level="8.6" data-path="inference.html"><a href="inference.html#выбор-статистического-критерия"><i class="fa fa-check"></i><b>8.6</b> Выбор статистического критерия</a></li>
<li class="chapter" data-level="8.7" data-path="inference.html"><a href="inference.html#sample_size"><i class="fa fa-check"></i><b>8.7</b> Размер выборки и размер эффекта</a></li>
<li class="chapter" data-level="8.8" data-path="inference.html"><a href="inference.html#stat_test_example"><i class="fa fa-check"></i><b>8.8</b> Расчет статического критерия и проверка значимости</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="stats_criteria.html"><a href="stats_criteria.html"><i class="fa fa-check"></i><b>9</b> Статистические критерии</a>
<ul>
<li class="chapter" data-level="9.1" data-path="stats_criteria.html"><a href="stats_criteria.html#степени-свободы"><i class="fa fa-check"></i><b>9.1</b> Степени свободы</a></li>
<li class="chapter" data-level="9.2" data-path="stats_criteria.html"><a href="stats_criteria.html#ключевые-распределения-и-статистики-критериев-z-t-f"><i class="fa fa-check"></i><b>9.2</b> Ключевые распределения и статистики критериев (Z, T, F)</a></li>
<li class="chapter" data-level="9.3" data-path="stats_criteria.html"><a href="stats_criteria.html#выбор-статистического-критерия-1"><i class="fa fa-check"></i><b>9.3</b> Выбор статистического критерия</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="stats_criteria.html"><a href="stats_criteria.html#param_nonparam"><i class="fa fa-check"></i><b>9.3.1</b> Параметрические и непараметрические критерии</a></li>
<li class="chapter" data-level="9.3.2" data-path="stats_criteria.html"><a href="stats_criteria.html#зависимые-и-независимые-выборки"><i class="fa fa-check"></i><b>9.3.2</b> Зависимые и независимые выборки</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="stats_criteria_ttest_anova.html"><a href="stats_criteria_ttest_anova.html"><i class="fa fa-check"></i><b>10</b> Сравнение средних по группам</a>
<ul>
<li class="chapter" data-level="10.1" data-path="stats_criteria_ttest_anova.html"><a href="stats_criteria_ttest_anova.html#ttest"><i class="fa fa-check"></i><b>10.1</b> T-тест</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="stats_criteria_ttest_anova.html"><a href="stats_criteria_ttest_anova.html#допущения-для-т-теста"><i class="fa fa-check"></i><b>10.1.1</b> Допущения для т-теста</a></li>
<li class="chapter" data-level="10.1.2" data-path="stats_criteria_ttest_anova.html"><a href="stats_criteria_ttest_anova.html#непараметрические-аналоги"><i class="fa fa-check"></i><b>10.1.2</b> Непараметрические аналоги</a></li>
<li class="chapter" data-level="10.1.3" data-path="stats_criteria_ttest_anova.html"><a href="stats_criteria_ttest_anova.html#независимые-и-парные-тесты"><i class="fa fa-check"></i><b>10.1.3</b> Независимые и парные тесты</a></li>
<li class="chapter" data-level="10.1.4" data-path="stats_criteria_ttest_anova.html"><a href="stats_criteria_ttest_anova.html#вычисление-т-теста-и-непараметрических-аналогов"><i class="fa fa-check"></i><b>10.1.4</b> Вычисление т-теста и непараметрических аналогов</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="stats_criteria_ttest_anova.html"><a href="stats_criteria_ttest_anova.html#anova"><i class="fa fa-check"></i><b>10.2</b> ANOVA (дисперсионный анализ)</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="stats_criteria_ttest_anova.html"><a href="stats_criteria_ttest_anova.html#levels"><i class="fa fa-check"></i><b>10.2.1</b> Факторы и уровни</a></li>
<li class="chapter" data-level="10.2.2" data-path="stats_criteria_ttest_anova.html"><a href="stats_criteria_ttest_anova.html#почему-он-дисперсионный"><i class="fa fa-check"></i><b>10.2.2</b> Почему он дисперсионный</a></li>
<li class="chapter" data-level="10.2.3" data-path="stats_criteria_ttest_anova.html"><a href="stats_criteria_ttest_anova.html#f-распределение-фишера"><i class="fa fa-check"></i><b>10.2.3</b> F-распределение (Фишера)</a></li>
<li class="chapter" data-level="10.2.4" data-path="stats_criteria_ttest_anova.html"><a href="stats_criteria_ttest_anova.html#допущения-для-anova"><i class="fa fa-check"></i><b>10.2.4</b> Допущения для ANOVA</a></li>
<li class="chapter" data-level="10.2.5" data-path="stats_criteria_ttest_anova.html"><a href="stats_criteria_ttest_anova.html#непараметрические-аналоги-1"><i class="fa fa-check"></i><b>10.2.5</b> Непараметрические аналоги</a></li>
<li class="chapter" data-level="10.2.6" data-path="stats_criteria_ttest_anova.html"><a href="stats_criteria_ttest_anova.html#просто-anova-и-с-повторными-измерениями"><i class="fa fa-check"></i><b>10.2.6</b> Просто ANOVA и с повторными измерениями</a></li>
<li class="chapter" data-level="10.2.7" data-path="stats_criteria_ttest_anova.html"><a href="stats_criteria_ttest_anova.html#нелинейные-эффекты"><i class="fa fa-check"></i><b>10.2.7</b> Нелинейные эффекты</a></li>
<li class="chapter" data-level="10.2.8" data-path="stats_criteria_ttest_anova.html"><a href="stats_criteria_ttest_anova.html#multiple_anova"><i class="fa fa-check"></i><b>10.2.8</b> Многофакторый ANOVA и взаимодействие факторов</a></li>
<li class="chapter" data-level="10.2.9" data-path="stats_criteria_ttest_anova.html"><a href="stats_criteria_ttest_anova.html#пост-хоки-и-множественные-сравнения"><i class="fa fa-check"></i><b>10.2.9</b> Пост-хоки и множественные сравнения</a></li>
<li class="chapter" data-level="10.2.10" data-path="stats_criteria_ttest_anova.html"><a href="stats_criteria_ttest_anova.html#вычисление-anova-и-непараметрических-аналогов"><i class="fa fa-check"></i><b>10.2.10</b> Вычисление ANOVA и непараметрических аналогов</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="stats_criteria_linear.html"><a href="stats_criteria_linear.html"><i class="fa fa-check"></i><b>11</b> Проверка линейной свзяи</a>
<ul>
<li class="chapter" data-level="11.1" data-path="stats_criteria_linear.html"><a href="stats_criteria_linear.html#corr_test"><i class="fa fa-check"></i><b>11.1</b> Корреляционный анализ</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="stats_criteria_linear.html"><a href="stats_criteria_linear.html#корреляционный-тест"><i class="fa fa-check"></i><b>11.1.1</b> Корреляционный тест</a></li>
<li class="chapter" data-level="11.1.2" data-path="stats_criteria_linear.html"><a href="stats_criteria_linear.html#допущения-для-корреляционного-теста"><i class="fa fa-check"></i><b>11.1.2</b> Допущения для корреляционного теста</a></li>
<li class="chapter" data-level="11.1.3" data-path="stats_criteria_linear.html"><a href="stats_criteria_linear.html#непараметрические-аналоги-2"><i class="fa fa-check"></i><b>11.1.3</b> Непараметрические аналоги</a></li>
<li class="chapter" data-level="11.1.4" data-path="stats_criteria_linear.html"><a href="stats_criteria_linear.html#расчет-корреляционного-теста"><i class="fa fa-check"></i><b>11.1.4</b> Расчет корреляционного теста</a></li>
<li class="chapter" data-level="11.1.5" data-path="stats_criteria_linear.html"><a href="stats_criteria_linear.html#интерпретация-результатов"><i class="fa fa-check"></i><b>11.1.5</b> Интерпретация результатов</a></li>
<li class="chapter" data-level="11.1.6" data-path="stats_criteria_linear.html"><a href="stats_criteria_linear.html#корреляционные-матрицы"><i class="fa fa-check"></i><b>11.1.6</b> Корреляционные матрицы</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="stats_criteria_linear.html"><a href="stats_criteria_linear.html#linreg"><i class="fa fa-check"></i><b>11.2</b> Линейный регрессионный анализ</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="stats_criteria_linear.html"><a href="stats_criteria_linear.html#linreg_coef"><i class="fa fa-check"></i><b>11.2.1</b> Коэффициенты регрессии</a></li>
<li class="chapter" data-level="11.2.2" data-path="stats_criteria_linear.html"><a href="stats_criteria_linear.html#rsquared"><i class="fa fa-check"></i><b>11.2.2</b> Коэффициент детерминации и доля объясненной изменчивости</a></li>
<li class="chapter" data-level="11.2.3" data-path="stats_criteria_linear.html"><a href="stats_criteria_linear.html#linreg_null"><i class="fa fa-check"></i><b>11.2.3</b> Регрессионный анализ (тестирование коэффициентов регрессии)</a></li>
<li class="chapter" data-level="11.2.4" data-path="stats_criteria_linear.html"><a href="stats_criteria_linear.html#множественный-регрессионный-анализ"><i class="fa fa-check"></i><b>11.2.4</b> Множественный регрессионный анализ</a></li>
<li class="chapter" data-level="11.2.5" data-path="stats_criteria_linear.html"><a href="stats_criteria_linear.html#assumptions_linreg"><i class="fa fa-check"></i><b>11.2.5</b> Допущения для регрессионного анализа</a></li>
<li class="chapter" data-level="11.2.6" data-path="stats_criteria_linear.html"><a href="stats_criteria_linear.html#linreg_example"><i class="fa fa-check"></i><b>11.2.6</b> Расчет регрессионного анализа</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="stats_criteria_categ.html"><a href="stats_criteria_categ.html"><i class="fa fa-check"></i><b>12</b> Анализ категориальных данных</a>
<ul>
<li class="chapter" data-level="12.1" data-path="stats_criteria_categ.html"><a href="stats_criteria_categ.html#logreg"><i class="fa fa-check"></i><b>12.1</b> Логистическая регрессия</a></li>
<li class="chapter" data-level="12.2" data-path="stats_criteria_categ.html"><a href="stats_criteria_categ.html#хи-квадрат"><i class="fa fa-check"></i><b>12.2</b> Хи-квадрат</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="cluster_analysis.html"><a href="cluster_analysis.html"><i class="fa fa-check"></i><b>13</b> Кластерный анализ</a></li>
<li class="chapter" data-level="14" data-path="R_analysis.html"><a href="R_analysis.html"><i class="fa fa-check"></i><b>14</b> Введение в анализ данных в R</a>
<ul>
<li class="chapter" data-level="14.1" data-path="R_analysis.html"><a href="R_analysis.html#данные-и-переменные"><i class="fa fa-check"></i><b>14.1</b> Данные и переменные</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="R_analysis.html"><a href="R_analysis.html#data_types"><i class="fa fa-check"></i><b>14.1.1</b> Основные типы данных</a></li>
<li class="chapter" data-level="14.1.2" data-path="R_analysis.html"><a href="R_analysis.html#data_structures"><i class="fa fa-check"></i><b>14.1.2</b> Основные структуры данных</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="R_analysis.html"><a href="R_analysis.html#operarions"><i class="fa fa-check"></i><b>14.2</b> Операции с переменными и функции</a></li>
<li class="chapter" data-level="14.3" data-path="R_analysis.html"><a href="R_analysis.html#начало-работы-в-среде"><i class="fa fa-check"></i><b>14.3</b> Начало работы в среде</a></li>
<li class="chapter" data-level="14.4" data-path="R_analysis.html"><a href="R_analysis.html#начало-работы-с-данными"><i class="fa fa-check"></i><b>14.4</b> Начало работы с данными</a></li>
<li class="chapter" data-level="14.5" data-path="R_analysis.html"><a href="R_analysis.html#tasks_sem2"><i class="fa fa-check"></i><b>14.5</b> Задания после семинара 2</a></li>
<li class="chapter" data-level="14.6" data-path="R_analysis.html"><a href="R_analysis.html#preprocessing"><i class="fa fa-check"></i><b>14.6</b> Предобработка данных</a>
<ul>
<li class="chapter" data-level="14.6.1" data-path="R_analysis.html"><a href="R_analysis.html#columns"><i class="fa fa-check"></i><b>14.6.1</b> Отбор колонок</a></li>
<li class="chapter" data-level="14.6.2" data-path="R_analysis.html"><a href="R_analysis.html#filter"><i class="fa fa-check"></i><b>14.6.2</b> Фильтрация (отбор строк)</a></li>
<li class="chapter" data-level="14.6.3" data-path="R_analysis.html"><a href="R_analysis.html#mutate"><i class="fa fa-check"></i><b>14.6.3</b> Создание колонок</a></li>
<li class="chapter" data-level="14.6.4" data-path="R_analysis.html"><a href="R_analysis.html#NA"><i class="fa fa-check"></i><b>14.6.4</b> Работа с пропущенными значениями (NA)</a></li>
<li class="chapter" data-level="14.6.5" data-path="R_analysis.html"><a href="R_analysis.html#sorting"><i class="fa fa-check"></i><b>14.6.5</b> Сортировка</a></li>
</ul></li>
<li class="chapter" data-level="14.7" data-path="R_analysis.html"><a href="R_analysis.html#tasks_sem3"><i class="fa fa-check"></i><b>14.7</b> Задания после семинара 3</a></li>
<li class="chapter" data-level="14.8" data-path="R_analysis.html"><a href="R_analysis.html#descriptives_r"><i class="fa fa-check"></i><b>14.8</b> Описательные статистики и агрегация</a>
<ul>
<li class="chapter" data-level="14.8.1" data-path="R_analysis.html"><a href="R_analysis.html#описательные-статистики"><i class="fa fa-check"></i><b>14.8.1</b> Описательные статистики</a></li>
<li class="chapter" data-level="14.8.2" data-path="R_analysis.html"><a href="R_analysis.html#aggregate"><i class="fa fa-check"></i><b>14.8.2</b> Агрегация данных</a></li>
</ul></li>
<li class="chapter" data-level="14.9" data-path="R_analysis.html"><a href="R_analysis.html#visualization"><i class="fa fa-check"></i><b>14.9</b> Визуализации</a></li>
<li class="chapter" data-level="14.10" data-path="R_analysis.html"><a href="R_analysis.html#tasks_sem4"><i class="fa fa-check"></i><b>14.10</b> Задания после семинара 4</a></li>
<li class="chapter" data-level="14.11" data-path="R_analysis.html"><a href="R_analysis.html#проверка-гипотез"><i class="fa fa-check"></i><b>14.11</b> Проверка гипотез</a>
<ul>
<li class="chapter" data-level="14.11.1" data-path="R_analysis.html"><a href="R_analysis.html#корреляционный-тест-1"><i class="fa fa-check"></i><b>14.11.1</b> Корреляционный тест</a></li>
<li class="chapter" data-level="14.11.2" data-path="R_analysis.html"><a href="R_analysis.html#т-тест"><i class="fa fa-check"></i><b>14.11.2</b> Т-тест</a></li>
</ul></li>
<li class="chapter" data-level="14.12" data-path="R_analysis.html"><a href="R_analysis.html#tasks_sem5"><i class="fa fa-check"></i><b>14.12</b> Задания после семинара 5</a></li>
<li class="chapter" data-level="14.13" data-path="R_analysis.html"><a href="R_analysis.html#проверка-гипоте-2-anova-и-линейная-регрессия"><i class="fa fa-check"></i><b>14.13</b> Проверка гипоте-2: ANOVA и линейная регрессия</a>
<ul>
<li class="chapter" data-level="14.13.1" data-path="R_analysis.html"><a href="R_analysis.html#anova-дисперсионный-анализ"><i class="fa fa-check"></i><b>14.13.1</b> ANOVA (дисперсионный анализ)</a></li>
<li class="chapter" data-level="14.13.2" data-path="R_analysis.html"><a href="R_analysis.html#reshaping"><i class="fa fa-check"></i><b>14.13.2</b> Решейпинг</a></li>
</ul></li>
<li class="chapter" data-level="14.14" data-path="R_analysis.html"><a href="R_analysis.html#tasks_sem6"><i class="fa fa-check"></i><b>14.14</b> Задания после семинара 6</a></li>
<li class="chapter" data-level="14.15" data-path="R_analysis.html"><a href="R_analysis.html#lin_reg"><i class="fa fa-check"></i><b>14.15</b> Линейный регрессионный анализ</a>
<ul>
<li class="chapter" data-level="14.15.1" data-path="R_analysis.html"><a href="R_analysis.html#линейная-регрессия-с-одним-предиктором-фактором"><i class="fa fa-check"></i><b>14.15.1</b> Линейная регрессия с одним предиктором (фактором)</a></li>
<li class="chapter" data-level="14.15.2" data-path="R_analysis.html"><a href="R_analysis.html#линейная-регрессия-с-несколькими-предикторами-факторами"><i class="fa fa-check"></i><b>14.15.2</b> Линейная регрессия с несколькими предикторами (факторами)</a></li>
</ul></li>
<li class="chapter" data-level="14.16" data-path="R_analysis.html"><a href="R_analysis.html#tasks_sem7"><i class="fa fa-check"></i><b>14.16</b> Задания после семинара 7</a></li>
<li class="chapter" data-level="14.17" data-path="R_analysis.html"><a href="R_analysis.html#логистическая-регрессия"><i class="fa fa-check"></i><b>14.17</b> Логистическая регрессия</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Статистика для анализа данных</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="R_analysis" class="section level1 hasAnchor" number="14">
<h1><span class="header-section-number">14</span> Введение в анализ данных в R<a href="R_analysis.html#R_analysis" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Эта книжка написана с помощью языка программирования и обработки данных R и пакета Bookdown в среде работы с данными RStudio.</p>
<p>Чтобы начать в ней работать, нужно скачать и установить сам язык R <a href="https://cran.r-project.org/" class="uri">https://cran.r-project.org/</a> и скачать и установить RStudio, среду для работы <a href="https://posit.co/downloads/" class="uri">https://posit.co/downloads/</a>.</p>
<div id="данные-и-переменные" class="section level2 hasAnchor" number="14.1">
<h2><span class="header-section-number">14.1</span> Данные и переменные<a href="R_analysis.html#данные-и-переменные" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Данные</strong> – это информация, представленная в форме, пригодной для хранения и обработки человеком или информационными системами (ISO/IEC/IEEE 24765-2010).
Если данные представлены в форме для обработки информационными системами, они формализованы.</p>
<p><strong>Переменная</strong> – это оболочка, которую мы задаем, чтобы хранить в ней данные и выполнять операции с ними.
У переменной есть <em>название</em> и те <em>данные</em>, которая она хранит.</p>
<p align="center">
<img src="docs/images/variable.png" width="80%" style="display: block; margin: auto;" />
</p>
<div id="data_types" class="section level3 hasAnchor" number="14.1.1">
<h3><span class="header-section-number">14.1.1</span> Основные типы данных<a href="R_analysis.html#data_types" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><strong>Числовой</strong> (целые числа – <strong>integer</strong> или <strong>numeric</strong>, вещественные числа – <strong>real</strong>, числа с плавающей точкой (дробные) – <strong>float</strong>)</li>
<li><strong>Текстовый</strong> (<strong>character</strong>, если один символ, или <strong>string</strong> – много символов)</li>
<li><strong>Логический</strong> (<strong>logical</strong> или <strong>boolean</strong> – принимает только значения True / False)</li>
<li><strong>NA</strong> – пропущенные значения (not available)</li>
<li><strong>NaN</strong> – not a number, результат выполнения невозможной числовой операции (например, деление на 0)</li>
</ul>
</div>
<div id="data_structures" class="section level3 hasAnchor" number="14.1.2">
<h3><span class="header-section-number">14.1.2</span> Основные структуры данных<a href="R_analysis.html#data_structures" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li><strong>Вектор (vector)</strong> – одномерный массив одного типа данных</li>
<li><strong>Массив (array)</strong> – многомерный массив одного типа данных, состоящий из векторов одной длины</li>
<li><strong>Матрица (matrix)</strong> – двумерный массив только числовых данных</li>
<li><strong>Список (list)</strong> – по сути, многомерный массив, но может состоять из векторов разной длины и иметь данные разных типв</li>
<li><strong>Данные, датафрейм (dataframe)</strong> – по сути, cписок, но все вектора одной длины</li>
</ul>
<p align="center">
<img src="docs/images/arrays.png" width="80%" style="display: block; margin: auto;" />
<a href="https://practicum.yandex.ru/blog/10-osnovnyh-struktur-dannyh/" class="uri">https://practicum.yandex.ru/blog/10-osnovnyh-struktur-dannyh/</a>
</p>
</div>
</div>
<div id="operarions" class="section level2 hasAnchor" number="14.2">
<h2><span class="header-section-number">14.2</span> Операции с переменными и функции<a href="R_analysis.html#operarions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>В зависимости от того, с переменными какого типа мы работаем, мы можем выполнять с ними разные операции.</p>
<p><strong>Операция</strong> – это выполнение каких-либо действий над данными. То, что выполняет это действие, называется <strong>оператором</strong> или <strong>функцией</strong>. Разница между ними в том, что оператор выполняет атомарные (единичные и простые действия), например, оператором может быть знак сложения, деления, больше или меньше и тд. Функция делает более сложные действия: например, создать вектор с помощью функции <code>c()</code>, прочитать данные с помощью функции <code>read_csv()</code>, отфильтровать данные с помощью функции <code>select()</code>. Обратите внимание, что при вызове функции после ее названия всегда ставятся круглые скобки.</p>
<table>
<colgroup>
<col width="19%" />
<col width="80%" />
</colgroup>
<thead>
<tr class="header">
<th align="center"><strong>Тип данных</strong></th>
<th align="center"><strong>Возможные атомарные операции</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Числовой</td>
<td align="center">= (присвоение), +, -, /, *, %</td>
</tr>
<tr class="even">
<td align="center">Текстовый</td>
<td align="center">= (присвоение),+ (конкатенация), поиск по определенному символу</td>
</tr>
<tr class="odd">
<td align="center">Логический</td>
<td align="center">= (присвоение),&gt;, &lt;, == (равно), != (не равно)</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="R_analysis.html#cb1-1" tabindex="-1"></a><span class="co"># создание векторов  -------------------------------------------------------</span></span>
<span id="cb1-2"><a href="R_analysis.html#cb1-2" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>) <span class="co"># c() -- это  функция, которая создает вектор, вне зависимости от типа данных</span></span></code></pre></div>
<pre><code>## [1] 1 2 3 4 5</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="R_analysis.html#cb3-1" tabindex="-1"></a><span class="co"># Числовые векторы  -------------------------------------------------------</span></span>
<span id="cb3-2"><a href="R_analysis.html#cb3-2" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">21</span>, <span class="dv">143</span>)</span></code></pre></div>
<pre><code>## [1]   1   2   3   4   5   7  21 143</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="R_analysis.html#cb5-1" tabindex="-1"></a>vector1 <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>) <span class="co"># vector1 -- название переменной, 1, 2, 3, 4, 5 -- аргументы функции с()</span></span>
<span id="cb5-2"><a href="R_analysis.html#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="R_analysis.html#cb5-3" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">18</span>, <span class="dv">22</span>, <span class="dv">25</span>, <span class="dv">20</span>, <span class="dv">21</span>)</span>
<span id="cb5-4"><a href="R_analysis.html#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="R_analysis.html#cb5-5" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span> <span class="co"># функция : создает числовой вектор от 1 до 10 только с шагом 1</span></span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="R_analysis.html#cb7-1" tabindex="-1"></a><span class="dv">10</span><span class="sc">:</span><span class="dv">1</span></span></code></pre></div>
<pre><code>##  [1] 10  9  8  7  6  5  4  3  2  1</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="R_analysis.html#cb9-1" tabindex="-1"></a><span class="fu">seq</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">2</span>) <span class="co"># функция seq() создает числовой вектор-перечисление значений от 2 до 10 с шагом 2 </span></span></code></pre></div>
<pre><code>## [1]  2  4  6  8 10</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="R_analysis.html#cb11-1" tabindex="-1"></a><span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">2</span>) <span class="co"># функция seq() создает числовой вектор-перечисление значений от 1 до 10 с шагом 2</span></span></code></pre></div>
<pre><code>## [1] 1 3 5 7 9</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="R_analysis.html#cb13-1" tabindex="-1"></a><span class="co"># Текстовые векторы -------------------------------------------------------</span></span>
<span id="cb13-2"><a href="R_analysis.html#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a href="R_analysis.html#cb13-3" tabindex="-1"></a>answers <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;нет&quot;</span>, <span class="st">&quot;да&quot;</span>, <span class="st">&quot;да&quot;</span>, <span class="st">&quot;да&quot;</span>, <span class="st">&quot;нет&quot;</span>)</span>
<span id="cb13-4"><a href="R_analysis.html#cb13-4" tabindex="-1"></a></span>
<span id="cb13-5"><a href="R_analysis.html#cb13-5" tabindex="-1"></a><span class="co">#пример приведения типов -- TRUE и FALSE превратились в 1 и 0</span></span>
<span id="cb13-6"><a href="R_analysis.html#cb13-6" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] 1 2 3 4 5 1 0</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="R_analysis.html#cb15-1" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="st">&quot;1&quot;</span>, <span class="st">&quot;0&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1&quot; &quot;2&quot; &quot;3&quot; &quot;4&quot; &quot;5&quot; &quot;1&quot; &quot;0&quot;</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="R_analysis.html#cb17-1" tabindex="-1"></a><span class="co"># Логические вектора и приведение типов ------------------------------------------------------</span></span>
<span id="cb17-2"><a href="R_analysis.html#cb17-2" tabindex="-1"></a></span>
<span id="cb17-3"><a href="R_analysis.html#cb17-3" tabindex="-1"></a>condition <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>) <span class="co">#логический вектор</span></span>
<span id="cb17-4"><a href="R_analysis.html#cb17-4" tabindex="-1"></a></span>
<span id="cb17-5"><a href="R_analysis.html#cb17-5" tabindex="-1"></a><span class="co">#примеры приведения типов, когда в векторе встречаются разные типы данных -- R приводит их к одному</span></span>
<span id="cb17-6"><a href="R_analysis.html#cb17-6" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## [1] 1 2 3 4 1 0</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="R_analysis.html#cb19-1" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>)</span></code></pre></div>
<pre><code>## [1] 1 2 3 4 5 6</code></pre>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="R_analysis.html#cb21-1" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">3</span>, <span class="sc">-</span><span class="dv">4</span>, <span class="st">&quot;зеленый&quot;</span>, <span class="st">&quot;карий&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;1&quot;       &quot;10&quot;      &quot;3&quot;       &quot;-4&quot;      &quot;зеленый&quot; &quot;карий&quot;</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="R_analysis.html#cb23-1" tabindex="-1"></a><span class="co"># Логические выражения ------------------------------------------------------</span></span>
<span id="cb23-2"><a href="R_analysis.html#cb23-2" tabindex="-1"></a></span>
<span id="cb23-3"><a href="R_analysis.html#cb23-3" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb23-4"><a href="R_analysis.html#cb23-4" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb23-5"><a href="R_analysis.html#cb23-5" tabindex="-1"></a></span>
<span id="cb23-6"><a href="R_analysis.html#cb23-6" tabindex="-1"></a>a <span class="sc">&gt;</span> b</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="R_analysis.html#cb25-1" tabindex="-1"></a>a <span class="sc">&gt;=</span> b</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="R_analysis.html#cb27-1" tabindex="-1"></a>a <span class="sc">==</span> b</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="R_analysis.html#cb29-1" tabindex="-1"></a>a <span class="sc">!=</span> b</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="R_analysis.html#cb31-1" tabindex="-1"></a>a <span class="sc">&lt;=</span> b</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="R_analysis.html#cb33-1" tabindex="-1"></a>a <span class="sc">&lt;</span> b</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="R_analysis.html#cb35-1" tabindex="-1"></a><span class="co">#функция, которая выполняет действия в зависимости от условия ...если ... то:</span></span>
<span id="cb35-2"><a href="R_analysis.html#cb35-2" tabindex="-1"></a><span class="co"># ifelse() содержит 3 аргумента: ( условие; что делать, если условие верно;</span></span>
<span id="cb35-3"><a href="R_analysis.html#cb35-3" tabindex="-1"></a><span class="co"># что делать, если условие ложно)</span></span>
<span id="cb35-4"><a href="R_analysis.html#cb35-4" tabindex="-1"></a></span>
<span id="cb35-5"><a href="R_analysis.html#cb35-5" tabindex="-1"></a><span class="fu">ifelse</span>(a <span class="sc">&lt;</span> b, a<span class="sc">+</span>b, <span class="st">&quot;а не меньше b&quot;</span>)</span></code></pre></div>
<pre><code>## [1] 15</code></pre>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="R_analysis.html#cb37-1" tabindex="-1"></a><span class="co"># датафрейм ---------------------------------------------------------------</span></span>
<span id="cb37-2"><a href="R_analysis.html#cb37-2" tabindex="-1"></a></span>
<span id="cb37-3"><a href="R_analysis.html#cb37-3" tabindex="-1"></a>eye_color <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;green&quot;</span>, <span class="st">&quot;brown&quot;</span>, <span class="st">&quot;grey&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;red&quot;</span>)</span>
<span id="cb37-4"><a href="R_analysis.html#cb37-4" tabindex="-1"></a>  </span>
<span id="cb37-5"><a href="R_analysis.html#cb37-5" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(vector1, age, answers, condition, eye_color) <span class="co">#функция data.frame() создает датафрейм (табличку с данными) из существующих векторов</span></span>
<span id="cb37-6"><a href="R_analysis.html#cb37-6" tabindex="-1"></a><span class="fu">View</span>(data) <span class="co"># функция View() открвает эту табличку в отдельной вкладке (то же, что и по клику иконки в окне Environment)</span></span>
<span id="cb37-7"><a href="R_analysis.html#cb37-7" tabindex="-1"></a></span>
<span id="cb37-8"><a href="R_analysis.html#cb37-8" tabindex="-1"></a>data<span class="sc">$</span>age <span class="co"># отбираем колонку из датафрейма: название_датафрейма$название_колонки</span></span></code></pre></div>
<pre><code>## [1] 18 22 25 20 21</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="R_analysis.html#cb39-1" tabindex="-1"></a><span class="co"># описательные визуализации</span></span>
<span id="cb39-2"><a href="R_analysis.html#cb39-2" tabindex="-1"></a><span class="fu">hist</span>(data<span class="sc">$</span>age, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">18</span>, <span class="dv">22</span>, <span class="dv">27</span>))</span>
<span id="cb39-3"><a href="R_analysis.html#cb39-3" tabindex="-1"></a><span class="fu">lines</span>(<span class="fu">density</span>(data<span class="sc">$</span>age)) <span class="co">#добавляет график плотности вероятности на гистограмму</span></span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="R_analysis.html#cb40-1" tabindex="-1"></a>?hist</span>
<span id="cb40-2"><a href="R_analysis.html#cb40-2" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(data<span class="sc">$</span>age))</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-4-2.png" width="672" /></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="R_analysis.html#cb41-1" tabindex="-1"></a><span class="co"># описательные статистики</span></span>
<span id="cb41-2"><a href="R_analysis.html#cb41-2" tabindex="-1"></a><span class="fu">mean</span>(data<span class="sc">$</span>age)</span></code></pre></div>
<pre><code>## [1] 21.2</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="R_analysis.html#cb43-1" tabindex="-1"></a><span class="fu">sd</span>(data<span class="sc">$</span>age)</span></code></pre></div>
<pre><code>## [1] 2.588436</code></pre>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="R_analysis.html#cb45-1" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">sd</span>(data<span class="sc">$</span>age),<span class="dv">1</span>) <span class="co">#округляет до 1 цифры после запятой</span></span></code></pre></div>
<pre><code>## [1] 2.6</code></pre>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="R_analysis.html#cb47-1" tabindex="-1"></a><span class="fu">min</span>(data<span class="sc">$</span>age)</span></code></pre></div>
<pre><code>## [1] 18</code></pre>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="R_analysis.html#cb49-1" tabindex="-1"></a><span class="fu">max</span>(data<span class="sc">$</span>age)</span></code></pre></div>
<pre><code>## [1] 25</code></pre>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="R_analysis.html#cb51-1" tabindex="-1"></a><span class="fu">range</span>(data<span class="sc">$</span>age)</span></code></pre></div>
<pre><code>## [1] 18 25</code></pre>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="R_analysis.html#cb53-1" tabindex="-1"></a><span class="fu">summary</span>(data<span class="sc">$</span>age)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    18.0    20.0    21.0    21.2    22.0    25.0</code></pre>
</div>
<div id="начало-работы-в-среде" class="section level2 hasAnchor" number="14.3">
<h2><span class="header-section-number">14.3</span> Начало работы в среде<a href="R_analysis.html#начало-работы-в-среде" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>В этом учебнике я буду приводить задания для тренировки в любой среде работы с данными и код работы с данными в R.</p>
<p>Для большинства интересных операций в R нам понадобятся дополнительные пакеты – набор функций, которые уже кто-то написал за нас (то же самое, как, например, <code>import numpy as np</code> в питоне). Нам в основном понадобится пакет <code>tidyverse</code>, дословно – “вселенная чистых данных`. Сразу скажу, что все помеченной символом # – это комментарии, наши подсказки, которые не будут исполняться. Их важно всего оставлять для себя, чтобы не забыть, что вообще здесь происходит.</p>
<p>Чтобы пакет заработал, его нужно 1. установить и 2. подключить</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="R_analysis.html#cb55-1" tabindex="-1"></a><span class="co"># устанавливаем пакет</span></span>
<span id="cb55-2"><a href="R_analysis.html#cb55-2" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tidyverse&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="R_analysis.html#cb56-1" tabindex="-1"></a><span class="co"># подключаем пакет</span></span>
<span id="cb56-2"><a href="R_analysis.html#cb56-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<p>Установить пакет достаточно всего один раз после установки R, подключать через <code>library</code> нужно всегда, когда открываем RStudio. Ошибка вида “could not find function” в 99% случаев говорит о том, что пакет, из которого она используется, не подключен.</p>
</div>
<div id="начало-работы-с-данными" class="section level2 hasAnchor" number="14.4">
<h2><span class="header-section-number">14.4</span> Начало работы с данными<a href="R_analysis.html#начало-работы-с-данными" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Мы будем работать с данными World Happiness Report за 2016 год <a href="https://www.kaggle.com/datasets/unsdsn/world-happiness" class="uri">https://www.kaggle.com/datasets/unsdsn/world-happiness</a>. Это Всемирный доклад о счастье <a href="https://en.wikipedia.org/wiki/World_Happiness_Report" class="uri">https://en.wikipedia.org/wiki/World_Happiness_Report</a> , которой показывает, как жители разных стран оценивают свой уровень счастья. Их можно скачать так же по ссылке <a href="https://raw.githubusercontent.com/elenary/StatsForDA/main/2016.csv" class="uri">https://raw.githubusercontent.com/elenary/StatsForDA/main/2016.csv</a> (правой кнопкой мыши в открывшемся файле - Сохранить как). В данных за 2016 год, с которыми мы будем работать, участвую 157 стран. <em>Кстати, вы можете скачать данные за разные года и посмотреть, как менялось количество стран-участниц? Чуть позже мы научимся делать это с помощью кода</em>. Здесь есть следующие переменные:</p>
<ul>
<li>Happiness Rank - позиция в рейтинге</li>
<li>Happiness Score - абсолютное значение, набранное по уровню счастья</li>
<li>SE - стандартная ошибка</li>
<li>Economy - ВВП на душу населения</li>
<li>Family - Социальная поддержка, ощущение семье</li>
<li>Health - Продолжительность жизни</li>
<li>Freedom - Свободы</li>
<li>Trust (Goverment Corruption) - воспринимаемый уровень коррупции</li>
<li>Generosity - сколько жертвуют на благотворительность</li>
<li>Dystopia - страна-антиутопия, где самые низкие показатели по всем парметрам из существующих</li>
</ul>
<p>Economy, Family, Health, Freedom, Trust, Generosity – 6 показателей, по которым считается уровень счастья.</p>
<p>Чтобы совершать операции с данными, их сначала нужно <em>прочитать</em>, загрузить в среду работы с данными. В современных традициях R это проще всего сделать с помощью функции <code>read_csv()</code> из пакета <code>tidyverse</code>. Не забывайте, что любой вызов функции сопровождается круглыми скобками, в которые передаются аргументы. В функции <code>read_csv()</code>в скобках нужно передать путь к файлу, который мы хотим прочитать.Его можно скопировать через свойства файла. Но чтобы не заморачиваться с путем, проще всего положить файл с данными в ту же папку, где и лежит наш сам файл с кодом (для этого его нужно сохранить). А самое элегентное и используемое решение – создать проект File - New Project, и хранить все файл в папке проекта, это уберагает от большого числа ошибок. Про импорт файлов очень подробно расписано у Ивана Позднякова <a href="https://pozdniakov.github.io/tidy_stats/030-import_data.html" class="uri">https://pozdniakov.github.io/tidy_stats/030-import_data.html</a></p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="R_analysis.html#cb57-1" tabindex="-1"></a>whr <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;2016.csv&quot;</span>) <span class="co"># читаем данные </span></span>
<span id="cb57-2"><a href="R_analysis.html#cb57-2" tabindex="-1"></a></span>
<span id="cb57-3"><a href="R_analysis.html#cb57-3" tabindex="-1"></a><span class="fu">View</span>(whr) <span class="co"># просматриваем, что получилось передать в объект с названием whr </span></span></code></pre></div>
<p>Теперь я хочу поизучать эти данные. Помните, с чего мы начинаем изучение данных? С <a href="descriptives">описательных статистик</a></p>
<p>Я могу отобрать все переменные по одной и посчитать для них среднее и стандартное отклонение – это то, что в Jamovi находится во вкладке Descriptives. Так как колонка существует не в вакууме, а внутри датасета, то нам необходимо как-то указать, что нас интересует конкретная колонка внутри конкретного датасета. Пока что проще всего это сделать – с помощью значка <code>$</code>:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="R_analysis.html#cb58-1" tabindex="-1"></a>whr<span class="sc">$</span>Family <span class="co"># отбираем всю колонку </span></span></code></pre></div>
<pre><code>##   [1] 1.16374 1.14524 1.18326 1.12690 1.13464 1.09610 1.02912 1.17278 1.10476
##  [10] 1.08764 0.99537 1.08383 1.04782 1.02152 1.08113 1.09774 1.03938 1.05249
##  [19] 1.16157 1.03999 0.71460 0.86758 1.08672 0.90587 0.98912 1.06612 1.00793
##  [28] 0.87114 1.03143 1.09879 1.02169 1.00508 1.04477 0.84829 0.92624 0.87964
##  [37] 1.12945 0.83309 0.87119 0.77866 0.87758 0.94397 0.98569 1.03302 1.08268
##  [46] 0.80975 0.88025 0.89521 1.16810 1.04167 0.85974 0.68655 1.06054 0.95544
##  [55] 0.83132 1.05261 1.04685 0.72194 0.83779 1.06411 1.04993 0.81826 1.05613
##  [64] 0.81255 1.03817 0.75695 0.95076 0.95025 0.70697 1.11111 0.72803 1.05163
##  [73] 0.96372 0.60809 0.87021 0.33613 0.66062 0.87717 0.87625 0.86216 0.76042
##  [82] 0.87877 0.79381 0.90836 0.95434 0.81329 0.64367 0.74173 0.99496 0.38595
##  [91] 0.93164 0.26135 0.64184 0.94367 0.78236 0.79117 0.75862 0.43165 0.75473
## [100] 0.75602 1.08983 0.54970 0.64498 0.75596 0.38857 0.63760 0.69699 0.71629
## [109] 0.50163 0.24749 0.62800 0.59205 0.70362 0.62542 0.37932 0.96053 0.84783
## [118] 0.29247 0.69981 0.49813 0.62477 0.76240 1.01413 0.49353 0.80676 0.19249
## [127] 0.47799 0.77416 0.92542 0.84142 0.71478 0.14700 0.81928 0.72368 0.86333
## [136] 0.29561 0.89186 0.60323 0.57576 0.53750 0.66366 0.60530 0.18519 0.63178
## [145] 0.63054 0.90981 0.47493 0.46115 0.77623 0.50353 0.31090 0.61586 0.10419
## [154] 0.11037 0.00000 0.14866 0.23442</code></pre>
<p>Или можем вспомнить, что датафрейм имеет два измерения, как и <a href="data_structures">двумерный массив</a>, и можем обратиться по индексу (в квадртных скобках): номер строки (первое число) и номер колонки (второе число). Если нас интересует не конкретная строка, а все строки, то на месте этого индекс ничего не ставится, как бы пропускаем его.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="R_analysis.html#cb60-1" tabindex="-1"></a>whr[,<span class="dv">8</span>] <span class="co"># отбираем всю колонку другим способом</span></span></code></pre></div>
<pre><code>## # A tibble: 157 × 1
##    Family
##     &lt;dbl&gt;
##  1   1.16
##  2   1.15
##  3   1.18
##  4   1.13
##  5   1.13
##  6   1.10
##  7   1.03
##  8   1.17
##  9   1.10
## 10   1.09
## # ℹ 147 more rows</code></pre>
<p>Обратите внимание на выдачу: как вы думаете, какым структурам данных принадлежат результаты первого и второго способа?</p>
<p>Посчитаем среднее и стандартное отклонение для этой колонки</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="R_analysis.html#cb62-1" tabindex="-1"></a><span class="fu">mean</span>(whr<span class="sc">$</span>Family) <span class="co"># среднее</span></span></code></pre></div>
<pre><code>## [1] 0.7936211</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="R_analysis.html#cb64-1" tabindex="-1"></a><span class="fu">sd</span>(whr<span class="sc">$</span>Family) <span class="co"># стандартное отклонение</span></span></code></pre></div>
<pre><code>## [1] 0.2667057</code></pre>
</div>
<div id="tasks_sem2" class="section level2 hasAnchor" number="14.5">
<h2><span class="header-section-number">14.5</span> Задания после семинара 2<a href="R_analysis.html#tasks_sem2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>Прочитайте в среде, в которой вы работаете, данные WHR за 2016 год (в R – используйте функцию <code>read_csv()</code> из пакета <code>tidyverse</code>).</li>
<li>Посчитайте среднее, стандартное отклонение, медиану и размах (разброс от максимального до минимального значения) по всем 6 показателям, составляющим уровень счастья (Economy, Family, Health, Freedom, Trust, Generosity). Что можно сказать про них? Где самый большой размах? Где среднее и медиана оказались близко друг к другу, а где не очень? <em>(для подсчета медианы и размаха в R нужно будет немножко поучиться гуглить или использовать другие материалы)</em></li>
<li>Постройте гистограмму и график плотности вероятности для всех 6 показателей, составляющим уровень счастья.</li>
</ol>
</div>
<div id="preprocessing" class="section level2 hasAnchor" number="14.6">
<h2><span class="header-section-number">14.6</span> Предобработка данных<a href="R_analysis.html#preprocessing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>После того, как мы считали данные данные в переменную (мы использовали функцию <code>read_csv()</code> для этого), часто нужно эти данные сначала <strong>предобработать</strong>. Во-первых, данные сами по себе могут быть не очень хорошего качества, и их нужно почистить. Во-вторых, мы никогда не работаем со всей табличкй сразу – мы отбираем данные, например, определенную колонку, и часто нам нужны не все данные, а только соответствующие определенным условиям (например, нам нужно отобрать время реакции в группе, где испытуемые употребляли кофеин, а не плацебо).</p>
<p>В предобработку данных чаще всего входит:</p>
<ul>
<li>Отбор определенных колонок</li>
<li>Фильтрация – отбор определенных строк, удовлетворяющих определенным условиям</li>
<li>Создание новых колонок и заполнение их в соответствии с определенными услвиями</li>
<li>Работа с пропущенными значениями – удаление или замена на какое-либо (например, среднее) значение</li>
</ul>
<p>Пойдем по порядку.</p>
<div id="columns" class="section level3 hasAnchor" number="14.6.1">
<h3><span class="header-section-number">14.6.1</span> Отбор колонок<a href="R_analysis.html#columns" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Любое почти всегда можно сделать разными способами. Чаще всего не существует правильного, если работает – значит, правильно. Но некоторые решения бывает более оптимальными в разных контекстах. Рассмотрим разные способы отбора колонок. Обратите внимание, чем они различаются?</p>
<p><em>Сразу комментарий – когда мы делаем операцию присвоения &lt;-, у нас ничего не выводится в консоль. Чтобы посмотреть, что мы присвоили переменной, можно вывести ее по названию или, если речь про данные – посмотреть с помощью функции View(). Если вы только пробуете написать операцию – не спешите присваивать ее в переменную! Так мы сразу будем видеть результат в консоли, и если он ошибочный, это будет понятно.</em></p>
<p><strong>Отбор в базовом R по названию колонки</strong></p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="R_analysis.html#cb66-1" tabindex="-1"></a>var1 <span class="ot">&lt;-</span> whr<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span></span>
<span id="cb66-2"><a href="R_analysis.html#cb66-2" tabindex="-1"></a>var1</span></code></pre></div>
<pre><code>##   [1] 7.526 7.509 7.501 7.498 7.413 7.404 7.339 7.334 7.313 7.291 7.267 7.119
##  [13] 7.104 7.087 7.039 6.994 6.952 6.929 6.907 6.871 6.778 6.739 6.725 6.705
##  [25] 6.701 6.650 6.596 6.573 6.545 6.488 6.481 6.478 6.474 6.379 6.379 6.375
##  [37] 6.361 6.355 6.324 6.269 6.239 6.218 6.168 6.084 6.078 6.068 6.005 5.992
##  [49] 5.987 5.977 5.976 5.956 5.921 5.919 5.897 5.856 5.835 5.835 5.822 5.813
##  [61] 5.802 5.771 5.768 5.743 5.658 5.648 5.615 5.560 5.546 5.538 5.528 5.517
##  [73] 5.510 5.488 5.458 5.440 5.401 5.389 5.314 5.303 5.291 5.279 5.245 5.196
##  [85] 5.185 5.177 5.163 5.161 5.155 5.151 5.145 5.132 5.129 5.123 5.121 5.061
##  [97] 5.057 5.045 5.033 4.996 4.907 4.876 4.875 4.871 4.813 4.795 4.793 4.754
## [109] 4.655 4.643 4.635 4.575 4.574 4.513 4.508 4.459 4.415 4.404 4.395 4.362
## [121] 4.360 4.356 4.324 4.276 4.272 4.252 4.236 4.219 4.217 4.201 4.193 4.156
## [133] 4.139 4.121 4.073 4.028 3.974 3.956 3.916 3.907 3.866 3.856 3.832 3.763
## [145] 3.739 3.739 3.724 3.695 3.666 3.622 3.607 3.515 3.484 3.360 3.303 3.069
## [157] 2.905</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="R_analysis.html#cb68-1" tabindex="-1"></a><span class="fu">str</span>(var1)</span></code></pre></div>
<pre><code>##  num [1:157] 7.53 7.51 7.5 7.5 7.41 ...</code></pre>
<p><strong>Отбор в базовом R по индексу</strong></p>
<p>Индекс – это номер элемента в структуре данных. Мы говорили про них, когда обсуждали многомерные массивы: в одномерной структуре, например, векторе, индекс будет состоять из одного числа, в двумернй (например, матрице или датафрейме) – индекс состоит из двух чисел, разделенных запятой, в трехмерной – из трех, и так далее. Индекс в R всегда пишется в квадратных скобках, например, чтобы узнать, что находится во второй строчке третьего столбца, индекс элемента будет <code>[2,3]</code>.
<strong>Сначала идет номер строки, затем – номер столбца.</strong> Если мы хотим вывести все строки или все столбцы – на месте этого индекса ничего не ставится. Например, если я хочу вывести все строки из третьей колонки, я напишу <code>[,3]</code></p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="R_analysis.html#cb70-1" tabindex="-1"></a>var2 <span class="ot">&lt;-</span> whr[,<span class="dv">4</span>]</span>
<span id="cb70-2"><a href="R_analysis.html#cb70-2" tabindex="-1"></a>var2</span></code></pre></div>
<pre><code>## # A tibble: 157 × 1
##    `Happiness Score`
##                &lt;dbl&gt;
##  1              7.53
##  2              7.51
##  3              7.50
##  4              7.50
##  5              7.41
##  6              7.40
##  7              7.34
##  8              7.33
##  9              7.31
## 10              7.29
## # ℹ 147 more rows</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="R_analysis.html#cb72-1" tabindex="-1"></a><span class="fu">str</span>(var2)</span></code></pre></div>
<pre><code>## tibble [157 × 1] (S3: tbl_df/tbl/data.frame)
##  $ Happiness Score: num [1:157] 7.53 7.51 7.5 7.5 7.41 ...</code></pre>
<p><strong>Отбор с помощью пакета tidyverse по названию</strong></p>
<p>Сначала пара важных моментов отнсосительно работы с пакетом и кульурой написания кода <code>tidyverse</code>. Последовательность операций в рамках одной задачи пишется построчно с переносом на следующую строку в виде <a href="https://magrittr.tidyverse.org/reference/pipe.html">пайпа</a> <code>%&gt;%</code> – символа, который позволяет испльзовать в качестве аргумента функции следующей строки то, что получилось в результате выполнения предыдущей. На первой строке в пайп передаются сами данные, то есть название переменной, в которую мы их записали. Далее на каждой следующей строке в качестве первого аргумента функции в скобках будет применяться результат выполнения предыдущей. Подробнее про tidyverse <a href="https://pozdniakov.github.io/tidy_stats/110-tidyverse_basic.html" class="uri">https://pozdniakov.github.io/tidy_stats/110-tidyverse_basic.html</a> и про пайпы <a href="https://pozdniakov.github.io/tidy_stats/110-tidyverse_basic.html" class="uri">https://pozdniakov.github.io/tidy_stats/110-tidyverse_basic.html</a></p>
<p>Внутри <code>tidyverse</code> используется такая структура данных, как <code>tibble</code>(<a href="https://tibble.tidyverse.org/" class="uri">https://tibble.tidyverse.org/</a>). Тиббл – это модицифированный датафрейм, о чем мы уже говорили, когда обсуждали <a href="R_analysis.html#data_structures">структуры данных</a></p>
<p>Вывод в датафрейм (тиббл):</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="R_analysis.html#cb74-1" tabindex="-1"></a>var3 <span class="ot">&lt;-</span> whr <span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href="R_analysis.html#cb74-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)</span>
<span id="cb74-3"><a href="R_analysis.html#cb74-3" tabindex="-1"></a>var3</span></code></pre></div>
<pre><code>## # A tibble: 157 × 1
##    `Happiness Score`
##                &lt;dbl&gt;
##  1              7.53
##  2              7.51
##  3              7.50
##  4              7.50
##  5              7.41
##  6              7.40
##  7              7.34
##  8              7.33
##  9              7.31
## 10              7.29
## # ℹ 147 more rows</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="R_analysis.html#cb76-1" tabindex="-1"></a><span class="co">#смотрим структуру данных</span></span>
<span id="cb76-2"><a href="R_analysis.html#cb76-2" tabindex="-1"></a><span class="fu">str</span>(var3)</span></code></pre></div>
<pre><code>## tibble [157 × 1] (S3: tbl_df/tbl/data.frame)
##  $ Happiness Score: num [1:157] 7.53 7.51 7.5 7.5 7.41 ...</code></pre>
<p>С помощью функции <code>select()</code> мы можем вытаскивать даже не одну колонку, а несколько:</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="R_analysis.html#cb78-1" tabindex="-1"></a>whr <span class="sc">%&gt;%</span></span>
<span id="cb78-2"><a href="R_analysis.html#cb78-2" tabindex="-1"></a>  <span class="fu">select</span>(Country,<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## # A tibble: 157 × 2
##    Country     `Happiness Score`
##    &lt;chr&gt;                   &lt;dbl&gt;
##  1 Denmark                  7.53
##  2 Switzerland              7.51
##  3 Iceland                  7.50
##  4 Norway                   7.50
##  5 Finland                  7.41
##  6 Canada                   7.40
##  7 Netherlands              7.34
##  8 New Zealand              7.33
##  9 Australia                7.31
## 10 Sweden                   7.29
## # ℹ 147 more rows</code></pre>
<p><strong>Отбор с помощью пакета tidyverse по названию</strong></p>
<p>Обратите внимание – предыдущий вывод так же является тибблом, а не вектором. Чтобы вывести в вектор, надо выполнить еще один шаг с помощью функции <code>pull()</code>, которая как бы “вытягивает” значения из тиббла:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="R_analysis.html#cb80-1" tabindex="-1"></a>var4 <span class="ot">&lt;-</span> whr <span class="sc">%&gt;%</span></span>
<span id="cb80-2"><a href="R_analysis.html#cb80-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-3"><a href="R_analysis.html#cb80-3" tabindex="-1"></a>  <span class="fu">pull</span>()</span>
<span id="cb80-4"><a href="R_analysis.html#cb80-4" tabindex="-1"></a>var4</span></code></pre></div>
<pre><code>##   [1] 7.526 7.509 7.501 7.498 7.413 7.404 7.339 7.334 7.313 7.291 7.267 7.119
##  [13] 7.104 7.087 7.039 6.994 6.952 6.929 6.907 6.871 6.778 6.739 6.725 6.705
##  [25] 6.701 6.650 6.596 6.573 6.545 6.488 6.481 6.478 6.474 6.379 6.379 6.375
##  [37] 6.361 6.355 6.324 6.269 6.239 6.218 6.168 6.084 6.078 6.068 6.005 5.992
##  [49] 5.987 5.977 5.976 5.956 5.921 5.919 5.897 5.856 5.835 5.835 5.822 5.813
##  [61] 5.802 5.771 5.768 5.743 5.658 5.648 5.615 5.560 5.546 5.538 5.528 5.517
##  [73] 5.510 5.488 5.458 5.440 5.401 5.389 5.314 5.303 5.291 5.279 5.245 5.196
##  [85] 5.185 5.177 5.163 5.161 5.155 5.151 5.145 5.132 5.129 5.123 5.121 5.061
##  [97] 5.057 5.045 5.033 4.996 4.907 4.876 4.875 4.871 4.813 4.795 4.793 4.754
## [109] 4.655 4.643 4.635 4.575 4.574 4.513 4.508 4.459 4.415 4.404 4.395 4.362
## [121] 4.360 4.356 4.324 4.276 4.272 4.252 4.236 4.219 4.217 4.201 4.193 4.156
## [133] 4.139 4.121 4.073 4.028 3.974 3.956 3.916 3.907 3.866 3.856 3.832 3.763
## [145] 3.739 3.739 3.724 3.695 3.666 3.622 3.607 3.515 3.484 3.360 3.303 3.069
## [157] 2.905</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="R_analysis.html#cb82-1" tabindex="-1"></a><span class="co">#смотрим структуру данных</span></span>
<span id="cb82-2"><a href="R_analysis.html#cb82-2" tabindex="-1"></a><span class="fu">str</span>(var4)</span></code></pre></div>
<pre><code>##  num [1:157] 7.53 7.51 7.5 7.5 7.41 ...</code></pre>
<p>В этом случае мы можем даже в этом же пайпе посчитать медиану или среднее:</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="R_analysis.html#cb84-1" tabindex="-1"></a>whr <span class="sc">%&gt;%</span></span>
<span id="cb84-2"><a href="R_analysis.html#cb84-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>) <span class="sc">%&gt;%</span> <span class="co">#результат -- тиббл</span></span>
<span id="cb84-3"><a href="R_analysis.html#cb84-3" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="sc">%&gt;%</span> <span class="co">#результат -- вектор</span></span>
<span id="cb84-4"><a href="R_analysis.html#cb84-4" tabindex="-1"></a>  <span class="fu">median</span>()</span></code></pre></div>
<pre><code>## [1] 5.314</code></pre>
<p>А так будет ошибка</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="R_analysis.html#cb86-1" tabindex="-1"></a>whr <span class="sc">%&gt;%</span></span>
<span id="cb86-2"><a href="R_analysis.html#cb86-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>) <span class="sc">%&gt;%</span> <span class="co">#результат -- тиббл</span></span>
<span id="cb86-3"><a href="R_analysis.html#cb86-3" tabindex="-1"></a>  <span class="fu">median</span>()</span></code></pre></div>
</div>
<div id="filter" class="section level3 hasAnchor" number="14.6.2">
<h3><span class="header-section-number">14.6.2</span> Фильтрация (отбор строк)<a href="R_analysis.html#filter" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Очень часто встает задача фильтрации строк: когда нужны не все данные, а удовлетворяющие какому-либо условию</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="R_analysis.html#cb87-1" tabindex="-1"></a>whr[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span></code></pre></div>
<pre><code>## # A tibble: 10 × 13
##    Country     Region  `Happiness Rank` `Happiness Score` Lower Confidence Int…¹
##    &lt;chr&gt;       &lt;chr&gt;              &lt;dbl&gt;             &lt;dbl&gt;                  &lt;dbl&gt;
##  1 Denmark     Wester…                1              7.53                   7.46
##  2 Switzerland Wester…                2              7.51                   7.43
##  3 Iceland     Wester…                3              7.50                   7.33
##  4 Norway      Wester…                4              7.50                   7.42
##  5 Finland     Wester…                5              7.41                   7.35
##  6 Canada      North …                6              7.40                   7.34
##  7 Netherlands Wester…                7              7.34                   7.28
##  8 New Zealand Austra…                8              7.33                   7.26
##  9 Australia   Austra…                9              7.31                   7.24
## 10 Sweden      Wester…               10              7.29                   7.23
## # ℹ abbreviated name: ¹​`Lower Confidence Interval`
## # ℹ 8 more variables: `Upper Confidence Interval` &lt;dbl&gt;,
## #   `Economy (GDP per Capita)` &lt;dbl&gt;, Family &lt;dbl&gt;,
## #   `Health (Life Expectancy)` &lt;dbl&gt;, Freedom &lt;dbl&gt;,
## #   `Trust (Government Corruption)` &lt;dbl&gt;, Generosity &lt;dbl&gt;,
## #   `Dystopia Residual` &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="R_analysis.html#cb89-1" tabindex="-1"></a>whr <span class="sc">%&gt;%</span> </span>
<span id="cb89-2"><a href="R_analysis.html#cb89-2" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 × 13
##    Country     Region  `Happiness Rank` `Happiness Score` Lower Confidence Int…¹
##    &lt;chr&gt;       &lt;chr&gt;              &lt;dbl&gt;             &lt;dbl&gt;                  &lt;dbl&gt;
##  1 Denmark     Wester…                1              7.53                   7.46
##  2 Switzerland Wester…                2              7.51                   7.43
##  3 Iceland     Wester…                3              7.50                   7.33
##  4 Norway      Wester…                4              7.50                   7.42
##  5 Finland     Wester…                5              7.41                   7.35
##  6 Canada      North …                6              7.40                   7.34
##  7 Netherlands Wester…                7              7.34                   7.28
##  8 New Zealand Austra…                8              7.33                   7.26
##  9 Australia   Austra…                9              7.31                   7.24
## 10 Sweden      Wester…               10              7.29                   7.23
## # ℹ abbreviated name: ¹​`Lower Confidence Interval`
## # ℹ 8 more variables: `Upper Confidence Interval` &lt;dbl&gt;,
## #   `Economy (GDP per Capita)` &lt;dbl&gt;, Family &lt;dbl&gt;,
## #   `Health (Life Expectancy)` &lt;dbl&gt;, Freedom &lt;dbl&gt;,
## #   `Trust (Government Corruption)` &lt;dbl&gt;, Generosity &lt;dbl&gt;,
## #   `Dystopia Residual` &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="R_analysis.html#cb91-1" tabindex="-1"></a>whr <span class="sc">%&gt;%</span></span>
<span id="cb91-2"><a href="R_analysis.html#cb91-2" tabindex="-1"></a>  <span class="fu">filter</span>(Region <span class="sc">==</span> <span class="st">&quot;Central and Eastern Europe&quot;</span>) </span></code></pre></div>
<pre><code>## # A tibble: 29 × 13
##    Country      Region `Happiness Rank` `Happiness Score` Lower Confidence Int…¹
##    &lt;chr&gt;        &lt;chr&gt;             &lt;dbl&gt;             &lt;dbl&gt;                  &lt;dbl&gt;
##  1 Czech Repub… Centr…               27              6.60                   6.52
##  2 Slovakia     Centr…               45              6.08                   6.00
##  3 Uzbekistan   Centr…               49              5.99                   5.90
##  4 Kazakhstan   Centr…               54              5.92                   5.84
##  5 Moldova      Centr…               55              5.90                   5.82
##  6 Russia       Centr…               56              5.86                   5.79
##  7 Poland       Centr…               57              5.84                   5.75
##  8 Lithuania    Centr…               60              5.81                   5.73
##  9 Belarus      Centr…               61              5.80                   5.72
## 10 Slovenia     Centr…               63              5.77                   5.68
## # ℹ 19 more rows
## # ℹ abbreviated name: ¹​`Lower Confidence Interval`
## # ℹ 8 more variables: `Upper Confidence Interval` &lt;dbl&gt;,
## #   `Economy (GDP per Capita)` &lt;dbl&gt;, Family &lt;dbl&gt;,
## #   `Health (Life Expectancy)` &lt;dbl&gt;, Freedom &lt;dbl&gt;,
## #   `Trust (Government Corruption)` &lt;dbl&gt;, Generosity &lt;dbl&gt;,
## #   `Dystopia Residual` &lt;dbl&gt;</code></pre>
<p>А теперь отфильтруем эти значения и возьмем только те значения <code>Happiness Score</code>, которые соответствуют Центральной и восточной Европе</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="R_analysis.html#cb93-1" tabindex="-1"></a>whr <span class="sc">%&gt;%</span></span>
<span id="cb93-2"><a href="R_analysis.html#cb93-2" tabindex="-1"></a>  <span class="fu">filter</span>(Region <span class="sc">==</span> <span class="st">&quot;Central and Eastern Europe&quot;</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb93-3"><a href="R_analysis.html#cb93-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>) </span></code></pre></div>
<pre><code>## # A tibble: 29 × 1
##    `Happiness Score`
##                &lt;dbl&gt;
##  1              6.60
##  2              6.08
##  3              5.99
##  4              5.92
##  5              5.90
##  6              5.86
##  7              5.84
##  8              5.81
##  9              5.80
## 10              5.77
## # ℹ 19 more rows</code></pre>
<p>.. и “вытащим” эти значения в числовой вектор, чтобы с ними было проще всего работать</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="R_analysis.html#cb95-1" tabindex="-1"></a>whr <span class="sc">%&gt;%</span></span>
<span id="cb95-2"><a href="R_analysis.html#cb95-2" tabindex="-1"></a>  <span class="fu">filter</span>(Region <span class="sc">==</span> <span class="st">&quot;Central and Eastern Europe&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-3"><a href="R_analysis.html#cb95-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb95-4"><a href="R_analysis.html#cb95-4" tabindex="-1"></a>  <span class="fu">pull</span>() </span></code></pre></div>
<pre><code>##  [1] 6.596 6.078 5.987 5.919 5.897 5.856 5.835 5.813 5.802 5.768 5.658 5.560
## [13] 5.528 5.517 5.488 5.401 5.291 5.185 5.177 5.163 5.161 5.145 5.121 4.996
## [25] 4.655 4.360 4.324 4.252 4.217</code></pre>
<p>И посчитаем среднее</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="R_analysis.html#cb97-1" tabindex="-1"></a>whr <span class="sc">%&gt;%</span></span>
<span id="cb97-2"><a href="R_analysis.html#cb97-2" tabindex="-1"></a>  <span class="fu">filter</span>(Region <span class="sc">==</span> <span class="st">&quot;Central and Eastern Europe&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-3"><a href="R_analysis.html#cb97-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-4"><a href="R_analysis.html#cb97-4" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb97-5"><a href="R_analysis.html#cb97-5" tabindex="-1"></a>  <span class="fu">mean</span>()</span></code></pre></div>
<pre><code>## [1] 5.37069</code></pre>
<p>Теперь можем сравнить средний <code>Happiness Score</code> по всем странам (считали его ранее) и только по Центральной и восточной Европе. Что можно про них сказать?</p>
<p>Или посмотрим, какие страны находятся в топе-10 по <code>Happiness Rank</code></p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="R_analysis.html#cb99-1" tabindex="-1"></a>whr <span class="sc">%&gt;%</span></span>
<span id="cb99-2"><a href="R_analysis.html#cb99-2" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="st">`</span><span class="at">Happiness Rank</span><span class="st">`</span> <span class="sc">&lt;=</span> <span class="dv">10</span>) </span></code></pre></div>
<pre><code>## # A tibble: 10 × 13
##    Country     Region  `Happiness Rank` `Happiness Score` Lower Confidence Int…¹
##    &lt;chr&gt;       &lt;chr&gt;              &lt;dbl&gt;             &lt;dbl&gt;                  &lt;dbl&gt;
##  1 Denmark     Wester…                1              7.53                   7.46
##  2 Switzerland Wester…                2              7.51                   7.43
##  3 Iceland     Wester…                3              7.50                   7.33
##  4 Norway      Wester…                4              7.50                   7.42
##  5 Finland     Wester…                5              7.41                   7.35
##  6 Canada      North …                6              7.40                   7.34
##  7 Netherlands Wester…                7              7.34                   7.28
##  8 New Zealand Austra…                8              7.33                   7.26
##  9 Australia   Austra…                9              7.31                   7.24
## 10 Sweden      Wester…               10              7.29                   7.23
## # ℹ abbreviated name: ¹​`Lower Confidence Interval`
## # ℹ 8 more variables: `Upper Confidence Interval` &lt;dbl&gt;,
## #   `Economy (GDP per Capita)` &lt;dbl&gt;, Family &lt;dbl&gt;,
## #   `Health (Life Expectancy)` &lt;dbl&gt;, Freedom &lt;dbl&gt;,
## #   `Trust (Government Corruption)` &lt;dbl&gt;, Generosity &lt;dbl&gt;,
## #   `Dystopia Residual` &lt;dbl&gt;</code></pre>
</div>
<div id="mutate" class="section level3 hasAnchor" number="14.6.3">
<h3><span class="header-section-number">14.6.3</span> Создание колонок<a href="R_analysis.html#mutate" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Часто возникает задача перекодировать переменную – например, разбить непрерывные значения на группы, чтобы посмотреть различия между ними.</p>
<p>Например, продолжая предыдущий пример с фильтрацией первых 10 в рейтинге стран: для сравнения показателей, вклдывающихся в уровень счастья, нас может интересовать, отличаются ли “топовые” страны от всех остальных. Для этого нам проще создать отдельную колонку, которая служит индикатором, является ли страна “топовой”. Разберем, что это значит: нам нужно 1) создать новую колонку и 2) записать в нее значения, удовлятворяющие определенному условию. (1) достигается с помощью функции <code>mutate()</code> (как бы “измени” датафрейм, “примутируй” к нему колонку), а (2) достигается очень похожим на фильтрацию способом – с помощью функции <code>ifelse</code> (<a href="R_analysis.html#operarions">пример выше</a>)</p>
<p>На паре топовые и не топовые страны превратились в <code>hehe</code> и <code>not hehe</code>, так и оставим.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="R_analysis.html#cb101-1" tabindex="-1"></a>whr_top <span class="ot">&lt;-</span> whr <span class="sc">%&gt;%</span> </span>
<span id="cb101-2"><a href="R_analysis.html#cb101-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">&quot;Rank Category&quot;</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="st">`</span><span class="at">Happiness Rank</span><span class="st">`</span> <span class="sc">&lt;=</span><span class="dv">10</span>, <span class="st">&quot;hehe&quot;</span>, <span class="st">&quot;not hehe&quot;</span>))</span>
<span id="cb101-3"><a href="R_analysis.html#cb101-3" tabindex="-1"></a></span>
<span id="cb101-4"><a href="R_analysis.html#cb101-4" tabindex="-1"></a><span class="fu">View</span>(whr_top)</span></code></pre></div>
<p>Если выведем датафрейм, увидим, что на последнем месте появилась новая колонка <code>Rank Category</code>.</p>
<p>Новые значения могут соответствовать и какой-либо математической операции, например, создадим новую колонку, показывающую, во сколько раз уровень счастья в стране превышает значения страны-дистопии:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="R_analysis.html#cb102-1" tabindex="-1"></a>whr <span class="sc">%&gt;%</span> </span>
<span id="cb102-2"><a href="R_analysis.html#cb102-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">&quot;Times&quot;</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span> <span class="sc">/</span> <span class="st">`</span><span class="at">Dystopia Residual</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb102-3"><a href="R_analysis.html#cb102-3" tabindex="-1"></a>  <span class="fu">View</span>()</span></code></pre></div>
</div>
<div id="NA" class="section level3 hasAnchor" number="14.6.4">
<h3><span class="header-section-number">14.6.4</span> Работа с пропущенными значениями (NA)<a href="R_analysis.html#NA" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Как уже говорилось в разделе про <a href="R_analysis.html#data_types">типы данных</a>, есть отдельный тип данных, который кодирует пропущенные значения – NA, Not Available. Это особенный тип, потому что из-за пропущенных значений мы не можем оценить данные целиком. Такие ситуации встречаются крайне часто, поэтому придуманы специальные способы обращения с NA.</p>
<p>Для изучения этого раздела нам понадобятся данные <code>2016-2</code> по ссылке <a href="https://raw.githubusercontent.com/elenary/StatsForDA/main/2016-2.csv" class="uri">https://raw.githubusercontent.com/elenary/StatsForDA/main/2016-2.csv</a> (правая кнопка мыши – сохранить как)</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="R_analysis.html#cb103-1" tabindex="-1"></a>whr_new <span class="ot">&lt;-</span><span class="fu">read_csv</span>(<span class="st">&quot;2016-2.csv&quot;</span>)</span>
<span id="cb103-2"><a href="R_analysis.html#cb103-2" tabindex="-1"></a><span class="co"># View(whr_new)</span></span></code></pre></div>
<p>Первая важная функция работы с промущенными значениями – это <code>is.na()</code>, проверка того, является ли каждый элемент вектора или датафрейма NA, и механизмы подсчета количества таких значений.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="R_analysis.html#cb104-1" tabindex="-1"></a><span class="fu">is.na</span>(whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>##   [1] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE FALSE FALSE FALSE
##  [13]  TRUE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [25] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [37] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [49] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [61] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [73] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [85] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
##  [97] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [109] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [121] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [133] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [145] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [157] FALSE</code></pre>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="R_analysis.html#cb106-1" tabindex="-1"></a><span class="co">#помним, что TRUE -- это 1, а FALSE -- 0. Поэтому можем перевести результаты в числовой вектор</span></span>
<span id="cb106-2"><a href="R_analysis.html#cb106-2" tabindex="-1"></a><span class="fu">as.numeric</span>(<span class="fu">is.na</span>(whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>))</span></code></pre></div>
<pre><code>##   [1] 0 0 0 0 0 0 1 1 1 0 0 0 1 0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [38] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
##  [75] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [112] 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
## [149] 0 0 0 0 0 0 0 0 0</code></pre>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="R_analysis.html#cb108-1" tabindex="-1"></a><span class="co">#подсчет количества NA</span></span>
<span id="cb108-2"><a href="R_analysis.html#cb108-2" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">as.numeric</span>(<span class="fu">is.na</span>(whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)))</span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="R_analysis.html#cb110-1" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">is.na</span>(whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>))</span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<p>Одна из больших проблем с этими значениями – они мешают производить вычисления. Когда часть данных отсутствует, невозможно сказать, каково среднее выборки.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="R_analysis.html#cb112-1" tabindex="-1"></a>whr_new <span class="sc">%&gt;%</span> </span>
<span id="cb112-2"><a href="R_analysis.html#cb112-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb112-3"><a href="R_analysis.html#cb112-3" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb112-4"><a href="R_analysis.html#cb112-4" tabindex="-1"></a>  <span class="fu">mean</span>()</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="R_analysis.html#cb114-1" tabindex="-1"></a><span class="fu">mean</span>(whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>Так происходит, потому что невозможно прибавить, вычесть или даже сравнить с чем-то значение, которое недоступно</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="R_analysis.html#cb116-1" tabindex="-1"></a><span class="dv">1</span> <span class="sc">==</span> <span class="cn">NA</span></span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="R_analysis.html#cb118-1" tabindex="-1"></a><span class="st">&quot;NA&quot;</span> <span class="sc">==</span> <span class="cn">NA</span></span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="R_analysis.html#cb120-1" tabindex="-1"></a><span class="cn">NA</span> <span class="sc">==</span> <span class="cn">NA</span></span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<p>Для этого пропущенные значения обычно удаляют из рассмотрения. Например, с помощью функции <code>na.omit()</code> в базовом R или с помощью <code>drop_na()</code> в нотации <code>tifdyverse</code>. <strong>Важно!</strong> В зависимости от того, к чему мы применяем эту функции, мы либо удаляем NA из отобранной нами колонки, либо, если применяем ко всему датафрейму – удалятся <strong>все строки</strong>, в которых есть NA хотя бы в одной из колонок.</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="R_analysis.html#cb122-1" tabindex="-1"></a>whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span> </span></code></pre></div>
<pre><code>##   [1] 7.526 7.509 7.501 7.498 7.413 7.404    NA    NA    NA 7.291 7.267 7.119
##  [13]    NA 7.087    NA 6.994 6.952 6.929 6.907 6.871 6.778 6.739 6.725 6.705
##  [25] 6.701 6.650 6.596 6.573 6.545 6.488 6.481 6.478 6.474 6.379 6.379 6.375
##  [37] 6.361 6.355 6.324 6.269 6.239 6.218 6.168 6.084 6.078 6.068 6.005 5.992
##  [49] 5.987 5.977 5.976 5.956 5.921 5.919 5.897 5.856 5.835 5.835 5.822 5.813
##  [61] 5.802 5.771 5.768 5.743 5.658 5.648 5.615 5.560 5.546 5.538 5.528 5.517
##  [73] 5.510 5.488 5.458 5.440 5.401 5.389 5.314 5.303 5.291 5.279 5.245 5.196
##  [85] 5.185 5.177 5.163 5.161 5.155 5.151 5.145 5.132 5.129 5.123 5.121 5.061
##  [97] 5.057 5.045 5.033 4.996 4.907 4.876 4.875 4.871 4.813 4.795 4.793 4.754
## [109] 4.655 4.643 4.635 4.575 4.574 4.513 4.508 4.459 4.415 4.404 4.395 4.362
## [121] 4.360 4.356 4.324 4.276 4.272 4.252 4.236 4.219 4.217 4.201 4.193 4.156
## [133] 4.139 4.121 4.073 4.028 3.974 3.956 3.916 3.907 3.866 3.856 3.832 3.763
## [145] 3.739 3.739 3.724 3.695 3.666 3.622 3.607 3.515 3.484 3.360 3.303 3.069
## [157] 2.905</code></pre>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="R_analysis.html#cb124-1" tabindex="-1"></a><span class="fu">mean</span>(whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>) <span class="co"># выдает NA</span></span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="R_analysis.html#cb126-1" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">na.omit</span>(whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)) <span class="co"># выдает среднее</span></span></code></pre></div>
<pre><code>## [1] 5.321539</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="R_analysis.html#cb128-1" tabindex="-1"></a><span class="co"># выдает NA</span></span>
<span id="cb128-2"><a href="R_analysis.html#cb128-2" tabindex="-1"></a>whr_new <span class="sc">%&gt;%</span> </span>
<span id="cb128-3"><a href="R_analysis.html#cb128-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb128-4"><a href="R_analysis.html#cb128-4" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb128-5"><a href="R_analysis.html#cb128-5" tabindex="-1"></a>  <span class="fu">mean</span>()</span></code></pre></div>
<pre><code>## [1] NA</code></pre>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="R_analysis.html#cb130-1" tabindex="-1"></a><span class="co"># выдает среднее</span></span>
<span id="cb130-2"><a href="R_analysis.html#cb130-2" tabindex="-1"></a>whr_new <span class="sc">%&gt;%</span> </span>
<span id="cb130-3"><a href="R_analysis.html#cb130-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb130-4"><a href="R_analysis.html#cb130-4" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb130-5"><a href="R_analysis.html#cb130-5" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb130-6"><a href="R_analysis.html#cb130-6" tabindex="-1"></a>  <span class="fu">mean</span>()</span></code></pre></div>
<pre><code>## [1] 5.321539</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="R_analysis.html#cb132-1" tabindex="-1"></a><span class="co"># обратите внимание -- так тоже работает, но среднее другое! Почему?</span></span>
<span id="cb132-2"><a href="R_analysis.html#cb132-2" tabindex="-1"></a>whr_new <span class="sc">%&gt;%</span> </span>
<span id="cb132-3"><a href="R_analysis.html#cb132-3" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb132-4"><a href="R_analysis.html#cb132-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb132-5"><a href="R_analysis.html#cb132-5" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb132-6"><a href="R_analysis.html#cb132-6" tabindex="-1"></a>  <span class="fu">mean</span>()</span></code></pre></div>
<pre><code>## [1] 5.266447</code></pre>
<p>Для работы конкретно с описательным статистиками и аггрегирующими функциями вроде суммы еще есть один лайфхак работы с пропущенными значениями – аргумент <code>na.rm = TRUE</code> внутри функций <code>mean()</code>, <code>median()</code>, <code>sum()</code>. <code>na.rm = TRUE</code> буквально значит “na remove = true”</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="R_analysis.html#cb134-1" tabindex="-1"></a><span class="co">#  через базовый R</span></span>
<span id="cb134-2"><a href="R_analysis.html#cb134-2" tabindex="-1"></a><span class="fu">mean</span>(whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 5.321539</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="R_analysis.html#cb136-1" tabindex="-1"></a><span class="co">#  или с помощью тайдиверс</span></span>
<span id="cb136-2"><a href="R_analysis.html#cb136-2" tabindex="-1"></a>whr_new <span class="sc">%&gt;%</span> </span>
<span id="cb136-3"><a href="R_analysis.html#cb136-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb136-4"><a href="R_analysis.html#cb136-4" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb136-5"><a href="R_analysis.html#cb136-5" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 5.321539</code></pre>
</div>
<div id="sorting" class="section level3 hasAnchor" number="14.6.5">
<h3><span class="header-section-number">14.6.5</span> Сортировка<a href="R_analysis.html#sorting" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Еще одна часто встречающая задача – отсортировать датафрейм по возрастанию или убыванию одной переменной.</p>
<p>В базовом R когда у нас есть только один вектор, мы можем сделать это так</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="R_analysis.html#cb138-1" tabindex="-1"></a><span class="fu">sort</span>(whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>##   [1] 2.905 3.069 3.303 3.360 3.484 3.515 3.607 3.622 3.666 3.695 3.724 3.739
##  [13] 3.739 3.763 3.832 3.856 3.866 3.907 3.916 3.956 3.974 4.028 4.073 4.121
##  [25] 4.139 4.156 4.193 4.201 4.217 4.219 4.236 4.252 4.272 4.276 4.324 4.356
##  [37] 4.360 4.362 4.395 4.404 4.415 4.459 4.508 4.513 4.574 4.575 4.635 4.643
##  [49] 4.655 4.754 4.793 4.795 4.813 4.871 4.875 4.876 4.907 4.996 5.033 5.045
##  [61] 5.057 5.061 5.121 5.123 5.129 5.132 5.145 5.151 5.155 5.161 5.163 5.177
##  [73] 5.185 5.196 5.245 5.279 5.291 5.303 5.314 5.389 5.401 5.440 5.458 5.488
##  [85] 5.510 5.517 5.528 5.538 5.546 5.560 5.615 5.648 5.658 5.743 5.768 5.771
##  [97] 5.802 5.813 5.822 5.835 5.835 5.856 5.897 5.919 5.921 5.956 5.976 5.977
## [109] 5.987 5.992 6.005 6.068 6.078 6.084 6.168 6.218 6.239 6.269 6.324 6.355
## [121] 6.361 6.375 6.379 6.379 6.474 6.478 6.481 6.488 6.545 6.573 6.596 6.650
## [133] 6.701 6.705 6.725 6.739 6.778 6.871 6.907 6.929 6.952 6.994 7.087 7.119
## [145] 7.267 7.291 7.404 7.413 7.498 7.501 7.509 7.526</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="R_analysis.html#cb140-1" tabindex="-1"></a><span class="fu">sort</span>(whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>##   [1] 7.526 7.509 7.501 7.498 7.413 7.404 7.291 7.267 7.119 7.087 6.994 6.952
##  [13] 6.929 6.907 6.871 6.778 6.739 6.725 6.705 6.701 6.650 6.596 6.573 6.545
##  [25] 6.488 6.481 6.478 6.474 6.379 6.379 6.375 6.361 6.355 6.324 6.269 6.239
##  [37] 6.218 6.168 6.084 6.078 6.068 6.005 5.992 5.987 5.977 5.976 5.956 5.921
##  [49] 5.919 5.897 5.856 5.835 5.835 5.822 5.813 5.802 5.771 5.768 5.743 5.658
##  [61] 5.648 5.615 5.560 5.546 5.538 5.528 5.517 5.510 5.488 5.458 5.440 5.401
##  [73] 5.389 5.314 5.303 5.291 5.279 5.245 5.196 5.185 5.177 5.163 5.161 5.155
##  [85] 5.151 5.145 5.132 5.129 5.123 5.121 5.061 5.057 5.045 5.033 4.996 4.907
##  [97] 4.876 4.875 4.871 4.813 4.795 4.793 4.754 4.655 4.643 4.635 4.575 4.574
## [109] 4.513 4.508 4.459 4.415 4.404 4.395 4.362 4.360 4.356 4.324 4.276 4.272
## [121] 4.252 4.236 4.219 4.217 4.201 4.193 4.156 4.139 4.121 4.073 4.028 3.974
## [133] 3.956 3.916 3.907 3.866 3.856 3.832 3.763 3.739 3.739 3.724 3.695 3.666
## [145] 3.622 3.607 3.515 3.484 3.360 3.303 3.069 2.905</code></pre>
<p>В тайдиверс – с помощью функции <code>arrange()</code>, где в качестве аргумента передается название колонки, по которой будем делать сортировку. А если нам нужно указать, что сортировка должна быть по убыванию, от большого к меньшего – необходимо вставить аргумент <code>desc()</code></p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="R_analysis.html#cb142-1" tabindex="-1"></a>whr_new <span class="sc">%&gt;%</span> </span>
<span id="cb142-2"><a href="R_analysis.html#cb142-2" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb142-3"><a href="R_analysis.html#cb142-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb142-4"><a href="R_analysis.html#cb142-4" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>) <span class="co"># сортировка по возрастанию</span></span></code></pre></div>
<pre><code>## # A tibble: 132 × 1
##    `Happiness Score`
##                &lt;dbl&gt;
##  1              2.90
##  2              3.07
##  3              3.30
##  4              3.36
##  5              3.48
##  6              3.52
##  7              3.62
##  8              3.67
##  9              3.70
## 10              3.74
## # ℹ 122 more rows</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="R_analysis.html#cb144-1" tabindex="-1"></a>whr_new <span class="sc">%&gt;%</span> </span>
<span id="cb144-2"><a href="R_analysis.html#cb144-2" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb144-3"><a href="R_analysis.html#cb144-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb144-4"><a href="R_analysis.html#cb144-4" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)) <span class="co"># сортировка по убыванию</span></span></code></pre></div>
<pre><code>## # A tibble: 132 × 1
##    `Happiness Score`
##                &lt;dbl&gt;
##  1              7.53
##  2              7.51
##  3              7.50
##  4              7.29
##  5              7.12
##  6              6.99
##  7              6.95
##  8              6.91
##  9              6.87
## 10              6.78
## # ℹ 122 more rows</code></pre>
<p>Самое интересное здесь – что мы можем сортировать весь датафрейм по значениям одной переменной</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="R_analysis.html#cb146-1" tabindex="-1"></a>whr_new <span class="sc">%&gt;%</span> </span>
<span id="cb146-2"><a href="R_analysis.html#cb146-2" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb146-3"><a href="R_analysis.html#cb146-3" tabindex="-1"></a>  <span class="fu">arrange</span>(Freedom) <span class="co"># сорируем по значениям переменной Freedom</span></span></code></pre></div>
<pre><code>## # A tibble: 132 × 13
##    Country      Region `Happiness Rank` `Happiness Score` Lower Confidence Int…¹
##    &lt;chr&gt;        &lt;chr&gt;             &lt;dbl&gt;             &lt;dbl&gt;                  &lt;dbl&gt;
##  1 Sudan        Sub-S…              133              4.14                   3.93
##  2 Angola       Sub-S…              141              3.87                   3.75
##  3 Burundi      Sub-S…              157              2.90                   2.73
##  4 Greece       Weste…               99              5.03                   4.93
##  5 Syria        Middl…              156              3.07                   2.94
##  6 Bosnia and … Centr…               87              5.16                   5.06
##  7 Haiti        Latin…              136              4.03                   3.89
##  8 Mauritania   Sub-S…              130              4.20                   4.13
##  9 Ukraine      Centr…              123              4.32                   4.24
## 10 Madagascar   Sub-S…              148              3.70                   3.62
## # ℹ 122 more rows
## # ℹ abbreviated name: ¹​`Lower Confidence Interval`
## # ℹ 8 more variables: `Upper Confidence Interval` &lt;dbl&gt;,
## #   `Economy (GDP per Capita)` &lt;dbl&gt;, Family &lt;dbl&gt;,
## #   `Health (Life Expectancy)` &lt;dbl&gt;, Freedom &lt;dbl&gt;,
## #   `Trust (Government Corruption)` &lt;dbl&gt;, Generosity &lt;dbl&gt;,
## #   `Dystopia Residual` &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="R_analysis.html#cb148-1" tabindex="-1"></a>whr_new <span class="sc">%&gt;%</span> </span>
<span id="cb148-2"><a href="R_analysis.html#cb148-2" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb148-3"><a href="R_analysis.html#cb148-3" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="st">`</span><span class="at">Trust (Government Corruption)</span><span class="st">`</span>) <span class="co"># сорируем по значениям переменной Trust</span></span></code></pre></div>
<pre><code>## # A tibble: 132 × 13
##    Country      Region `Happiness Rank` `Happiness Score` Lower Confidence Int…¹
##    &lt;chr&gt;        &lt;chr&gt;             &lt;dbl&gt;             &lt;dbl&gt;                  &lt;dbl&gt;
##  1 Bosnia and … Centr…               87              5.16                   5.06
##  2 Bulgaria     Centr…              129              4.22                   4.10
##  3 Romania      Centr…               71              5.53                   5.43
##  4 Trinidad an… Latin…               43              6.17                   5.95
##  5 Portugal     Weste…               94              5.12                   5.03
##  6 Lithuania    Centr…               60              5.81                   5.73
##  7 Ukraine      Centr…              123              4.32                   4.24
##  8 Moldova      Centr…               55              5.90                   5.82
##  9 Italy        Weste…               50              5.98                   5.90
## 10 China        Easte…               83              5.24                   5.20
## # ℹ 122 more rows
## # ℹ abbreviated name: ¹​`Lower Confidence Interval`
## # ℹ 8 more variables: `Upper Confidence Interval` &lt;dbl&gt;,
## #   `Economy (GDP per Capita)` &lt;dbl&gt;, Family &lt;dbl&gt;,
## #   `Health (Life Expectancy)` &lt;dbl&gt;, Freedom &lt;dbl&gt;,
## #   `Trust (Government Corruption)` &lt;dbl&gt;, Generosity &lt;dbl&gt;,
## #   `Dystopia Residual` &lt;dbl&gt;</code></pre>
</div>
</div>
<div id="tasks_sem3" class="section level2 hasAnchor" number="14.7">
<h2><span class="header-section-number">14.7</span> Задания после семинара 3<a href="R_analysis.html#tasks_sem3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>Выполните все примеры, которые есть в этом разделе, убедитесь, что все работает верно.</li>
<li>Посмотрите, какие страны находятся на местах с 1 по 10 и с 147 по 157 (в выводе должно быть по две колонки: <code>Region</code> и <code>Happiness Rank</code>)</li>
<li>Сравните средний показатель экономики <code>Economy (GDP per Capita)</code> и уровень счастья <code>Happiness Score</code> в странах Восточной и центральной (Central and Eastern Europe) и Западной Европы (Western Europe). Что можно сказать про них? Где показатель экономики выше? Где люди чувствуют себя счастливее?</li>
<li>Сравните средний показатель экономики<code>Economy (GDP per Capita)</code> и уровень счастья <code>Happiness Score</code> в странах Западной Европы (Western Europe) и Южной Азии (Southern Asia). Что можно сказать про них? Где показатель экономики выше? Где люди чувствуют себя счастливее?</li>
<li><em>(Только для тех, кто работает в R)</em> Посчитайте средний <code>Happiness Score</code> по всем странам и выведете страны, которые лежат в границах ± 1 от среднего <code>Happiness Score</code> (в выводе должно быть по две колонки: <code>Region</code> и <code>Happiness Score</code>) <em>Подсказка: возможно, будет проще посчитать среднее отдельно и сначала сохранить его в переменную</em></li>
<li>Создайте колонку, в которой будет содержаться информация, в текущей стране <code>Happiness Score</code> выше или ниже среднего значения (колонка может быть заполнена, например, значениями upper и lower или любыми другими обозначениями)</li>
</ol>
</div>
<div id="descriptives_r" class="section level2 hasAnchor" number="14.8">
<h2><span class="header-section-number">14.8</span> Описательные статистики и агрегация<a href="R_analysis.html#descriptives_r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="описательные-статистики" class="section level3 hasAnchor" number="14.8.1">
<h3><span class="header-section-number">14.8.1</span> Описательные статистики<a href="R_analysis.html#описательные-статистики" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Мы уже немножко считали описательные статистики в самом начале работы с данными, чтобы было пободрее продвигаться. Теперь давайте остановимся на них поподробнее.</p>
<p>Самые частые описательные статистики из мер центральной тенденции – среднее, медиана и мода. Среднее и медиану мы уже строили, а как построить моду?</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="R_analysis.html#cb150-1" tabindex="-1"></a><span class="fu">mean</span>(whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 5.321539</code></pre>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="R_analysis.html#cb152-1" tabindex="-1"></a><span class="fu">median</span>(whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 5.285</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="R_analysis.html#cb154-1" tabindex="-1"></a><span class="fu">summary</span>(whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##   2.905   4.387   5.285   5.322   6.105   7.526       5</code></pre>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="R_analysis.html#cb156-1" tabindex="-1"></a><span class="co"># mode(whr_new$`Happiness Score`, na.rm = TRUE) #выдаст ошибку</span></span>
<span id="cb156-2"><a href="R_analysis.html#cb156-2" tabindex="-1"></a><span class="co"># mode(whr_new$`Happiness Score`)</span></span></code></pre></div>
<p>Так получилось, что в R нет специальной функции для моды. У этого есть и логическая причина – жанные, с которыми мы в основном работаем – количественные непрерывные, и мы обсуждали, что для такого рода данных понятие моды немного искуственно. Но нам все равно бывает нужно посчитать моду. Поэтому можно либо написать функцию для ее расчета самостоятельно, либо воспользоваться готовой функцией из пакета. Я погуглила, что можно сделать, и вам рекомендую всегда так делать в таких ситуациях – и выбрала функцию <code>mlv()</code> (most likely value) из пакета <code>modeest</code></p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="R_analysis.html#cb157-1" tabindex="-1"></a><span class="co"># install.packages(&quot;modeest&quot;)</span></span>
<span id="cb157-2"><a href="R_analysis.html#cb157-2" tabindex="-1"></a><span class="fu">library</span>(modeest)</span>
<span id="cb157-3"><a href="R_analysis.html#cb157-3" tabindex="-1"></a><span class="fu">mlv</span>(whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Warning: argument &#39;method&#39; is missing. Data are supposed to be continuous. 
##             Default method &#39;shorth&#39; is used</code></pre>
<pre><code>## [1] 5.239092</code></pre>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="R_analysis.html#cb160-1" tabindex="-1"></a><span class="fu">mlv</span>(whr_new<span class="sc">$</span>Region, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] &quot;Sub-Saharan Africa&quot;</code></pre>
<p>Либо, можно воспользоваться простой функцией <code>table()</code>, которая считает количество значений указанной переменной.</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="R_analysis.html#cb162-1" tabindex="-1"></a><span class="fu">table</span>(whr_new<span class="sc">$</span>Region)</span></code></pre></div>
<pre><code>## 
##       Australia and New Zealand      Central and Eastern Europe 
##                               2                              29 
##                    Eastern Asia     Latin America and Caribbean 
##                               6                              24 
## Middle East and Northern Africa                   North America 
##                              19                               2 
##               Southeastern Asia                   Southern Asia 
##                               9                               7 
##              Sub-Saharan Africa                  Western Europe 
##                              38                              21</code></pre>
<p>Помимо мер центральной тенденции можем посчитать меры изменчивости – минимальное и максимальное, размах, стандартное отклонение, дисперсию, межквартильный размах.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="R_analysis.html#cb164-1" tabindex="-1"></a><span class="fu">min</span>(whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## [1] 2.905</code></pre>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="R_analysis.html#cb166-1" tabindex="-1"></a><span class="fu">max</span>(whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) </span></code></pre></div>
<pre><code>## [1] 7.526</code></pre>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="R_analysis.html#cb168-1" tabindex="-1"></a><span class="fu">range</span>(whr<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>) <span class="co">#размах</span></span></code></pre></div>
<pre><code>## [1] 2.905 7.526</code></pre>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="R_analysis.html#cb170-1" tabindex="-1"></a><span class="fu">sd</span>(whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co">#стандартное отклонение</span></span></code></pre></div>
<pre><code>## [1] 1.108958</code></pre>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="R_analysis.html#cb172-1" tabindex="-1"></a><span class="fu">var</span>(whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co">#дисперсия</span></span></code></pre></div>
<pre><code>## [1] 1.229787</code></pre>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="R_analysis.html#cb174-1" tabindex="-1"></a><span class="fu">IQR</span>(whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="co">#межквартильный размах</span></span></code></pre></div>
<pre><code>## [1] 1.71825</code></pre>
<p>Мы так же рассчитывали описательные статистики с помощью функции <code>summary()</code>. Есть более продвинутые функции, которые считают большое количество описательных статистик сразу. Например, часто используется функция skim() из пакета skimr – помимо мер центральной тенденции и всех четырех квартителей, она считает стандартное отклонение и даже строит маленькую гистограммку.
summary(whr_new$<code>Happiness Score</code>)</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="R_analysis.html#cb176-1" tabindex="-1"></a><span class="fu">summary</span>(whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA&#39;s 
##   2.905   4.387   5.285   5.322   6.105   7.526       5</code></pre>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="R_analysis.html#cb178-1" tabindex="-1"></a><span class="co"># install.packages(&quot;skimr&quot;)</span></span>
<span id="cb178-2"><a href="R_analysis.html#cb178-2" tabindex="-1"></a><span class="fu">library</span>(skimr)</span>
<span id="cb178-3"><a href="R_analysis.html#cb178-3" tabindex="-1"></a><span class="fu">skim</span>(whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-40">Table 14.1: </span>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">whr_new$Happiness Score</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">157</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">numeric</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<colgroup>
<col width="18%" />
<col width="12%" />
<col width="18%" />
<col width="6%" />
<col width="6%" />
<col width="5%" />
<col width="6%" />
<col width="6%" />
<col width="5%" />
<col width="6%" />
<col width="7%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">data</td>
<td align="right">5</td>
<td align="right">0.97</td>
<td align="right">5.32</td>
<td align="right">1.11</td>
<td align="right">2.9</td>
<td align="right">4.39</td>
<td align="right">5.28</td>
<td align="right">6.1</td>
<td align="right">7.53</td>
<td align="left">▂▆▇▇▃</td>
</tr>
</tbody>
</table>
</div>
<div id="aggregate" class="section level3 hasAnchor" number="14.8.2">
<h3><span class="header-section-number">14.8.2</span> Агрегация данных<a href="R_analysis.html#aggregate" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Что произошло, когда мы смотрели частоту выпадения значений с помощью <code>table()</code>? Данные сгруппировались по значениям переменной <code>Region</code>, которую мы указали, и было посчитано количество значений в каждой группе. Когда мы группируем данные по значениям переменной и производим какой-либо расчет для группы, это называется <strong>агрегацией</strong> данных.</p>
<p>Это полезно, чтобы посчитать те же описательные статистики по группам, например, посчитаем среднее для переменных Freedom и Trust в зависимости от региона:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="R_analysis.html#cb179-1" tabindex="-1"></a>whr_new <span class="sc">%&gt;%</span></span>
<span id="cb179-2"><a href="R_analysis.html#cb179-2" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb179-3"><a href="R_analysis.html#cb179-3" tabindex="-1"></a>  <span class="fu">group_by</span>(Region) <span class="sc">%&gt;%</span></span>
<span id="cb179-4"><a href="R_analysis.html#cb179-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_score =</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>))</span></code></pre></div>
<pre><code>## # A tibble: 8 × 2
##   Region                          mean_score
##   &lt;chr&gt;                                &lt;dbl&gt;
## 1 Central and Eastern Europe            5.40
## 2 Eastern Asia                          5.62
## 3 Latin America and Caribbean           6.01
## 4 Middle East and Northern Africa       5.39
## 5 Southeastern Asia                     5.16
## 6 Southern Asia                         4.56
## 7 Sub-Saharan Africa                    4.16
## 8 Western Europe                        6.55</code></pre>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="R_analysis.html#cb181-1" tabindex="-1"></a>whr_new <span class="sc">%&gt;%</span></span>
<span id="cb181-2"><a href="R_analysis.html#cb181-2" tabindex="-1"></a>  <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span></span>
<span id="cb181-3"><a href="R_analysis.html#cb181-3" tabindex="-1"></a>  <span class="fu">group_by</span>(Region) <span class="sc">%&gt;%</span></span>
<span id="cb181-4"><a href="R_analysis.html#cb181-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">mean_score =</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>), <span class="at">mean_freedom =</span> <span class="fu">mean</span>(Freedom),</span>
<span id="cb181-5"><a href="R_analysis.html#cb181-5" tabindex="-1"></a>            <span class="at">mean_trust =</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">Trust (Government Corruption)</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb181-6"><a href="R_analysis.html#cb181-6" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_score))</span></code></pre></div>
<pre><code>## # A tibble: 8 × 4
##   Region                          mean_score mean_freedom mean_trust
##   &lt;chr&gt;                                &lt;dbl&gt;        &lt;dbl&gt;      &lt;dbl&gt;
## 1 Western Europe                        6.55        0.452     0.213 
## 2 Latin America and Caribbean           6.01        0.419     0.105 
## 3 Eastern Asia                          5.62        0.387     0.118 
## 4 Central and Eastern Europe            5.40        0.292     0.0770
## 5 Middle East and Northern Africa       5.39        0.316     0.178 
## 6 Southeastern Asia                     5.16        0.495     0.124 
## 7 Southern Asia                         4.56        0.350     0.105 
## 8 Sub-Saharan Africa                    4.16        0.324     0.125</code></pre>
</div>
</div>
<div id="visualization" class="section level2 hasAnchor" number="14.9">
<h2><span class="header-section-number">14.9</span> Визуализации<a href="R_analysis.html#visualization" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Мы уже строили простенькие визуализации – простую гистограмму и простой график плотноти веростности средствами базового R.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="R_analysis.html#cb183-1" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="R_analysis.html#cb184-1" tabindex="-1"></a><span class="fu">hist</span>(whr_new<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-42-2.png" width="672" /></p>
<p>Эти визуализации верны, но они стандартные и выглядят не очень красиво. А меж тем визуализации очень важны – от их качества зависит понятность представления данных, с помощью визуилизаций можно даже манипулировать данными. В скриптовых языках огромное количество инструментов для работы с визуализациями. В питоне это matplotlib. А теперь добро пожаловать в ggplot2 – вселенную графиков в R <a href="https://ggplot2.tidyverse.org/" class="uri">https://ggplot2.tidyverse.org/</a></p>
<p>Например, можно нарисовать такой <a href="https://www.google.com/url?sa=i&amp;url=https%3A%2F%2Fadrienne-marshall.github.io%2Fggplot2_workshop%2F&amp;psig=AOvVaw1y2l2bObt_HK2KcP7m_73h&amp;ust=1676402334991000&amp;source=images&amp;cd=vfe&amp;ved=0CBAQjRxqFwoTCNihzL-bk_0CFQAAAAAdAAAAABAJ">график</a>, или <a href="https://edaoud.com/assets/img/articles/maps-ggplot2/map_1.png">такой</a>. Все это достигается средствами пакета <code>ggplot2</code>, который уже интегрирован в <code>tidyverse</code>.</p>
<p>“gg” в названии пакета означает Grammar of graphics. Подробно можно почитать, например, у Ивана Позднякова <a href="https://pozdniakov.github.io/tidy_stats/230-ggplot2.html" class="uri">https://pozdniakov.github.io/tidy_stats/230-ggplot2.html</a></p>
<p>Принцип состоит из рисовки графиком по слоям.
Обязательные слои:</p>
<ul>
<li>данные (data)</li>
<li>эстетики (aes) или mapping – то, как наши данные “натягиваются” на график</li>
<li>геомы (geom) – геометрические объекты, которые будем рисовать (например, гистограмма или барплот)</li>
</ul>
<p>Вспомогательные слои:</p>
<ul>
<li>статистики (stats) – нужно ли посчитать какие-то агрегированные статистики прямо на графике</li>
<li>система координат (coord) – можно повернуть систему координат на 90 градусов или вообще заменить ее на полярную</li>
<li>темы (theme) – системы оформления, одно из самых приятных</li>
</ul>
<p align="center">
<img src="docs/images/gglayers.png" width="80%" style="display: block; margin: auto;" />
Изображение из <a href="https://link.springer.com/book/10.1007/0-387-28695-0">The Grammar of Graphics</a>
</p>
<p>ggplot отлично интегрируется с тайдиверс, но он появился, оформился и распространился раньше, поэтому вместо значка пайпа <code>%&gt;%</code> там <code>+</code>.
Нарисуем ту же гистограмму, но уже покрасивее:</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="R_analysis.html#cb185-1" tabindex="-1"></a>whr_new <span class="sc">%&gt;%</span> </span>
<span id="cb185-2"><a href="R_analysis.html#cb185-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb185-3"><a href="R_analysis.html#cb185-3" tabindex="-1"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb185-4"><a href="R_analysis.html#cb185-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 5 rows containing non-finite values (`stat_bin()`).</code></pre>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="R_analysis.html#cb187-1" tabindex="-1"></a><span class="co"># Можем регулировать ширину &quot;кирпичика&quot;</span></span>
<span id="cb187-2"><a href="R_analysis.html#cb187-2" tabindex="-1"></a></span>
<span id="cb187-3"><a href="R_analysis.html#cb187-3" tabindex="-1"></a>whr_new <span class="sc">%&gt;%</span> </span>
<span id="cb187-4"><a href="R_analysis.html#cb187-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb187-5"><a href="R_analysis.html#cb187-5" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb187-6"><a href="R_analysis.html#cb187-6" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 5 rows containing non-finite values (`stat_bin()`).</code></pre>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-44-2.png" width="672" /></p>
<p>Можем менять цвета у двух вещей: заливки и контура, как и обычно у фигур в паверпоинте или ворде. Для заливки используется аругмент fill, для контура – color. У некоторых геомов есть только контур – как, например, диаграмма рассеяния, так как точки не имеют заливки.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="R_analysis.html#cb189-1" tabindex="-1"></a><span class="co"># раскрасим заливку (fill) в розовый, а линии (color) в фиолетовый</span></span>
<span id="cb189-2"><a href="R_analysis.html#cb189-2" tabindex="-1"></a><span class="co"># можем использовать не слова вроде pink и violet, а коды цветов в 16-ричной системе, например &quot;#355C7D&quot;</span></span>
<span id="cb189-3"><a href="R_analysis.html#cb189-3" tabindex="-1"></a>whr_new <span class="sc">%&gt;%</span></span>
<span id="cb189-4"><a href="R_analysis.html#cb189-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb189-5"><a href="R_analysis.html#cb189-5" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;pink&quot;</span>, <span class="at">color =</span> <span class="st">&quot;violet&quot;</span>, <span class="at">binwidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb189-6"><a href="R_analysis.html#cb189-6" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 5 rows containing non-finite values (`stat_bin()`).</code></pre>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="R_analysis.html#cb191-1" tabindex="-1"></a><span class="co"># добавим 50% прозрачности</span></span>
<span id="cb191-2"><a href="R_analysis.html#cb191-2" tabindex="-1"></a>whr_new <span class="sc">%&gt;%</span></span>
<span id="cb191-3"><a href="R_analysis.html#cb191-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb191-4"><a href="R_analysis.html#cb191-4" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">fill =</span> <span class="st">&quot;pink&quot;</span>, <span class="at">color =</span> <span class="st">&quot;violet&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">binwidth =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb191-5"><a href="R_analysis.html#cb191-5" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 5 rows containing non-finite values (`stat_bin()`).</code></pre>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-45-2.png" width="672" /></p>
<p>Построим аналогичный график плотности вероятности</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="R_analysis.html#cb193-1" tabindex="-1"></a>whr_new <span class="sc">%&gt;%</span> </span>
<span id="cb193-2"><a href="R_analysis.html#cb193-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb193-3"><a href="R_analysis.html#cb193-3" tabindex="-1"></a>  <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb193-4"><a href="R_analysis.html#cb193-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 5 rows containing non-finite values (`stat_density()`).</code></pre>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="R_analysis.html#cb195-1" tabindex="-1"></a><span class="co"># раскрасим линию в фиолетовый</span></span>
<span id="cb195-2"><a href="R_analysis.html#cb195-2" tabindex="-1"></a>whr_new <span class="sc">%&gt;%</span></span>
<span id="cb195-3"><a href="R_analysis.html#cb195-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb195-4"><a href="R_analysis.html#cb195-4" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">&quot;violet&quot;</span>) <span class="sc">+</span></span>
<span id="cb195-5"><a href="R_analysis.html#cb195-5" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 5 rows containing non-finite values (`stat_density()`).</code></pre>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-46-2.png" width="672" /></p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="R_analysis.html#cb197-1" tabindex="-1"></a><span class="co"># поменяем тип линии на пунктир (соответствие типов линий и кодов</span></span>
<span id="cb197-2"><a href="R_analysis.html#cb197-2" tabindex="-1"></a><span class="co"># можно погуглить или посмотреть в читшите)</span></span>
<span id="cb197-3"><a href="R_analysis.html#cb197-3" tabindex="-1"></a>whr_new <span class="sc">%&gt;%</span></span>
<span id="cb197-4"><a href="R_analysis.html#cb197-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb197-5"><a href="R_analysis.html#cb197-5" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">&quot;violet&quot;</span>, <span class="at">linetype =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb197-6"><a href="R_analysis.html#cb197-6" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 5 rows containing non-finite values (`stat_density()`).</code></pre>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-46-3.png" width="672" /></p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="R_analysis.html#cb199-1" tabindex="-1"></a><span class="co">#добавили заливку и прозрачность</span></span>
<span id="cb199-2"><a href="R_analysis.html#cb199-2" tabindex="-1"></a>whr_new <span class="sc">%&gt;%</span></span>
<span id="cb199-3"><a href="R_analysis.html#cb199-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb199-4"><a href="R_analysis.html#cb199-4" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">&quot;violet&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;pink&quot;</span>, <span class="at">linetype =</span> <span class="dv">5</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb199-5"><a href="R_analysis.html#cb199-5" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 5 rows containing non-finite values (`stat_density()`).</code></pre>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-46-4.png" width="672" /></p>
<p>Все эти графики были описательными – для исследования одной переменной. А теперь выведем диаграмму рассеяния, в которой показано распределение одной переменной в заивисимости от значений другой.</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="R_analysis.html#cb201-1" tabindex="-1"></a>whr_new <span class="sc">%&gt;%</span></span>
<span id="cb201-2"><a href="R_analysis.html#cb201-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>, <span class="at">y =</span> Freedom)) <span class="sc">+</span></span>
<span id="cb201-3"><a href="R_analysis.html#cb201-3" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb201-4"><a href="R_analysis.html#cb201-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 5 rows containing missing values (`geom_point()`).</code></pre>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-47-1.png" width="672" /></p>
<p>И можем даже раскрасить точки на этом графике в зависимости от третьей переменной! Например, региона. Все ровно так же, как и с цветами до этого: если хотим залить фигуру в зависимости от значений третьей переменной, то для раскраски используется аругмент fill, если покрасить контур – то color (как контур и заливка в ворде или паверпоинт). Но с той разницей, что теперь fill color задаются <strong>внутри аестетик</strong>, так как это все еще про “натягивание совы на глобус”, то есть наших данных на график.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="R_analysis.html#cb203-1" tabindex="-1"></a>whr_new <span class="sc">%&gt;%</span></span>
<span id="cb203-2"><a href="R_analysis.html#cb203-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>, <span class="at">y =</span> Freedom, <span class="at">color =</span> Region)) <span class="sc">+</span></span>
<span id="cb203-3"><a href="R_analysis.html#cb203-3" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb203-4"><a href="R_analysis.html#cb203-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 5 rows containing missing values (`geom_point()`).</code></pre>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-48-1.png" width="672" /></p>
</div>
<div id="tasks_sem4" class="section level2 hasAnchor" number="14.10">
<h2><span class="header-section-number">14.10</span> Задания после семинара 4<a href="R_analysis.html#tasks_sem4" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Для заданий используется датасет <a href="https://raw.githubusercontent.com/elenary/StatsForDA/main/2016-2.csv"><code>2016-2</code></a></p>
<ol style="list-style-type: decimal">
<li>Посчитайте, сколько всего суммарно NA в колонках <code>Economy (GDP per Capita)</code>, <code>Family</code>, <code>Health (Life Expectancy)</code>, <code>Freedom</code>, <code>Trust (Government Corruption)</code>, <code>Generosity</code> <em>(задание можно сделать разными способами, подойдет любой, дающий верный овтет)</em></li>
<li>Посчитайте описательные статистики для колонок <code>Economy (GDP per Capita)</code>, <code>Family</code>, <code>Freedom</code>: среднее, медиану, моду, стандартное отклонение, дисперсию и межквартильный размах, а также <em>(только для тех, кто работает в R)</em> вычислите значения для 1 и 3 квартилей. Ответы должны быть отличны от <code>NA</code> <em>(один из способов узнать значения по квартилям – например, с помощью отдельных общих функций для описательных статистик)</em>.</li>
<li>Используя созданную в <a href="R_analysis.html#tasks_sem3">прошлой домашке</a> колонку co значениями <code>upper</code> и <code>lower</code> в зависимости от значений <code>Happiness Score</code>, посчитайте среднее и стандартное отклонения внутри этих групп (<code>upper</code> и <code>lower</code>) для колонок <code>Economy (GDP per Capita)</code>, <code>Family</code>, <code>Freedom</code>. <em>(Только для тех, кто работает в R)</em> Сравните полученные средние значения со значениями для 1 и 3 квартилей из предыдущего задания. Что можно сказать про них?</li>
<li>Постройте графики плотности вероятности для переменных <code>Family</code> и <code>Freedom</code>, <em>(только для тех, кто работает в R)</em> используя как минимум 2 отличиные от дефолтных настройки (тему, цвет, тип линии, прозрачность и тд.) Примеры можно погуглить или посмотреть в <a href="https://github.com/rstudio/cheatsheets/blob/main/data-visualization.pdf">читшите</a></li>
<li>Постройте диаграмму рассеяния для переменной <code>Family</code> по переменной <code>Freedom</code> и <em>(только для тех, кто работает в R)</em> раскрасьте точки в зависимости от значений переменной с upper и lower, созданной в прошлой домашке.</li>
<li>Посчитайте коэффициент корреляции между переменными <code>Family</code> и <code>Freedom</code>.</li>
</ol>
</div>
<div id="проверка-гипотез" class="section level2 hasAnchor" number="14.11">
<h2><span class="header-section-number">14.11</span> Проверка гипотез<a href="R_analysis.html#проверка-гипотез" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Пришло время перейти к тому, ради чего мы изучали статистику весь прошлый семестр – проверке гипотез.</p>
<p>Я собрала в один датасет все новые колонки, которые мы создавали, чтобы использовать их, если понадобятся.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="R_analysis.html#cb205-1" tabindex="-1"></a>whr <span class="sc">%&gt;%</span></span>
<span id="cb205-2"><a href="R_analysis.html#cb205-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">&quot;top20&quot;</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="st">`</span><span class="at">Happiness Rank</span><span class="st">`</span><span class="sc">&lt;=</span><span class="dv">20</span>, <span class="st">&quot;hehe&quot;</span>, <span class="st">&quot;not hehe&quot;</span>),</span>
<span id="cb205-3"><a href="R_analysis.html#cb205-3" tabindex="-1"></a>         <span class="st">&quot;mean_position&quot;</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span><span class="sc">&gt;=</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="st">&quot;upper&quot;</span>, <span class="st">&quot;lower&quot;</span>)) <span class="ot">-&gt;</span> whr_tests</span></code></pre></div>
<p>Перед применением статистических тестов стоит повторить раздел про <a href="inference.html#inference">статистический вывод целиком</a> и <a href="inference.html#nhst">алгоритм тестирования гипотез в частности</a>. Мы не применяем тесты сразу! Сначала у нас должна быть осмысленная гипотеза, понимание о том, каковы <span class="math inline">\(H_0\)</span> и <span class="math inline">\(H_1\)</span>, выбранный уровень значимости <span class="math inline">\(\alpha\)</span> и рассчитанное на основании статистической мощности <span class="math inline">\(power\)</span> необходимое количество данных. Здесь мы работаем уже с готовыми данными, поэтому не можем влиять на количество данных, но все остальные пункты мы должны учитывать.</p>
<div id="корреляционный-тест-1" class="section level3 hasAnchor" number="14.11.1">
<h3><span class="header-section-number">14.11.1</span> Корреляционный тест<a href="R_analysis.html#корреляционный-тест-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Первое, с чем потренируемся – <a href="stats_criteria_linear.html#corr_test">корреляционный тест</a></p>
<p>Сначала проверяем допущения к применимости корреляционного теста</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb206-1"><a href="R_analysis.html#cb206-1" tabindex="-1"></a><span class="co">#Смотрим наличие линейной зависимости</span></span>
<span id="cb206-2"><a href="R_analysis.html#cb206-2" tabindex="-1"></a>whr_tests <span class="sc">%&gt;%</span></span>
<span id="cb206-3"><a href="R_analysis.html#cb206-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Family, <span class="at">y =</span> <span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb206-4"><a href="R_analysis.html#cb206-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>) <span class="sc">+</span></span>
<span id="cb206-5"><a href="R_analysis.html#cb206-5" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-50-1.png" width="672" /></p>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="R_analysis.html#cb207-1" tabindex="-1"></a><span class="co"># смотрим, как распределены переменные, которые хотим прокоррелировать</span></span>
<span id="cb207-2"><a href="R_analysis.html#cb207-2" tabindex="-1"></a></span>
<span id="cb207-3"><a href="R_analysis.html#cb207-3" tabindex="-1"></a>whr_tests <span class="sc">%&gt;%</span></span>
<span id="cb207-4"><a href="R_analysis.html#cb207-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Family, <span class="at">y =</span> <span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb207-5"><a href="R_analysis.html#cb207-5" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>) <span class="sc">+</span></span>
<span id="cb207-6"><a href="R_analysis.html#cb207-6" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-50-2.png" width="672" /></p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="R_analysis.html#cb208-1" tabindex="-1"></a>whr_tests <span class="sc">%&gt;%</span></span>
<span id="cb208-2"><a href="R_analysis.html#cb208-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb208-3"><a href="R_analysis.html#cb208-3" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>) <span class="sc">+</span></span>
<span id="cb208-4"><a href="R_analysis.html#cb208-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-50-3.png" width="672" /></p>
<div class="sourceCode" id="cb209"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb209-1"><a href="R_analysis.html#cb209-1" tabindex="-1"></a>whr_tests <span class="sc">%&gt;%</span></span>
<span id="cb209-2"><a href="R_analysis.html#cb209-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span>Family)) <span class="sc">+</span></span>
<span id="cb209-3"><a href="R_analysis.html#cb209-3" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>) <span class="sc">+</span></span>
<span id="cb209-4"><a href="R_analysis.html#cb209-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-50-4.png" width="672" /></p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="R_analysis.html#cb210-1" tabindex="-1"></a>whr_tests <span class="sc">%&gt;%</span></span>
<span id="cb210-2"><a href="R_analysis.html#cb210-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">sample =</span> Family)) <span class="sc">+</span></span>
<span id="cb210-3"><a href="R_analysis.html#cb210-3" tabindex="-1"></a>  <span class="fu">stat_qq</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>) <span class="sc">+</span></span>
<span id="cb210-4"><a href="R_analysis.html#cb210-4" tabindex="-1"></a>  <span class="fu">geom_qq_line</span>() <span class="sc">+</span></span>
<span id="cb210-5"><a href="R_analysis.html#cb210-5" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-50-5.png" width="672" /></p>
<div class="sourceCode" id="cb211"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb211-1"><a href="R_analysis.html#cb211-1" tabindex="-1"></a><span class="co"># Видим, что переменная Family распрееделена доволньо сильно отлично от нормального, на всякий случай делаем корреляцию Спирмена вместо Пирсона</span></span>
<span id="cb211-2"><a href="R_analysis.html#cb211-2" tabindex="-1"></a></span>
<span id="cb211-3"><a href="R_analysis.html#cb211-3" tabindex="-1"></a><span class="fu">cor.test</span>(whr_tests<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>, whr_tests<span class="sc">$</span>Family, <span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>)</span></code></pre></div>
<pre><code>## Warning in cor.test.default(whr_tests$`Happiness Score`, whr_tests$Family, :
## Cannot compute exact p-value with ties</code></pre>
<pre><code>## 
##  Spearman&#39;s rank correlation rho
## 
## data:  whr_tests$`Happiness Score` and whr_tests$Family
## S = 153450, p-value &lt; 2.2e-16
## alternative hypothesis: true rho is not equal to 0
## sample estimates:
##      rho 
## 0.762077</code></pre>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="R_analysis.html#cb214-1" tabindex="-1"></a>whr_tests <span class="sc">%&gt;%</span></span>
<span id="cb214-2"><a href="R_analysis.html#cb214-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Freedom, <span class="at">y =</span> <span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb214-3"><a href="R_analysis.html#cb214-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>) <span class="sc">+</span></span>
<span id="cb214-4"><a href="R_analysis.html#cb214-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-50-6.png" width="672" /></p>
<div class="sourceCode" id="cb215"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb215-1"><a href="R_analysis.html#cb215-1" tabindex="-1"></a>whr_tests <span class="sc">%&gt;%</span></span>
<span id="cb215-2"><a href="R_analysis.html#cb215-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Freedom)) <span class="sc">+</span></span>
<span id="cb215-3"><a href="R_analysis.html#cb215-3" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>) <span class="sc">+</span></span>
<span id="cb215-4"><a href="R_analysis.html#cb215-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-50-7.png" width="672" /></p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="R_analysis.html#cb216-1" tabindex="-1"></a>whr_tests <span class="sc">%&gt;%</span></span>
<span id="cb216-2"><a href="R_analysis.html#cb216-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">sample =</span> Freedom)) <span class="sc">+</span></span>
<span id="cb216-3"><a href="R_analysis.html#cb216-3" tabindex="-1"></a>  <span class="fu">stat_qq</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>) <span class="sc">+</span></span>
<span id="cb216-4"><a href="R_analysis.html#cb216-4" tabindex="-1"></a>  <span class="fu">geom_qq_line</span>() <span class="sc">+</span></span>
<span id="cb216-5"><a href="R_analysis.html#cb216-5" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-50-8.png" width="672" /></p>
<div class="sourceCode" id="cb217"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb217-1"><a href="R_analysis.html#cb217-1" tabindex="-1"></a><span class="co"># А здесь можно корреляцию Пирсона</span></span>
<span id="cb217-2"><a href="R_analysis.html#cb217-2" tabindex="-1"></a><span class="fu">cor.test</span>(whr_tests<span class="sc">$</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>, whr_tests<span class="sc">$</span>Family, <span class="at">method =</span> <span class="st">&quot;pearson&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Pearson&#39;s product-moment correlation
## 
## data:  whr_tests$`Happiness Score` and whr_tests$Family
## t = 13.667, df = 155, p-value &lt; 2.2e-16
## alternative hypothesis: true correlation is not equal to 0
## 95 percent confidence interval:
##  0.6589122 0.8029161
## sample estimates:
##       cor 
## 0.7392516</code></pre>
<p>Как это проинтепретировать? Вспоминаем все, что мы изучали про статистические критерии в прошлом семестре.</p>
<p>Кстати, в языках программирования числа часто записываются через экспоненциальную нотацию виде <span class="math inline">\(e^-10\)</span> – это удобно для математического вида, какая цифра идет первой после множества нулей, но неудобно для интерпретации. Чтобы ее убрать, можно в любом месте в Р выполнить операцию</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb219-1"><a href="R_analysis.html#cb219-1" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>)</span></code></pre></div>
<p>Корреляционные матрицы</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="R_analysis.html#cb220-1" tabindex="-1"></a><span class="co"># корреляция по простому</span></span>
<span id="cb220-2"><a href="R_analysis.html#cb220-2" tabindex="-1"></a>whr_tests <span class="sc">%&gt;%</span></span>
<span id="cb220-3"><a href="R_analysis.html#cb220-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span><span class="sc">:</span>Generosity, <span class="sc">-</span><span class="st">`</span><span class="at">Upper Confidence Interval</span><span class="st">`</span>, <span class="sc">-</span><span class="st">`</span><span class="at">Lower Confidence Interval</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb220-4"><a href="R_analysis.html#cb220-4" tabindex="-1"></a>  <span class="fu">cor</span>(<span class="at">method =</span> <span class="st">&quot;spearman&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb220-5"><a href="R_analysis.html#cb220-5" tabindex="-1"></a>  <span class="fu">round</span>(<span class="dv">2</span>) </span></code></pre></div>
<pre><code>##                               Happiness Score Economy (GDP per Capita) Family
## Happiness Score                          1.00                     0.81   0.76
## Economy (GDP per Capita)                 0.81                     1.00   0.70
## Family                                   0.76                     0.70   1.00
## Health (Life Expectancy)                 0.77                     0.86   0.62
## Freedom                                  0.56                     0.40   0.51
## Trust (Government Corruption)            0.31                     0.22   0.18
## Generosity                               0.15                     0.00   0.12
##                               Health (Life Expectancy) Freedom
## Happiness Score                                   0.77    0.56
## Economy (GDP per Capita)                          0.86    0.40
## Family                                            0.62    0.51
## Health (Life Expectancy)                          1.00    0.35
## Freedom                                           0.35    1.00
## Trust (Government Corruption)                     0.17    0.47
## Generosity                                        0.08    0.40
##                               Trust (Government Corruption) Generosity
## Happiness Score                                        0.31       0.15
## Economy (GDP per Capita)                               0.22       0.00
## Family                                                 0.18       0.12
## Health (Life Expectancy)                               0.17       0.08
## Freedom                                                0.47       0.40
## Trust (Government Corruption)                          1.00       0.25
## Generosity                                             0.25       1.00</code></pre>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="R_analysis.html#cb222-1" tabindex="-1"></a><span class="fu">library</span>(<span class="st">&quot;Hmisc&quot;</span>)</span>
<span id="cb222-2"><a href="R_analysis.html#cb222-2" tabindex="-1"></a></span>
<span id="cb222-3"><a href="R_analysis.html#cb222-3" tabindex="-1"></a>whr_tests <span class="sc">%&gt;%</span></span>
<span id="cb222-4"><a href="R_analysis.html#cb222-4" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span><span class="sc">:</span>Generosity, <span class="sc">-</span><span class="st">`</span><span class="at">Upper Confidence Interval</span><span class="st">`</span>, <span class="sc">-</span><span class="st">`</span><span class="at">Lower Confidence Interval</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb222-5"><a href="R_analysis.html#cb222-5" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span></span>
<span id="cb222-6"><a href="R_analysis.html#cb222-6" tabindex="-1"></a>  <span class="fu">rcorr</span>() <span class="ot">-&gt;</span> whr_cor</span>
<span id="cb222-7"><a href="R_analysis.html#cb222-7" tabindex="-1"></a></span>
<span id="cb222-8"><a href="R_analysis.html#cb222-8" tabindex="-1"></a>whr_cor<span class="sc">$</span>r</span></code></pre></div>
<pre><code>##                               Happiness Score Economy (GDP per Capita)
## Happiness Score                     1.0000000               0.79032202
## Economy (GDP per Capita)            0.7903220               1.00000000
## Family                              0.7392516               0.66953969
## Health (Life Expectancy)            0.7653843               0.83706723
## Freedom                             0.5668267               0.36228285
## Trust (Government Corruption)       0.4020322               0.29418478
## Generosity                          0.1568478              -0.02553066
##                                   Family Health (Life Expectancy)   Freedom
## Happiness Score               0.73925158               0.76538433 0.5668267
## Economy (GDP per Capita)      0.66953969               0.83706723 0.3622828
## Family                        1.00000000               0.58837678 0.4502082
## Health (Life Expectancy)      0.58837678               1.00000000 0.3411993
## Freedom                       0.45020820               0.34119929 1.0000000
## Trust (Government Corruption) 0.21356094               0.24958329 0.5020540
## Generosity                    0.08962885               0.07598731 0.3617513
##                               Trust (Government Corruption)  Generosity
## Happiness Score                                   0.4020322  0.15684780
## Economy (GDP per Capita)                          0.2941848 -0.02553066
## Family                                            0.2135609  0.08962885
## Health (Life Expectancy)                          0.2495833  0.07598731
## Freedom                                           0.5020540  0.36175133
## Trust (Government Corruption)                     1.0000000  0.30592986
## Generosity                                        0.3059299  1.00000000</code></pre>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="R_analysis.html#cb224-1" tabindex="-1"></a><span class="fu">library</span>(corrplot)</span>
<span id="cb224-2"><a href="R_analysis.html#cb224-2" tabindex="-1"></a></span>
<span id="cb224-3"><a href="R_analysis.html#cb224-3" tabindex="-1"></a><span class="fu">corrplot</span>(whr_cor<span class="sc">$</span>r, <span class="at">method=</span><span class="st">&quot;circle&quot;</span>)</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-52-1.png" width="672" /></p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="R_analysis.html#cb225-1" tabindex="-1"></a><span class="co"># corrplot(whr_cor$r, p.mat = whr_cor$P, sig.level = 0.05, insig = &quot;blank&quot;)</span></span>
<span id="cb225-2"><a href="R_analysis.html#cb225-2" tabindex="-1"></a><span class="fu">heatmap</span>(whr_cor<span class="sc">$</span>r)</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-52-2.png" width="672" /></p>
</div>
<div id="т-тест" class="section level3 hasAnchor" number="14.11.2">
<h3><span class="header-section-number">14.11.2</span> Т-тест<a href="R_analysis.html#т-тест" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Теперь проверим гипотезу о том, что уровень счастья <code>Happiness Score</code> отличается в Восточной и Западной Европе. Для этого сначала нам нужно отфильтровать только те данные, которые соответствуют регионам <code>Central and Eastern Europe</code> и <code>Western Europe</code>. Это тот самый этап предобработки данных, когда прежде чем применять статистчиеские тесты, нам нужно подготовить данные.</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="R_analysis.html#cb226-1" tabindex="-1"></a>whr_tests <span class="sc">%&gt;%</span></span>
<span id="cb226-2"><a href="R_analysis.html#cb226-2" tabindex="-1"></a>  <span class="fu">filter</span>(Region <span class="sc">==</span> <span class="st">&quot;Central and Eastern Europe&quot;</span> <span class="sc">|</span> Region <span class="sc">==</span> <span class="st">&quot;Western Europe&quot;</span>) <span class="ot">-&gt;</span> whr_ttest</span></code></pre></div>
<p>Идем по <a href="inference.html#nhst">алгоритму NHST</a>: фомулируем нулевую и альтернативную гипотезы, выбираем уровень значимости, доходим до выбора статистического теста, и выбираем т-тест. Теперь <a href="stats_criteria_ttest_anova.html#ttest">проверяем допущения для т-теста</a></p>
<p>Для т-теста нам важно допущение, что ЗП распределена нормально или близко к нормальному (распределение в целом симметрично, нет особых выбросов). Проверим это.</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="R_analysis.html#cb227-1" tabindex="-1"></a><span class="co"># skimr::skim(whr_tests$`Happiness Score`)</span></span>
<span id="cb227-2"><a href="R_analysis.html#cb227-2" tabindex="-1"></a></span>
<span id="cb227-3"><a href="R_analysis.html#cb227-3" tabindex="-1"></a>whr_ttest <span class="sc">%&gt;%</span></span>
<span id="cb227-4"><a href="R_analysis.html#cb227-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb227-5"><a href="R_analysis.html#cb227-5" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>) <span class="sc">+</span></span>
<span id="cb227-6"><a href="R_analysis.html#cb227-6" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-54-1.png" width="672" /></p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="R_analysis.html#cb228-1" tabindex="-1"></a>whr_ttest <span class="sc">%&gt;%</span></span>
<span id="cb228-2"><a href="R_analysis.html#cb228-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">sample =</span> <span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb228-3"><a href="R_analysis.html#cb228-3" tabindex="-1"></a>  <span class="fu">stat_qq</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>) <span class="sc">+</span></span>
<span id="cb228-4"><a href="R_analysis.html#cb228-4" tabindex="-1"></a>  <span class="fu">geom_qq_line</span>() <span class="sc">+</span></span>
<span id="cb228-5"><a href="R_analysis.html#cb228-5" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-54-2.png" width="672" /></p>
<p>По этой картине в целом можем считать, что ЗП <code>Happiness Score</code> распределена близко к нормальному распределению. Значит, мы можем не использовать непараметрические аналоги т-теста и проводить самый обычный т-тест!</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="R_analysis.html#cb229-1" tabindex="-1"></a><span class="fu">t.test</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span> <span class="sc">~</span> Region, <span class="at">data =</span> whr_ttest, <span class="at">alternative =</span> <span class="st">&quot;less&quot;</span>, <span class="at">paired =</span> <span class="cn">FALSE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  Happiness Score by Region
## t = -6.4412, df = 35.349, p-value = 0.00000009733
## alternative hypothesis: true difference in means between group Central and Eastern Europe and group Western Europe is less than 0
## 95 percent confidence interval:
##        -Inf -0.9701413
## sample estimates:
## mean in group Central and Eastern Europe 
##                                 5.370690 
##             mean in group Western Europe 
##                                 6.685667</code></pre>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="R_analysis.html#cb231-1" tabindex="-1"></a><span class="fu">t.test</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span> <span class="sc">~</span> Region, <span class="at">data =</span> whr_ttest, <span class="at">alternative =</span> <span class="st">&quot;two.sided&quot;</span>, <span class="at">paired =</span> <span class="cn">FALSE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  Happiness Score by Region
## t = -6.4412, df = 35.349, p-value = 0.0000001947
## alternative hypothesis: true difference in means between group Central and Eastern Europe and group Western Europe is not equal to 0
## 95 percent confidence interval:
##  -1.7292798 -0.9006742
## sample estimates:
## mean in group Central and Eastern Europe 
##                                 5.370690 
##             mean in group Western Europe 
##                                 6.685667</code></pre>
<p>Аргумент <code>alternative</code> обозначает, какова наша альтернативная гипотеза (противоположная нулевой): что средние в группых просто <em>не равны</em> или что среднее в одной из групп <em>меньше или больше,</em> чем в другой. Аргумент <code>paired</code> указывает, нужно ли проводить зависимый т-тест (когда мы используем одну и ту же выборку и делаем на ней несколько измерений). В данном случае, у нас независимые выборки, и зависимый т-тест не нужен.</p>
<p>Как проинтерпретировать эти результаты? Первое, на что мы смотрим – это p-value (колонка Pr(F)). Если оно меньше установленного уровня <span class="math inline">\(\alpha\)</span>, то мы говорим, что <em>отвергаем нулевую гипотезу, и мы получили статистически значимые резличия</em>. Если p-value больше или равно <span class="math inline">\(\alpha\)</span> – <em>у нас недостаточно свидетельств в пользу альтернативной гипотезы, и мы говорим, что не отвергаем нулевую гипотезу</em>.</p>
<p>Чем хороша форма записи через %&gt;% – мы можем сразу внутри одного пайпа и отфильтровать данные, и сделать т-тест! На том же самом примере, только теперь сразу отфильтруем данные и сделаем т-тест на отфильтрованных данных, без создания отдельного датасета <code>whr_ttest</code>:</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="R_analysis.html#cb233-1" tabindex="-1"></a>whr_tests <span class="sc">%&gt;%</span> </span>
<span id="cb233-2"><a href="R_analysis.html#cb233-2" tabindex="-1"></a>  <span class="fu">filter</span>(Region <span class="sc">==</span> <span class="st">&quot;Central and Eastern Europe&quot;</span> <span class="sc">|</span> Region <span class="sc">==</span> <span class="st">&quot;Western Europe&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb233-3"><a href="R_analysis.html#cb233-3" tabindex="-1"></a>  <span class="fu">t.test</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span> <span class="sc">~</span> Region, <span class="at">data =</span> ., <span class="at">alternative =</span> <span class="st">&quot;less&quot;</span>, <span class="at">paired =</span> <span class="cn">FALSE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)  <span class="co"># ставим точку вместо названия датасета</span></span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  Happiness Score by Region
## t = -6.4412, df = 35.349, p-value = 0.00000009733
## alternative hypothesis: true difference in means between group Central and Eastern Europe and group Western Europe is less than 0
## 95 percent confidence interval:
##        -Inf -0.9701413
## sample estimates:
## mean in group Central and Eastern Europe 
##                                 5.370690 
##             mean in group Western Europe 
##                                 6.685667</code></pre>
<p>Обратите внимание – в функции t.test данные стоят не на первом месте, как нам нужно для того, чтобы использовать нотацию пайпа. Но это довольно просто решается: в любой функции, чтобы использовать ее внутри пайпа, нужно поставить точку в том месте, куда мы хотим передать результат выполнения предыдущей строки пайпа.</p>
<p>Иногда бывает проще все-таки сделать больше действий, но последовательно, поэтому может пригодиться знать и другой вариант записи т-теста и его непараметрических аналогов – не через указание переменных из данных (обратите внимание – мы эксплицитно задавали аргумент <code>data</code>), а без указания данных, просто передав ему два вектора (я редко использую такой формат записи, но не потому, что он хуже – я это делаю для экономии времени, и чтобы не запутаться в созданных мной во время работы над учебником переменных):</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="R_analysis.html#cb235-1" tabindex="-1"></a><span class="co"># Фильтруем только те регионы, которые будем проверять</span></span>
<span id="cb235-2"><a href="R_analysis.html#cb235-2" tabindex="-1"></a></span>
<span id="cb235-3"><a href="R_analysis.html#cb235-3" tabindex="-1"></a>whr_tests <span class="sc">%&gt;%</span></span>
<span id="cb235-4"><a href="R_analysis.html#cb235-4" tabindex="-1"></a>  <span class="fu">filter</span>(Region <span class="sc">==</span> <span class="st">&quot;Central and Eastern Europe&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb235-5"><a href="R_analysis.html#cb235-5" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb235-6"><a href="R_analysis.html#cb235-6" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="ot">-&gt;</span> whr_tests_CEE</span>
<span id="cb235-7"><a href="R_analysis.html#cb235-7" tabindex="-1"></a></span>
<span id="cb235-8"><a href="R_analysis.html#cb235-8" tabindex="-1"></a>whr_tests <span class="sc">%&gt;%</span></span>
<span id="cb235-9"><a href="R_analysis.html#cb235-9" tabindex="-1"></a>  <span class="fu">filter</span>(Region <span class="sc">==</span> <span class="st">&quot;Western Europe&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb235-10"><a href="R_analysis.html#cb235-10" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb235-11"><a href="R_analysis.html#cb235-11" tabindex="-1"></a>  <span class="fu">pull</span>() <span class="ot">-&gt;</span> whr_tests_WE</span>
<span id="cb235-12"><a href="R_analysis.html#cb235-12" tabindex="-1"></a></span>
<span id="cb235-13"><a href="R_analysis.html#cb235-13" tabindex="-1"></a><span class="fu">var</span>(whr_tests_CEE)</span></code></pre></div>
<pre><code>## [1] 0.3485667</code></pre>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="R_analysis.html#cb237-1" tabindex="-1"></a><span class="fu">var</span>(whr_tests_WE)</span></code></pre></div>
<pre><code>## [1] 0.6228212</code></pre>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="R_analysis.html#cb239-1" tabindex="-1"></a><span class="fu">t.test</span>(whr_tests_CEE, whr_tests_WE, <span class="at">alternative =</span> <span class="st">&quot;less&quot;</span>, <span class="at">paired =</span> <span class="cn">FALSE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  whr_tests_CEE and whr_tests_WE
## t = -6.4412, df = 35.349, p-value = 0.00000009733
## alternative hypothesis: true difference in means is less than 0
## 95 percent confidence interval:
##        -Inf -0.9701413
## sample estimates:
## mean of x mean of y 
##  5.370690  6.685667</code></pre>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="R_analysis.html#cb241-1" tabindex="-1"></a><span class="fu">t.test</span>(whr_tests_CEE, whr_tests_WE, <span class="at">alternative =</span> <span class="st">&quot;less&quot;</span>, <span class="at">paired =</span> <span class="cn">FALSE</span>, <span class="at">var.equal =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  whr_tests_CEE and whr_tests_WE
## t = -6.4412, df = 35.349, p-value = 0.00000009733
## alternative hypothesis: true difference in means is less than 0
## 95 percent confidence interval:
##        -Inf -0.9701413
## sample estimates:
## mean of x mean of y 
##  5.370690  6.685667</code></pre>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="R_analysis.html#cb243-1" tabindex="-1"></a><span class="fu">t.test</span>(whr_tests_CEE, whr_tests_WE, <span class="at">alternative =</span> <span class="st">&quot;two.sided&quot;</span>, <span class="at">paired =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  whr_tests_CEE and whr_tests_WE
## t = -6.4412, df = 35.349, p-value = 0.0000001947
## alternative hypothesis: true difference in means is not equal to 0
## 95 percent confidence interval:
##  -1.7292798 -0.9006742
## sample estimates:
## mean of x mean of y 
##  5.370690  6.685667</code></pre>
<p>Построим визуализации</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="R_analysis.html#cb245-1" tabindex="-1"></a>whr_ttest <span class="sc">%&gt;%</span></span>
<span id="cb245-2"><a href="R_analysis.html#cb245-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Region, <span class="at">y =</span> <span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb245-3"><a href="R_analysis.html#cb245-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb245-4"><a href="R_analysis.html#cb245-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-58-1.png" width="672" /></p>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="R_analysis.html#cb246-1" tabindex="-1"></a><span class="co"># install.packages(&quot;viridis&quot;)</span></span>
<span id="cb246-2"><a href="R_analysis.html#cb246-2" tabindex="-1"></a><span class="co"># install.packages(&quot;wesanderson&quot;)</span></span>
<span id="cb246-3"><a href="R_analysis.html#cb246-3" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb246-4"><a href="R_analysis.html#cb246-4" tabindex="-1"></a><span class="fu">library</span>(wesanderson)</span>
<span id="cb246-5"><a href="R_analysis.html#cb246-5" tabindex="-1"></a></span>
<span id="cb246-6"><a href="R_analysis.html#cb246-6" tabindex="-1"></a>whr_ttest <span class="sc">%&gt;%</span></span>
<span id="cb246-7"><a href="R_analysis.html#cb246-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Region, <span class="at">y =</span> <span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>, <span class="at">fill =</span> Region)) <span class="sc">+</span></span>
<span id="cb246-8"><a href="R_analysis.html#cb246-8" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb246-9"><a href="R_analysis.html#cb246-9" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb246-10"><a href="R_analysis.html#cb246-10" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>()</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-58-2.png" width="672" /></p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="R_analysis.html#cb247-1" tabindex="-1"></a>whr_ttest <span class="sc">%&gt;%</span></span>
<span id="cb247-2"><a href="R_analysis.html#cb247-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Region, <span class="at">y =</span> <span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>, <span class="at">fill =</span> Region)) <span class="sc">+</span></span>
<span id="cb247-3"><a href="R_analysis.html#cb247-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb247-4"><a href="R_analysis.html#cb247-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb247-5"><a href="R_analysis.html#cb247-5" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">wes_palette</span>(<span class="st">&quot;Moonrise3&quot;</span>))</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-58-3.png" width="672" /></p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="R_analysis.html#cb248-1" tabindex="-1"></a>whr_ttest <span class="sc">%&gt;%</span></span>
<span id="cb248-2"><a href="R_analysis.html#cb248-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Region, <span class="at">y =</span> <span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>, <span class="at">fill =</span> Region)) <span class="sc">+</span></span>
<span id="cb248-3"><a href="R_analysis.html#cb248-3" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb248-4"><a href="R_analysis.html#cb248-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb248-5"><a href="R_analysis.html#cb248-5" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">wes_palette</span>(<span class="st">&quot;Moonrise3&quot;</span>))</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-58-4.png" width="672" /></p>
<p><strong>Непараметрические аналоги т-теста</strong></p>
<p>Что делать, если бы наши допущения о предположении нормальности ЗП не оправдались? Если бы в распределении были бы явные выбросы, они было бы сильно не симметричным и скошенным? Тогда нам нужно было бы проводить непараметрические аналоги т-теста – тест Уилкоксона или Манна-Уитни. Разберем их на примере проверки, что показатель социальной поддержки <code>Family</code> отличается в этих регионах <em>(на самом деле, в реальности тут скорее всего вполне можно было бы провести обычный т-тест – но более кривых переменных в этих данных не нашлось, поэтому смотреть использование непараметрических аналогов будем на них.</em></p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="R_analysis.html#cb249-1" tabindex="-1"></a>whr_tests <span class="sc">%&gt;%</span></span>
<span id="cb249-2"><a href="R_analysis.html#cb249-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span>Family)) <span class="sc">+</span></span>
<span id="cb249-3"><a href="R_analysis.html#cb249-3" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>) <span class="sc">+</span></span>
<span id="cb249-4"><a href="R_analysis.html#cb249-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-59-1.png" width="672" /></p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="R_analysis.html#cb250-1" tabindex="-1"></a>whr_tests <span class="sc">%&gt;%</span></span>
<span id="cb250-2"><a href="R_analysis.html#cb250-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">sample =</span> Family)) <span class="sc">+</span></span>
<span id="cb250-3"><a href="R_analysis.html#cb250-3" tabindex="-1"></a>  <span class="fu">stat_qq</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>) <span class="sc">+</span></span>
<span id="cb250-4"><a href="R_analysis.html#cb250-4" tabindex="-1"></a>  <span class="fu">geom_qq_line</span>() <span class="sc">+</span></span>
<span id="cb250-5"><a href="R_analysis.html#cb250-5" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-59-2.png" width="672" /></p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="R_analysis.html#cb251-1" tabindex="-1"></a><span class="co"># Все то же самое -- но функция называется не t.test(), a wilcox.test()</span></span>
<span id="cb251-2"><a href="R_analysis.html#cb251-2" tabindex="-1"></a></span>
<span id="cb251-3"><a href="R_analysis.html#cb251-3" tabindex="-1"></a><span class="fu">wilcox.test</span>(whr_ttest<span class="sc">$</span>Family <span class="sc">~</span> whr_ttest<span class="sc">$</span>Region, <span class="at">alternative =</span> <span class="st">&quot;less&quot;</span>, <span class="at">paired =</span> <span class="cn">FALSE</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span></code></pre></div>
<pre><code>## 
##  Wilcoxon rank sum exact test
## 
## data:  whr_ttest$Family by whr_ttest$Region
## W = 127, p-value = 0.0001618
## alternative hypothesis: true location shift is less than 0</code></pre>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="R_analysis.html#cb253-1" tabindex="-1"></a>whr_ttest <span class="sc">%&gt;%</span></span>
<span id="cb253-2"><a href="R_analysis.html#cb253-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Region, <span class="at">y =</span> Family, <span class="at">fill =</span> Region)) <span class="sc">+</span></span>
<span id="cb253-3"><a href="R_analysis.html#cb253-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb253-4"><a href="R_analysis.html#cb253-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb253-5"><a href="R_analysis.html#cb253-5" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">wes_palette</span>(<span class="st">&quot;Moonrise3&quot;</span>))</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-59-3.png" width="672" /></p>
</div>
</div>
<div id="tasks_sem5" class="section level2 hasAnchor" number="14.12">
<h2><span class="header-section-number">14.12</span> Задания после семинара 5<a href="R_analysis.html#tasks_sem5" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Мы уже освоили предобработку данных, и теперь совсем взрослые – можем взять менее чистенький, расширенный датасет того же World Happiness Report за 2019 <a href="https://github.com/elenary/StatsForDA/blob/main/Chapter2OnlineData2019.xls?raw=true" class="uri">https://github.com/elenary/StatsForDA/blob/main/Chapter2OnlineData2019.xls?raw=true</a>, а здесь можно почитать пододробнее про данные <a href="https://s3.amazonaws.com/happiness-report/2019/WHR19_Ch2A_Appendix1.pdf" class="uri">https://s3.amazonaws.com/happiness-report/2019/WHR19_Ch2A_Appendix1.pdf</a> (кстати, этот док, судя по всему, тоже сверстан в R).</p>
<p><em>(Если вы работаете в R)</em> Чтобы было удобнее с ним работать для проверки гипотез, я сделала его предобработку – при повторении попробуйте ее разобрать, что делает каждая строчка? Показалось ли что-то новым?</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="R_analysis.html#cb254-1" tabindex="-1"></a>whr <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;2016.csv&quot;</span>)</span>
<span id="cb254-2"><a href="R_analysis.html#cb254-2" tabindex="-1"></a>whr_2019 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xls</span>(<span class="st">&quot;Chapter2OnlineData2019.xls&quot;</span>)</span>
<span id="cb254-3"><a href="R_analysis.html#cb254-3" tabindex="-1"></a></span>
<span id="cb254-4"><a href="R_analysis.html#cb254-4" tabindex="-1"></a>whr_2019 <span class="sc">%&gt;%</span></span>
<span id="cb254-5"><a href="R_analysis.html#cb254-5" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Country name</span><span class="st">`</span><span class="sc">:</span><span class="st">`</span><span class="at">Negative affect</span><span class="st">`</span>) <span class="ot">-&gt;</span> whr_2019</span>
<span id="cb254-6"><a href="R_analysis.html#cb254-6" tabindex="-1"></a></span>
<span id="cb254-7"><a href="R_analysis.html#cb254-7" tabindex="-1"></a>whr <span class="sc">%&gt;%</span></span>
<span id="cb254-8"><a href="R_analysis.html#cb254-8" tabindex="-1"></a>  <span class="fu">select</span>(Country<span class="sc">:</span><span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb254-9"><a href="R_analysis.html#cb254-9" tabindex="-1"></a>  <span class="fu">right_join</span>(whr_2019, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Country&quot;</span> <span class="ot">=</span> <span class="st">&quot;Country name&quot;</span>), <span class="at">multiple =</span> <span class="st">&quot;last&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb254-10"><a href="R_analysis.html#cb254-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">&quot;top20&quot;</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="st">`</span><span class="at">Happiness Rank</span><span class="st">`</span><span class="sc">&lt;=</span><span class="dv">20</span>, <span class="st">&quot;hehe&quot;</span>, <span class="st">&quot;not hehe&quot;</span>),</span>
<span id="cb254-11"><a href="R_analysis.html#cb254-11" tabindex="-1"></a>         <span class="st">&quot;mean_position&quot;</span> <span class="ot">=</span> <span class="fu">ifelse</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span><span class="sc">&gt;=</span> <span class="fu">mean</span>(<span class="st">`</span><span class="at">Happiness Score</span><span class="st">`</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="st">&quot;upper&quot;</span>, <span class="st">&quot;lower&quot;</span>)) <span class="ot">-&gt;</span> whr_tests_hw</span>
<span id="cb254-12"><a href="R_analysis.html#cb254-12" tabindex="-1"></a></span>
<span id="cb254-13"><a href="R_analysis.html#cb254-13" tabindex="-1"></a><span class="co"># View(whr_tests)</span></span></code></pre></div>
<p><em>(Если вы работаете в Jamovi, ипользуйте любые данные – старые за 2016 год или новые за 2019)</em></p>
<ol style="list-style-type: decimal">
<li><p>На полученном датасете <code>whr_tests_hw</code> проведите полностью по всему алгоритму NHST хотя бы один корреляционные тест: выберете подходящие переменные, сформулируйте гипотезу, сформулируйте <span class="math inline">\(H_0\)</span> и <span class="math inline">\(H_1\)</span>, выберете уровень <span class="math inline">\(\alpha\)</span>, предобработайте данные, если нужно, и проведите корреляционный тест на выбранном уровне значимости. Проинтерпретируйте результаты: подтвердилась ли гипотеза?</p></li>
<li><p>На полученном датасете <code>whr_tests_hw</code> проведите полностью по всему алгоритму NHST хотя бы один т-тест или его непараметрический аналог: выберете подходящие переменные, сформулируйте гипотезу, сформулируйте <span class="math inline">\(H_0\)</span> и <span class="math inline">\(H_1\)</span>, выберете уровень <span class="math inline">\(\alpha\)</span>, определите, зависимые или независимые выборки, предобработайте данные, если нужно, и проведите тест сравнения средних на выбранном уровне значимости. Проинтерпретируйте результаты: подтвердилась ли гипотеза?</p></li>
</ol>
</div>
<div id="проверка-гипоте-2-anova-и-линейная-регрессия" class="section level2 hasAnchor" number="14.13">
<h2><span class="header-section-number">14.13</span> Проверка гипоте-2: ANOVA и линейная регрессия<a href="R_analysis.html#проверка-гипоте-2-anova-и-линейная-регрессия" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="anova-дисперсионный-анализ" class="section level3 hasAnchor" number="14.13.1">
<h3><span class="header-section-number">14.13.1</span> ANOVA (дисперсионный анализ)<a href="R_analysis.html#anova-дисперсионный-анализ" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Я хочу внести чуть разнообразия в наши данные, поэтому нашла еще одну <a href="#https://github.com/elenary/StatsForDA/blob/main/Chapter2OnlineData2019.xls?raw=true">табличку</a>, касающуюся World Happiness Report, можно почитать пододробнее <a href="#https://s3.amazonaws.com/happiness-report/2019/WHR19_Ch2A_Appendix1.pdf">здесь</a> (кстати, этот док, судя по всему, тоже сверстан в R).</p>
<p>Примерно так может выглядеть предобработка реальных (не самых чистых и кривых) данных: я объединяю две таблички (табличка за 2016 год и новая табличка за 2019 год) с помощью функции <code>right_join</code> (это значит, что я к правой табличке присоединяю левую, а все то, что осталось в левой не подошедшее к правой – не берется) из семейства <code>join</code>, переименовые колонки и заменяю пробелы на них на нижнее подчеркивание с помощью функции <code>rename_with</code>, отбираю только интересующие меня колонки с помощью функции <code>select</code>, создаю новые переменные, которые мы уже создавали ранее в домашках, с помощью функции mutate и сохраняю результат в новую табличку в датасет <code>whr_tests_hw</code></p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="R_analysis.html#cb255-1" tabindex="-1"></a>whr_2019 <span class="ot">&lt;-</span> readxl<span class="sc">::</span><span class="fu">read_xls</span>(<span class="st">&quot;Chapter2OnlineData2019.xls&quot;</span>)</span>
<span id="cb255-2"><a href="R_analysis.html#cb255-2" tabindex="-1"></a>whr <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;2016.csv&quot;</span>)</span>
<span id="cb255-3"><a href="R_analysis.html#cb255-3" tabindex="-1"></a></span>
<span id="cb255-4"><a href="R_analysis.html#cb255-4" tabindex="-1"></a>whr_2019 <span class="sc">%&gt;%</span></span>
<span id="cb255-5"><a href="R_analysis.html#cb255-5" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;_&quot;</span>, .), <span class="at">.cols =</span> <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb255-6"><a href="R_analysis.html#cb255-6" tabindex="-1"></a>  <span class="fu">select</span>(Country_name<span class="sc">:</span>Negative_affect) <span class="sc">%&gt;%</span></span>
<span id="cb255-7"><a href="R_analysis.html#cb255-7" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">&lt;=</span> <span class="dv">2016</span>) <span class="ot">-&gt;</span> whr_2019</span>
<span id="cb255-8"><a href="R_analysis.html#cb255-8" tabindex="-1"></a></span>
<span id="cb255-9"><a href="R_analysis.html#cb255-9" tabindex="-1"></a>whr <span class="sc">%&gt;%</span></span>
<span id="cb255-10"><a href="R_analysis.html#cb255-10" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">gsub</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;_&quot;</span>, .), <span class="at">.cols =</span> <span class="fu">everything</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb255-11"><a href="R_analysis.html#cb255-11" tabindex="-1"></a>  <span class="fu">select</span>(Country, Happiness_Rank, Happiness_Score) <span class="sc">%&gt;%</span></span>
<span id="cb255-12"><a href="R_analysis.html#cb255-12" tabindex="-1"></a>  <span class="fu">right_join</span>(whr_2019, <span class="at">by =</span> <span class="fu">join_by</span>(Country <span class="sc">==</span> Country_name), <span class="at">multiple =</span> <span class="st">&quot;last&quot;</span>) <span class="ot">-&gt;</span> tmp</span>
<span id="cb255-13"><a href="R_analysis.html#cb255-13" tabindex="-1"></a></span>
<span id="cb255-14"><a href="R_analysis.html#cb255-14" tabindex="-1"></a>whr <span class="sc">%&gt;%</span></span>
<span id="cb255-15"><a href="R_analysis.html#cb255-15" tabindex="-1"></a>  <span class="fu">select</span>(Country<span class="sc">:</span>Region) <span class="sc">%&gt;%</span></span>
<span id="cb255-16"><a href="R_analysis.html#cb255-16" tabindex="-1"></a>  <span class="fu">right_join</span>(tmp, <span class="at">by =</span> <span class="fu">join_by</span>(Country <span class="sc">==</span> Country), <span class="at">multiple =</span> <span class="st">&quot;all&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb255-17"><a href="R_analysis.html#cb255-17" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">&quot;top20&quot;</span> <span class="ot">=</span> <span class="fu">ifelse</span>(Happiness_Rank<span class="sc">&lt;=</span><span class="dv">20</span>, <span class="st">&quot;hehe&quot;</span>, <span class="st">&quot;not hehe&quot;</span>),</span>
<span id="cb255-18"><a href="R_analysis.html#cb255-18" tabindex="-1"></a>         <span class="st">&quot;mean_position&quot;</span> <span class="ot">=</span> <span class="fu">ifelse</span>(Happiness_Score<span class="sc">&gt;=</span> <span class="fu">mean</span>(Happiness_Score, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="st">&quot;upper&quot;</span>, <span class="st">&quot;lower&quot;</span>)) <span class="ot">-&gt;</span> whr_tests_hw</span></code></pre></div>
<p>Результат этой предобраотк я так же с помощью <code>R</code> и функции <code>write_csv()</code> выгрузила в отдельный файл <a href="https://raw.githubusercontent.com/elenary/StatsForDA/main/whr_tests_hw.csv" class="uri">https://raw.githubusercontent.com/elenary/StatsForDA/main/whr_tests_hw.csv</a></p>
<p>До этого мы проверяли гипотезу о том, что Happiness Score различаеся в двух регионах: Западаной и Восточной и Центральной Европе. А если я хочу проверить, различаются ли статистически значимо уровень счастья в трех регионах – Западаной и Восточной и Центральной Европе и в Латинском Америке? Снова обращаемся к изученным нами в прошлом семестре <a href="stats_criteria.html#stats_criteria">статистическим критериям</a>, всопминаем каринку с деревом выбора статистических тестов <a href="https://miro.com/app/board/uXjVOxmKhr8=/" class="uri">https://miro.com/app/board/uXjVOxmKhr8=/</a>. Если у нас ЗП количественная, НП категориальная / категориальные, и нужно провести 3 сравнения и больше – то мы переходим от т-теста к <a href="stats_criteria_ttest_anova.html#anova">ANOVA (дисперсионному анализу)</a>.</p>
<p>Я буду периодически придерживаться формы записи кода, когда я внутри одного пайпа делаю сразу все – и фильрацию, и построение графиков или расчет теста, но не забывае, что прежде чем писать все вместе, нужно убедиться, что каждая строчка – работает. И может быть удобнее на первых порах создавать побольше переменных и записывать туда результаты фильтрации, а потом уже использовать эту переменную – так будет проще дебажить код. Например, можно сначала отфильтровать данные и записать их в новый датасет (иногда бывает, что без этой формы записи не обойтись)</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="R_analysis.html#cb256-1" tabindex="-1"></a>whr_tests_hw <span class="sc">%&gt;%</span></span>
<span id="cb256-2"><a href="R_analysis.html#cb256-2" tabindex="-1"></a>  <span class="fu">filter</span>(Region <span class="sc">==</span> <span class="st">&quot;Central and Eastern Europe&quot;</span> <span class="sc">|</span> Region <span class="sc">==</span> <span class="st">&quot;Western Europe&quot;</span> <span class="sc">|</span> Region <span class="sc">==</span> <span class="st">&quot;Latin America and Caribbean&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb256-3"><a href="R_analysis.html#cb256-3" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">==</span> <span class="st">&quot;2016&quot;</span>) <span class="ot">-&gt;</span> whr_anova</span></code></pre></div>
<p>Вспоминаем допущения для <a href="stats_criteria_ttest_anova.html#anova">АНОВЫ</a></p>
<p>Первое – ЗП должна быть распределена близко к нормальному распределению.</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="R_analysis.html#cb257-1" tabindex="-1"></a>whr_anova <span class="sc">%&gt;%</span></span>
<span id="cb257-2"><a href="R_analysis.html#cb257-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Happiness_Score)) <span class="sc">+</span></span>
<span id="cb257-3"><a href="R_analysis.html#cb257-3" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>) <span class="sc">+</span></span>
<span id="cb257-4"><a href="R_analysis.html#cb257-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-63-1.png" width="672" /></p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="R_analysis.html#cb258-1" tabindex="-1"></a>whr_anova <span class="sc">%&gt;%</span></span>
<span id="cb258-2"><a href="R_analysis.html#cb258-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">sample =</span> Happiness_Score)) <span class="sc">+</span></span>
<span id="cb258-3"><a href="R_analysis.html#cb258-3" tabindex="-1"></a>  <span class="fu">stat_qq</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>) <span class="sc">+</span></span>
<span id="cb258-4"><a href="R_analysis.html#cb258-4" tabindex="-1"></a>  <span class="fu">geom_qq_line</span>() <span class="sc">+</span></span>
<span id="cb258-5"><a href="R_analysis.html#cb258-5" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-63-2.png" width="672" /></p>
<p>Допустим, это похоже на нормальное распредедление.</p>
<p>Второе допущение – гомогенность (гомоскедастичность) дисперсий. Дисперсии должны быть одинаковы в наших группах. Если они будут разными – это плохо, и нам придется использовать непараметрические аналоги ANOVA. Гомогенность дисперсий проверяется с помощью Levene’s Test. Обратите внимание: здесь мы заинтересованы в получении НЕзначимого результата – потому что если проверка дала значимый результат, то диперсии в группах различаются, а это не ок. Нам понадобится фунция <code>leveneTest</code> из пакета <code>car</code></p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="R_analysis.html#cb259-1" tabindex="-1"></a><span class="fu">options</span>(<span class="at">scipen =</span> <span class="dv">999</span>) <span class="co"># сначала отключим форму записи чисел с большим количество нулей через экспоненту</span></span>
<span id="cb259-2"><a href="R_analysis.html#cb259-2" tabindex="-1"></a></span>
<span id="cb259-3"><a href="R_analysis.html#cb259-3" tabindex="-1"></a><span class="co"># install.packages(&quot;car&quot;)</span></span>
<span id="cb259-4"><a href="R_analysis.html#cb259-4" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb259-5"><a href="R_analysis.html#cb259-5" tabindex="-1"></a><span class="fu">leveneTest</span>(Happiness_Score <span class="sc">~</span> Region, <span class="at">data =</span> whr_anova)</span></code></pre></div>
<pre><code>## Warning in leveneTest.default(y = y, group = group, ...): group coerced to
## factor.</code></pre>
<pre><code>## Levene&#39;s Test for Homogeneity of Variance (center = median)
##       Df F value Pr(&gt;F)
## group  2  0.7143 0.4933
##       66</code></pre>
<p>Смотрми на p-value: оно не значимо, ура! Значит, мы соблюли все допущения, и можем спокойно использовать анову. Мы попробуем построить ее двумя способами: с помощью стандартной функции <code>aov</code> и с помощью более функции <code>ezANOVA</code> из пакета <code>ez</code> с более понятным синтаксисом, но более придирчивой и менее стабильной.</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="R_analysis.html#cb262-1" tabindex="-1"></a>aov_model1 <span class="ot">&lt;-</span> <span class="fu">aov</span>(Happiness_Score <span class="sc">~</span> Region, <span class="at">data =</span> whr_anova) <span class="co">#выполняем АНОВУ</span></span>
<span id="cb262-2"><a href="R_analysis.html#cb262-2" tabindex="-1"></a><span class="fu">summary</span>(aov_model1) <span class="co">#выводим табличку АНОВЫ</span></span></code></pre></div>
<pre><code>##             Df Sum Sq Mean Sq F value       Pr(&gt;F)    
## Region       2  21.40  10.698   21.37 0.0000000697 ***
## Residuals   66  33.04   0.501                         
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Как проинтерпретировать эти результаты? Первое, на что мы смотрим – это p-value (колонка Pr(F)). Если оно меньше установленного уровня <span class="math inline">\(\alpha\)</span>, то мы говорим, что <em>отвергаем нулевую гипотезу, и мы получили статистически значимые резличия</em>. Если p-value больше или равно <span class="math inline">\(\alpha\)</span> – <em>у нас недостаточно свидетельств в пользу альтернативной гипотезы, и мы говорим, что не отвергаем нулевую гипотезу</em>.</p>
<p>Второй вариант построения этого же анализа с помощью функции <code>ezANOVA.</code> Она, кстати, сразу делает Levene’s test, поэтому у нас две выдачи.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="R_analysis.html#cb264-1" tabindex="-1"></a><span class="co"># install.packages(&quot;ez&quot;)</span></span>
<span id="cb264-2"><a href="R_analysis.html#cb264-2" tabindex="-1"></a><span class="fu">library</span>(ez)</span>
<span id="cb264-3"><a href="R_analysis.html#cb264-3" tabindex="-1"></a></span>
<span id="cb264-4"><a href="R_analysis.html#cb264-4" tabindex="-1"></a>whr_anova <span class="sc">%&gt;%</span> </span>
<span id="cb264-5"><a href="R_analysis.html#cb264-5" tabindex="-1"></a>  <span class="fu">ezANOVA</span>(., Happiness_Score, <span class="at">wid =</span> Country, <span class="at">between =</span> Region)</span></code></pre></div>
<pre><code>## Warning: Converting &quot;Country&quot; to factor for ANOVA.</code></pre>
<pre><code>## Warning: Converting &quot;Region&quot; to factor for ANOVA.</code></pre>
<pre><code>## Warning: Data is unbalanced (unequal N per group). Make sure you specified a
## well-considered value for the type argument to ezANOVA().</code></pre>
<pre><code>## $ANOVA
##   Effect DFn DFd        F              p p&lt;.05       ges
## 1 Region   2  66 21.37266 0.000000069727     * 0.3930773
## 
## $`Levene&#39;s Test for Homogeneity of Variance`
##   DFn DFd       SSn      SSd         F         p p&lt;.05
## 1   2  66 0.3066018 14.16483 0.7142945 0.4932823</code></pre>
<p>Если мы сравним результаты – они будут точно такими же, только вторая функция в колонке ges выдает еще размер эффекта! Это eta squared <span class="math inline">\(\eta^2\)</span>, <a href="inference.html#sample_size">метрика размера размера эффекта для ANOVA</a>, которую вы так или иначе использовали в домашнем задании в прошлом курсе. Мы видим, что эффект, который мы получили, довольно большой!</p>
<p>Можем посчитать его и отдельно для предыдущей таблички с помощью функции пакета effectsize</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="R_analysis.html#cb269-1" tabindex="-1"></a><span class="co"># install.packages(&quot;effectsize&quot;)</span></span>
<span id="cb269-2"><a href="R_analysis.html#cb269-2" tabindex="-1"></a><span class="fu">library</span>(effectsize)</span>
<span id="cb269-3"><a href="R_analysis.html#cb269-3" tabindex="-1"></a></span>
<span id="cb269-4"><a href="R_analysis.html#cb269-4" tabindex="-1"></a><span class="fu">eta_squared</span>(aov_model1)</span></code></pre></div>
<pre><code>## # Effect Size for ANOVA
## 
## Parameter | Eta2 |       95% CI
## -------------------------------
## Region    | 0.39 | [0.24, 1.00]
## 
## - One-sided CIs: upper bound fixed at [1.00].</code></pre>
<p>Значение будет тем же самым, что и в колонке ges вывода ezANOVA.</p>
<p>Визуализируем результаты. Чаще всего для визуализации ANOVA используются боксплоты или вайолин плоты</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="R_analysis.html#cb271-1" tabindex="-1"></a>whr_anova <span class="sc">%&gt;%</span></span>
<span id="cb271-2"><a href="R_analysis.html#cb271-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Region, <span class="at">y =</span> Happiness_Score, <span class="at">fill =</span> Region)) <span class="sc">+</span></span>
<span id="cb271-3"><a href="R_analysis.html#cb271-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb271-4"><a href="R_analysis.html#cb271-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb271-5"><a href="R_analysis.html#cb271-5" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">wes_palette</span>(<span class="st">&quot;FantasticFox1&quot;</span>))</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-68-1.png" width="672" />
Или же часто можно встретить графики, на которых отображены только средние</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="R_analysis.html#cb272-1" tabindex="-1"></a>whr_anova <span class="sc">%&gt;%</span></span>
<span id="cb272-2"><a href="R_analysis.html#cb272-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Region, <span class="at">y =</span> Happiness_Score, <span class="at">color =</span> Region, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb272-3"><a href="R_analysis.html#cb272-3" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">&#39;point&#39;</span>) <span class="sc">+</span></span>
<span id="cb272-4"><a href="R_analysis.html#cb272-4" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun =</span> mean, <span class="at">geom =</span> <span class="st">&#39;line&#39;</span>) <span class="sc">+</span></span>
<span id="cb272-5"><a href="R_analysis.html#cb272-5" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.data =</span> mean_cl_boot, <span class="at">geom =</span> <span class="st">&#39;errorbar&#39;</span>) <span class="sc">+</span></span>
<span id="cb272-6"><a href="R_analysis.html#cb272-6" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb272-7"><a href="R_analysis.html#cb272-7" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">wes_palette</span>(<span class="st">&quot;FantasticFox1&quot;</span>))</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-69-1.png" width="672" /></p>
<p>Мы узнали, что ANOVA значима, то есть статистически значимые различия между этими тремя регионами. А как узнать, какие именно регионы вносят значимость? Может ли такое быть, чтоо значимость обеспечивается одним сильно отличающимся от других регионом, в то время как два других не отличаются? Может. Чтобы узнать это, нужно провести <a href="#id_%D0%BF%D0%BE%D1%81%D1%82-%D1%85%D0%BE%D0%BA%D0%B8-%D0%B8-%D0%BC%D0%BD%D0%BE%D0%B6%D0%B5%D1%81%D1%82%D0%B2%D0%B5%D0%BD%D0%BD%D1%8B%D0%B5-%D1%81%D1%80%D0%B0%D0%B2%D0%BD%D0%B5%D0%BD%D0%B8%D1%8F">пост-хок тесты</a>.</p>
<div id="пост-хоки" class="section level4 hasAnchor" number="14.13.1.1">
<h4><span class="header-section-number">14.13.1.1</span> Пост-хоки<a href="R_analysis.html#пост-хоки" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Пост-хоки представляют собой попарное множественное сравнение всего со всем. Вспоминаем, что когда мы так делаем – мы рикуем получить статистчиески значимый результат чисто по случайности, потому что очень растет вероятность ошибки первого рода, и нужны поправи на множественные сравнения. Сделать пост=хок анализ можно например помощью встроенных функций <code>TukeyHSD</code> или <code>pairwise.t.test</code></p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="R_analysis.html#cb273-1" tabindex="-1"></a><span class="fu">TukeyHSD</span>(aov_model1, <span class="at">conf.level=</span>.<span class="dv">95</span>)</span></code></pre></div>
<pre><code>##   Tukey multiple comparisons of means
##     95% family-wise confidence level
## 
## Fit: aov(formula = Happiness_Score ~ Region, data = whr_anova)
## 
## $Region
##                                                             diff        lwr
## Latin America and Caribbean-Central and Eastern Europe 0.7082577 0.20757381
## Western Europe-Central and Eastern Europe              1.3149770 0.82891110
## Western Europe-Latin America and Caribbean             0.6067193 0.06961039
##                                                             upr     p adj
## Latin America and Caribbean-Central and Eastern Europe 1.208942 0.0033334
## Western Europe-Central and Eastern Europe              1.801043 0.0000000
## Western Europe-Latin America and Caribbean             1.143828 0.0230915</code></pre>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="R_analysis.html#cb275-1" tabindex="-1"></a><span class="fu">pairwise.t.test</span>(whr_anova<span class="sc">$</span>Happiness_Score, whr_anova<span class="sc">$</span>Region, <span class="at">p.adj =</span> <span class="st">&quot;bonf&quot;</span>)</span></code></pre></div>
<pre><code>## 
##  Pairwise comparisons using t tests with pooled SD 
## 
## data:  whr_anova$Happiness_Score and whr_anova$Region 
## 
##                             Central and Eastern Europe
## Latin America and Caribbean 0.0035                    
## Western Europe              0.000000039               
##                             Latin America and Caribbean
## Latin America and Caribbean -                          
## Western Europe              0.0258                     
## 
## P value adjustment method: bonferroni</code></pre>
</div>
<div id="непераметрические-аналоги-anova" class="section level4 hasAnchor" number="14.13.1.2">
<h4><span class="header-section-number">14.13.1.2</span> Непераметрические аналоги ANOVA<a href="R_analysis.html#непераметрические-аналоги-anova" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Если наша переменная имеет значительные выбросы, не прошла проверку на нормальность, и дисперсии в группах оказались статистически значимо разные – значит, мы не можем применять ANOVA. Что делаеть? Проводить аналог ANOVA, тест Краскелла-Уоллиса. Покажу его на тех же данных, которые мы брали для ANOVA, где смотрели разный уровень счастья по регионам.</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="R_analysis.html#cb277-1" tabindex="-1"></a><span class="fu">kruskal.test</span>(Happiness_Score <span class="sc">~</span> Region, <span class="at">data =</span> whr_anova)</span></code></pre></div>
<pre><code>## 
##  Kruskal-Wallis rank sum test
## 
## data:  Happiness_Score by Region
## Kruskal-Wallis chi-squared = 26.36, df = 2, p-value = 0.000001888</code></pre>
</div>
<div id="многофакторная-anova" class="section level4 hasAnchor" number="14.13.1.3">
<h4><span class="header-section-number">14.13.1.3</span> Многофакторная ANOVA<a href="R_analysis.html#многофакторная-anova" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Мы проверили гипотезу с только одной НП – регион. А если моя гипотеза касается нескольких факторов? Например, хочу проверить гипотезу, что на переменную <code>Life_Ladder</code> (аналог <code>Happiness Score</code>, показывает результаты опроса, где находятся респонденты по уровню счастья в виде лестницы, у которой 10 ступенек) влияет и регион, и год.</p>
<p>Я вернусь к изначальному датасету и уберу фильтрацию по году.</p>
<p>Все то же самое – сначала проверим допущения.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="R_analysis.html#cb279-1" tabindex="-1"></a>whr_tests_hw <span class="sc">%&gt;%</span></span>
<span id="cb279-2"><a href="R_analysis.html#cb279-2" tabindex="-1"></a>  <span class="fu">filter</span>(Region <span class="sc">==</span> <span class="st">&quot;Central and Eastern Europe&quot;</span> <span class="sc">|</span> </span>
<span id="cb279-3"><a href="R_analysis.html#cb279-3" tabindex="-1"></a>           Region <span class="sc">==</span> <span class="st">&quot;Western Europe&quot;</span> <span class="sc">|</span> </span>
<span id="cb279-4"><a href="R_analysis.html#cb279-4" tabindex="-1"></a>           Region <span class="sc">==</span> <span class="st">&quot;Latin America and Caribbean&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb279-5"><a href="R_analysis.html#cb279-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Life_Ladder)) <span class="sc">+</span></span>
<span id="cb279-6"><a href="R_analysis.html#cb279-6" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>) <span class="sc">+</span></span>
<span id="cb279-7"><a href="R_analysis.html#cb279-7" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-72-1.png" width="672" /></p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="R_analysis.html#cb280-1" tabindex="-1"></a>whr_tests_hw <span class="sc">%&gt;%</span></span>
<span id="cb280-2"><a href="R_analysis.html#cb280-2" tabindex="-1"></a>  <span class="fu">filter</span>(Region <span class="sc">==</span> <span class="st">&quot;Central and Eastern Europe&quot;</span> <span class="sc">|</span> </span>
<span id="cb280-3"><a href="R_analysis.html#cb280-3" tabindex="-1"></a>           Region <span class="sc">==</span> <span class="st">&quot;Western Europe&quot;</span> <span class="sc">|</span> </span>
<span id="cb280-4"><a href="R_analysis.html#cb280-4" tabindex="-1"></a>           Region <span class="sc">==</span> <span class="st">&quot;Latin America and Caribbean&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb280-5"><a href="R_analysis.html#cb280-5" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">sample =</span> Life_Ladder)) <span class="sc">+</span></span>
<span id="cb280-6"><a href="R_analysis.html#cb280-6" tabindex="-1"></a>  <span class="fu">stat_qq</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>) <span class="sc">+</span></span>
<span id="cb280-7"><a href="R_analysis.html#cb280-7" tabindex="-1"></a>  <span class="fu">geom_qq_line</span>() <span class="sc">+</span></span>
<span id="cb280-8"><a href="R_analysis.html#cb280-8" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-72-2.png" width="672" /></p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="R_analysis.html#cb281-1" tabindex="-1"></a>whr_tests_hw <span class="sc">%&gt;%</span></span>
<span id="cb281-2"><a href="R_analysis.html#cb281-2" tabindex="-1"></a>  <span class="fu">filter</span>(Region <span class="sc">==</span> <span class="st">&quot;Central and Eastern Europe&quot;</span> <span class="sc">|</span> </span>
<span id="cb281-3"><a href="R_analysis.html#cb281-3" tabindex="-1"></a>           Region <span class="sc">==</span> <span class="st">&quot;Western Europe&quot;</span> <span class="sc">|</span> </span>
<span id="cb281-4"><a href="R_analysis.html#cb281-4" tabindex="-1"></a>           Region <span class="sc">==</span> <span class="st">&quot;Latin America and Caribbean&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb281-5"><a href="R_analysis.html#cb281-5" tabindex="-1"></a>  <span class="fu">aov</span>(Life_Ladder <span class="sc">~</span> Region <span class="sc">+</span> <span class="fu">as.factor</span>(Year), <span class="at">data =</span> .) <span class="ot">-&gt;</span> aov_model3</span>
<span id="cb281-6"><a href="R_analysis.html#cb281-6" tabindex="-1"></a><span class="co">#на всякий случай сделала as.factor(), он просто превращает число в строку. функции бывают не очень умными и думают, что нужнобрать числовую переменную </span></span>
<span id="cb281-7"><a href="R_analysis.html#cb281-7" tabindex="-1"></a><span class="co"># как число, даже если задаем ее как группирующую переменную (фактор)</span></span>
<span id="cb281-8"><a href="R_analysis.html#cb281-8" tabindex="-1"></a><span class="fu">summary</span>(aov_model3)</span></code></pre></div>
<pre><code>##                  Df Sum Sq Mean Sq F value              Pr(&gt;F)    
## Region            2  273.0  136.51 271.048 &lt;0.0000000000000002 ***
## as.factor(Year)  11    6.8    0.62   1.229               0.263    
## Residuals       681  343.0    0.50                                
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Формула записи
<code>dependent var ~ independen var 1 + independent var 2</code>
означает, что я учитываю два фактора независимо друг от друга. Но бывает, что меня интересует взаимодействие факторов: может, в некоторых регионах за эти годы особо ничего не менялось, уровень счастья измеренный как <code>Life_Ladder</code> был постоянным, а в каких-то регионах произошел огромный рост (или огромный отрицательный рост) уровня счастья? Тогда мне нужно будет проверить взаимодействие факторов, и формула будет такая:
<code>dependent var ~ independen var 1 * independent var 2</code>
Везде, где меня интересует взаимодействие, вместо плюсика ставлю звездочку.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="R_analysis.html#cb283-1" tabindex="-1"></a>whr_tests_hw <span class="sc">%&gt;%</span></span>
<span id="cb283-2"><a href="R_analysis.html#cb283-2" tabindex="-1"></a>  <span class="fu">filter</span>(Region <span class="sc">==</span> <span class="st">&quot;Central and Eastern Europe&quot;</span> <span class="sc">|</span> </span>
<span id="cb283-3"><a href="R_analysis.html#cb283-3" tabindex="-1"></a>           Region <span class="sc">==</span> <span class="st">&quot;Western Europe&quot;</span> <span class="sc">|</span> </span>
<span id="cb283-4"><a href="R_analysis.html#cb283-4" tabindex="-1"></a>           Region <span class="sc">==</span> <span class="st">&quot;Latin America and Caribbean&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb283-5"><a href="R_analysis.html#cb283-5" tabindex="-1"></a>  <span class="fu">aov</span>(Life_Ladder <span class="sc">~</span> Region <span class="sc">*</span> <span class="fu">as.factor</span>(Year), <span class="at">data =</span> .) <span class="ot">-&gt;</span> aov_model4</span>
<span id="cb283-6"><a href="R_analysis.html#cb283-6" tabindex="-1"></a><span class="fu">summary</span>(aov_model4)</span></code></pre></div>
<pre><code>##                         Df Sum Sq Mean Sq F value              Pr(&gt;F)    
## Region                   2  273.0  136.51 274.254 &lt;0.0000000000000002 ***
## as.factor(Year)         11    6.8    0.62   1.244               0.254    
## Region:as.factor(Year)  22   15.0    0.68   1.366               0.123    
## Residuals              659  328.0    0.50                                
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<p>Видим, что во втором случае у нас появилась еще одна строчка – Region:Year. Это как раз взаимодействие двух факторов. И оно, между прочим, значимо! То есть предположение о том, что в разных регионах разная динамика изменения уровня счастья по годам – верное.</p>
<p>Далее, чтобы определить, что именно было значимо, делаем пост-хоки.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="R_analysis.html#cb285-1" tabindex="-1"></a><span class="fu">TukeyHSD</span>(aov_model3, <span class="at">conf.level=</span>.<span class="dv">95</span>)</span>
<span id="cb285-2"><a href="R_analysis.html#cb285-2" tabindex="-1"></a><span class="fu">TukeyHSD</span>(aov_model4, <span class="at">conf.level=</span>.<span class="dv">95</span>)</span></code></pre></div>
<p>Я не буду выводить табличку – она получается монструозной из-за того, что мы взяли года, а они начинаются с 2005 года: представьте, сколько там попарных сравнений…</p>
</div>
<div id="anova-с-повторными-измерениями" class="section level4 hasAnchor" number="14.13.1.4">
<h4><span class="header-section-number">14.13.1.4</span> ANOVA с повторными измерениями<a href="R_analysis.html#anova-с-повторными-измерениями" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Вообще-то переменная год – внутригрупповой фактор. И если быть честными, ее не очень хорошо учитывать так же, как и фактор Регион, иначе мы потеряем много информации. В R ANOVA с повторными измерениями можно сделать, задав дополнительные параметры в функции aov(), либо с уже знакомой нам функцией ezANOVA(), либо с помощью очень похожей функции anova_test()</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="R_analysis.html#cb286-1" tabindex="-1"></a>whr_tests_hw <span class="sc">%&gt;%</span></span>
<span id="cb286-2"><a href="R_analysis.html#cb286-2" tabindex="-1"></a>  <span class="fu">filter</span>(Region <span class="sc">==</span> <span class="st">&quot;Central and Eastern Europe&quot;</span> <span class="sc">|</span> </span>
<span id="cb286-3"><a href="R_analysis.html#cb286-3" tabindex="-1"></a>           Region <span class="sc">==</span> <span class="st">&quot;Western Europe&quot;</span> <span class="sc">|</span> </span>
<span id="cb286-4"><a href="R_analysis.html#cb286-4" tabindex="-1"></a>           Region <span class="sc">==</span> <span class="st">&quot;Latin America and Caribbean&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb286-5"><a href="R_analysis.html#cb286-5" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">&gt;</span> <span class="dv">2010</span>) <span class="sc">%&gt;%</span> <span class="co">#возьму года после 2010, чтобы было поменьше</span></span>
<span id="cb286-6"><a href="R_analysis.html#cb286-6" tabindex="-1"></a>  <span class="fu">drop_na</span>(Life_Ladder, Year) <span class="sc">%&gt;%</span> <span class="co">#удаляю пропущенные значения в интересующих меня колонках</span></span>
<span id="cb286-7"><a href="R_analysis.html#cb286-7" tabindex="-1"></a>  <span class="fu">aov</span>(Life_Ladder <span class="sc">~</span> Year <span class="sc">+</span> <span class="fu">Error</span>(Country<span class="sc">/</span>Year), .) <span class="sc">%&gt;%</span></span>
<span id="cb286-8"><a href="R_analysis.html#cb286-8" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>## Warning in aov(Life_Ladder ~ Year + Error(Country/Year), .): Error() model is
## singular</code></pre>
<pre><code>## 
## Error: Country
##           Df Sum Sq Mean Sq F value Pr(&gt;F)
## Year       1   8.94   8.935   2.095  0.152
## Residuals 71 302.81   4.265               
## 
## Error: Country:Year
##           Df Sum Sq Mean Sq F value Pr(&gt;F)
## Year       1  0.003  0.0027    0.01  0.919
## Residuals 70 18.106  0.2586               
## 
## Error: Within
##            Df Sum Sq Mean Sq F value Pr(&gt;F)
## Residuals 270  12.92 0.04784</code></pre>
<p>Как задать эту формулу: если фактор появляется несколько раз для одного и того же испытуемого или страны в данном случае, то формула записи будет такой
<code>dependent var ~ independen var + Error(ID/independen var)</code></p>
<p>Более человеческий синтаксис у функции anova_test, но она очень чувствительна к данным, и на этих данных, например, не построилась. <em>Позже я поняла, почему: я забыла сделать проверку на идентичность дисперсий, вот модель и не сходится! Но мне уже лень переписывать..</em></p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="R_analysis.html#cb289-1" tabindex="-1"></a>whr_tests_hw <span class="sc">%&gt;%</span></span>
<span id="cb289-2"><a href="R_analysis.html#cb289-2" tabindex="-1"></a>  <span class="fu">filter</span>(Region <span class="sc">==</span> <span class="st">&quot;Central and Eastern Europe&quot;</span> <span class="sc">|</span> </span>
<span id="cb289-3"><a href="R_analysis.html#cb289-3" tabindex="-1"></a>           Region <span class="sc">==</span> <span class="st">&quot;Western Europe&quot;</span> <span class="sc">|</span> </span>
<span id="cb289-4"><a href="R_analysis.html#cb289-4" tabindex="-1"></a>           Region <span class="sc">==</span> <span class="st">&quot;Latin America and Caribbean&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb289-5"><a href="R_analysis.html#cb289-5" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">&gt;</span> <span class="dv">2010</span>) <span class="sc">%&gt;%</span></span>
<span id="cb289-6"><a href="R_analysis.html#cb289-6" tabindex="-1"></a>  <span class="fu">drop_na</span>(Life_Ladder, Year) <span class="sc">%&gt;%</span> </span>
<span id="cb289-7"><a href="R_analysis.html#cb289-7" tabindex="-1"></a>  <span class="fu">ezANOVA</span>(., <span class="at">dv =</span> Life_Ladder, <span class="at">wid =</span> Country, <span class="at">within =</span> <span class="fu">as.factor</span>(Year))</span></code></pre></div>
</div>
</div>
<div id="reshaping" class="section level3 hasAnchor" number="14.13.2">
<h3><span class="header-section-number">14.13.2</span> Решейпинг<a href="R_analysis.html#reshaping" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Бывает так, что для тестов с повторными измерениями некоторые функции принимают на вход данные в другом формате. Например, ровно так произошло в Jamovi. Обратите внимание, как данные о повторных измерениях у нас выглядят сейчас: у нас есть колонка <code>Year</code>, в которой перечислены года, и колонка <code>Life_Ladder</code>, в которой перечислены соответствующие этим годам значения.</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="R_analysis.html#cb290-1" tabindex="-1"></a>whr_tests_hw <span class="sc">%&gt;%</span> </span>
<span id="cb290-2"><a href="R_analysis.html#cb290-2" tabindex="-1"></a>  <span class="fu">select</span>(Country, Year, Life_Ladder) <span class="sc">%&gt;%</span> </span>
<span id="cb290-3"><a href="R_analysis.html#cb290-3" tabindex="-1"></a>  <span class="fu">filter</span>(Year<span class="sc">&gt;</span><span class="dv">2010</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb290-4"><a href="R_analysis.html#cb290-4" tabindex="-1"></a>  <span class="fu">head</span>() <span class="co">#выводит заголовок таблички, первые 10 строк</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   Country  Year Life_Ladder
##   &lt;chr&gt;   &lt;dbl&gt;       &lt;dbl&gt;
## 1 Denmark  2016        7.56
## 2 Denmark  2011        7.79
## 3 Denmark  2012        7.52
## 4 Denmark  2013        7.59
## 5 Denmark  2014        7.51
## 6 Denmark  2015        7.51</code></pre>
<p>Такой формат данных называется <em>длинным</em> (без шуток, так и называется!), потому что данные вытянуты в длину, вместо того, чтобы каждая строка состояла из уникальных данных (обратите внимание на колонку <code>Country</code> – там повторяющие значения, потому что у нас много замеров в разные года для каждой страны). Иногда бывает нужно перевести данные в <em>широкий</em> формат – чтобы значения в строчках не повторялись, но вместо двух колонок у нас появилась по колонке с измерениями <code>Life_Ladder</code> за каждый год. Такое преобразование называется решейпинг данных, как бы изменение их формы. Преобразовать вид данных из длинного в широкий формат или обратно можно с помощью функций pivot_wider pivot_longer. В Jamovi решейпинг, к сожалению, не реализован.</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="R_analysis.html#cb292-1" tabindex="-1"></a>whr_tests_hw <span class="sc">%&gt;%</span> </span>
<span id="cb292-2"><a href="R_analysis.html#cb292-2" tabindex="-1"></a>  <span class="fu">select</span>(Country, Year, Life_Ladder) <span class="sc">%&gt;%</span> </span>
<span id="cb292-3"><a href="R_analysis.html#cb292-3" tabindex="-1"></a>  <span class="fu">filter</span>(Year<span class="sc">&gt;</span><span class="dv">2010</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb292-4"><a href="R_analysis.html#cb292-4" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Year, <span class="at">values_from =</span> Life_Ladder) <span class="sc">%&gt;%</span> </span>
<span id="cb292-5"><a href="R_analysis.html#cb292-5" tabindex="-1"></a>  <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 7
##   Country     `2016` `2011` `2012` `2013` `2014` `2015`
##   &lt;chr&gt;        &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
## 1 Denmark       7.56   7.79   7.52   7.59   7.51   7.51
## 2 Switzerland   7.46  NA      7.78  NA      7.49   7.57
## 3 Iceland       7.51  NA      7.59   7.50  NA      7.50
## 4 Norway        7.60  NA      7.68  NA      7.44   7.60
## 5 Finland       7.66   7.35   7.42   7.44   7.38   7.45
## 6 Canada        7.24   7.43   7.42   7.59   7.30   7.41</code></pre>
</div>
</div>
<div id="tasks_sem6" class="section level2 hasAnchor" number="14.14">
<h2><span class="header-section-number">14.14</span> Задания после семинара 6<a href="R_analysis.html#tasks_sem6" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Проверьте несколько гипотез на датасете <code>whr_tests_hw</code> с помощью ANOVA и линейного регресионного анализа: выберете подходящие для этих тестов переменные, сформулируйте гипотезу, сформулируйте <span class="math inline">\(H_0\)</span> и <span class="math inline">\(H_1\)</span>, выберете уровень <span class="math inline">\(\alpha\)</span>, (если нужно, предобработайте данные), проверьте допущения для тестов.</p>
<ol style="list-style-type: decimal">
<li>Выберете подходящие переменные, сформулируйте осмысленную гипотезу и проверьте ее с помощью однофакторной ANOVA. Проинтерпретируйте результаты: подвердилась ли гипотеза?</li>
<li>Выберете подходящие переменные, сформулируйте осмысленную гипотезу и проверьте ее и проверьте ее с многофакторной ANOVA. Проинтерпретируйте результаты: подвердилась ли гипотеза?</li>
<li>Выберете подходящие переменные, сформулируйте осмысленную гипотезу и проверьте ее с помощью ANOVA c повторными измерениями. Проинтерпретируйте результаты: подвердилась ли гипотеза?</li>
<li>Проведите те же самые проверки гипотез 1-3 с помощью линейного регрессионного анализа.</li>
</ol>
</div>
<div id="lin_reg" class="section level2 hasAnchor" number="14.15">
<h2><span class="header-section-number">14.15</span> Линейный регрессионный анализ<a href="R_analysis.html#lin_reg" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Теперь перейдем к однму из самых важных методов в анализе данных, в том числе, психологических – <a href="stats_criteria_linear.html#linreg">линейной регрессии</a>. Первым делом нужно вспомнить, когда используется этот метод – а используется он, когда и ЗП, и НП – количественные. Когда мы говорили про корреляции, мы обсуждали, что это упрощенный вариант линейной регрессии, когда у нас только одна НП. Для однй НП мы можем сделать и корреляционный тест, и регрессионный анализ, а вот когда количественных НП две и более – уже тольк регрессионный. Также мы обсуждали, что ANOVA – на самом деле тоже подвид линейной регрессии, если уходить от количественных НП к категориальным! Но обо всем по порядку, начнем с количественных НП, более классического случая линейной регрессии.</p>
<p>Прежде, чем строить регрессионную модель, нам нужно проверить <a href="stats_criteria_linear.html#assumptions_linreg">допущения для линейной регрессии</a></p>
<p>Обратите внимание – нас тут уже не очень интересует, насколько нормально распределена ЗП! В этом сила линейной реггрессии, что она устойчива к ЗП разных распределений. Но другое допущение, касающееся распределения данных по ЗП – это линейность между НП и ЗП, на которых мы хотим строить модель, нужно убедиться, что между ними есть линейная связь (а не дырка от бублика или сущность в виде гномика). Это первое допущение.</p>
<p>Я выбрала для анализа гипотезу о том, что уровень счастья по субъективному расположению на лестнице <code>Life_Ladder</code>, зависит от параметров <code>Log_GDP_per_capita</code> (покупательская способность, ВВП на душу населения), <code>Social_support</code>, <code>Freedom_to_make_life_choices</code>, <code>Perceptions_of_corruption.</code></p>
<p>Проверим допущение о линейной связи между ЗП Life_Ladder и нескольких потенциальных переменных, которые я выбрала для анализа.</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="R_analysis.html#cb294-1" tabindex="-1"></a>whr_tests_hw <span class="sc">%&gt;%</span> </span>
<span id="cb294-2"><a href="R_analysis.html#cb294-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Log_GDP_per_capita, <span class="at">y =</span> Life_Ladder)) <span class="sc">+</span></span>
<span id="cb294-3"><a href="R_analysis.html#cb294-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb294-4"><a href="R_analysis.html#cb294-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 15 rows containing missing values (`geom_point()`).</code></pre>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-80-1.png" width="672" /></p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="R_analysis.html#cb296-1" tabindex="-1"></a>whr_tests_hw <span class="sc">%&gt;%</span> </span>
<span id="cb296-2"><a href="R_analysis.html#cb296-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Social_support, <span class="at">y =</span> Life_Ladder)) <span class="sc">+</span></span>
<span id="cb296-3"><a href="R_analysis.html#cb296-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb296-4"><a href="R_analysis.html#cb296-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 12 rows containing missing values (`geom_point()`).</code></pre>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-80-2.png" width="672" /></p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="R_analysis.html#cb298-1" tabindex="-1"></a>whr_tests_hw <span class="sc">%&gt;%</span> </span>
<span id="cb298-2"><a href="R_analysis.html#cb298-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Freedom_to_make_life_choices, <span class="at">y =</span> Life_Ladder)) <span class="sc">+</span></span>
<span id="cb298-3"><a href="R_analysis.html#cb298-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb298-4"><a href="R_analysis.html#cb298-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 28 rows containing missing values (`geom_point()`).</code></pre>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-80-3.png" width="672" /></p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="R_analysis.html#cb300-1" tabindex="-1"></a>whr_tests_hw <span class="sc">%&gt;%</span> </span>
<span id="cb300-2"><a href="R_analysis.html#cb300-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Perceptions_of_corruption, <span class="at">y =</span> Life_Ladder)) <span class="sc">+</span></span>
<span id="cb300-3"><a href="R_analysis.html#cb300-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb300-4"><a href="R_analysis.html#cb300-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 78 rows containing missing values (`geom_point()`).</code></pre>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-80-4.png" width="672" /></p>
<p>Вижу, что переменная Log_GDP_per_capita показывает очень хорошую линейную связь, близко к этому переменная Freedom_to_make_life_choices. Переменная Social_support мне не очень нравится, но я могу попробовать ее преобразовать в процессе, а вот переменная Perceptions_of_corruption выглядит откровенно плохо, возьму ее в качестве антипримера.</p>
<div id="линейная-регрессия-с-одним-предиктором-фактором" class="section level3 hasAnchor" number="14.15.1">
<h3><span class="header-section-number">14.15.1</span> Линейная регрессия с одним предиктором (фактором)<a href="R_analysis.html#линейная-регрессия-с-одним-предиктором-фактором" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Построю для начала модель с одним факторов – Log_GDP_per_capita. Модель строится помощью функции lm(), чтобы вывести основную информацию о модели нужно вывести summary(). Еще, кстати, можно вывести эти результаты сразу в виде ANOVA – это все потому, что, по сути, это подвид той же линейной регрессии, и если нам мила сердцу табличка вида ANOVA, можно ее получить просто применив функции к модели anova()</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="R_analysis.html#cb302-1" tabindex="-1"></a>whr_tests_hw <span class="sc">%&gt;%</span> </span>
<span id="cb302-2"><a href="R_analysis.html#cb302-2" tabindex="-1"></a>  <span class="fu">lm</span>(Life_Ladder <span class="sc">~</span> Log_GDP_per_capita, .) <span class="ot">-&gt;</span> lm_model1</span>
<span id="cb302-3"><a href="R_analysis.html#cb302-3" tabindex="-1"></a><span class="co"># напомнию, что точка означает, что именно в этом месте нужно передать в функцию данные</span></span>
<span id="cb302-4"><a href="R_analysis.html#cb302-4" tabindex="-1"></a><span class="co"># полученные на предыдущей строчке пайпа. Посмотрите структуру функции lm() в справке, </span></span>
<span id="cb302-5"><a href="R_analysis.html#cb302-5" tabindex="-1"></a><span class="co"># на этом находится аргумент `data = `</span></span>
<span id="cb302-6"><a href="R_analysis.html#cb302-6" tabindex="-1"></a>lm_model1</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Life_Ladder ~ Log_GDP_per_capita, data = .)
## 
## Coefficients:
##        (Intercept)  Log_GDP_per_capita  
##            -1.4066              0.7421</code></pre>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="R_analysis.html#cb304-1" tabindex="-1"></a><span class="fu">summary</span>(lm_model1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Life_Ladder ~ Log_GDP_per_capita, data = .)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2.26515 -0.47805 -0.04913  0.54993  2.01866 
## 
## Coefficients:
##                    Estimate Std. Error t value            Pr(&gt;|t|)    
## (Intercept)         -1.4066     0.1467  -9.587 &lt;0.0000000000000002 ***
## Log_GDP_per_capita   0.7421     0.0158  46.973 &lt;0.0000000000000002 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.7016 on 1404 degrees of freedom
##   (15 observations deleted due to missingness)
## Multiple R-squared:  0.6111, Adjusted R-squared:  0.6109 
## F-statistic:  2206 on 1 and 1404 DF,  p-value: &lt; 0.00000000000000022</code></pre>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="R_analysis.html#cb306-1" tabindex="-1"></a><span class="fu">anova</span>(lm_model1)</span></code></pre></div>
<pre><code>## Analysis of Variance Table
## 
## Response: Life_Ladder
##                      Df  Sum Sq Mean Sq F value                Pr(&gt;F)    
## Log_GDP_per_capita    1 1086.07 1086.07  2206.5 &lt; 0.00000000000000022 ***
## Residuals          1404  691.07    0.49                                  
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1</code></pre>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="R_analysis.html#cb308-1" tabindex="-1"></a><span class="co"># options(scipen = 999) функция, которая отключает нотацию записи чисел через экспоненту</span></span></code></pre></div>
<p>В целом, мы можем уже начать интерпретировать результаты модели, но пока рановато – сначаоа нужно убедиться в равенстве дисперсий остатков, то есть выполнении допущения о <em>гомоскедастичности</em> (гомогенности) дисперсий. Это проще всего проверить, выведя первый из четырех график, которые выводятся, если передать линейную модель в базовую функцию plot()</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="R_analysis.html#cb309-1" tabindex="-1"></a><span class="fu">plot</span>(lm_model1, <span class="dv">1</span>)</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-82-1.png" width="672" /></p>
<p>Можем сделать график покрасивее через ggplot(). Для этого воспользуемся тем, что результат выполнения lm() – это список, в котором содержится много разныз данных, в том числе, и остатки модели, и предсказанные значения отдельно.</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="R_analysis.html#cb310-1" tabindex="-1"></a><span class="fu">head</span>(lm_model1<span class="sc">$</span>residuals) <span class="co">#head() выводит заголовок, первые элементы</span></span></code></pre></div>
<pre><code>##         1         2         3         4         5         6 
## 0.9974072 1.4818864 1.2677150 1.4125433 1.1663137 1.2430108</code></pre>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="R_analysis.html#cb312-1" tabindex="-1"></a><span class="fu">head</span>(lm_model1<span class="sc">$</span>fitted.values)</span></code></pre></div>
<pre><code>##        1        2        3        4        5        6 
## 6.560375 6.537048 6.566518 6.558349 6.517045 6.527505</code></pre>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="R_analysis.html#cb314-1" tabindex="-1"></a><span class="fu">ggplot</span>(lm_model1, <span class="fu">aes</span>(<span class="at">x =</span> lm_model1<span class="sc">$</span>fitted.values, <span class="at">y =</span> lm_model1<span class="sc">$</span>residuals)) <span class="sc">+</span></span>
<span id="cb314-2"><a href="R_analysis.html#cb314-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb314-3"><a href="R_analysis.html#cb314-3" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-84-1.png" width="672" />
Вспомним примеры диагностических графиков, которые мы разбирали в прошлом семестре Примеры диагностических графиков для остатков: <a href="https://gallery.shinyapps.io/slr_diag/" class="uri">https://gallery.shinyapps.io/slr_diag/</a> Хорошим счтается график, если при движении слева на право все точки распределены примерно равномерно. А вот есть у нас вылез веник, что с одной стороны данные скукожились в одну точку, а дальше пошли расходиться веником – это означает, что в данных наблюдается <em>гетероскедастичность</em>, они не однородны, и результаты такой модели будут не очень достоверны. В нашем случае графико выглядит хорошо и проходит проверку.</p>
<p>А теперь давайте возьмем антипример и посмотрим, что будет с распределением остатков.</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="R_analysis.html#cb315-1" tabindex="-1"></a>whr_tests_hw <span class="sc">%&gt;%</span> </span>
<span id="cb315-2"><a href="R_analysis.html#cb315-2" tabindex="-1"></a>  <span class="fu">lm</span>(Life_Ladder <span class="sc">~</span> Perceptions_of_corruption, .) <span class="ot">-&gt;</span> lm_model2_anti</span>
<span id="cb315-3"><a href="R_analysis.html#cb315-3" tabindex="-1"></a><span class="fu">plot</span>(lm_model2_anti, <span class="dv">1</span>)</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-85-1.png" width="672" /></p>
<p>Тут что-то пошло не так, поэтому опираться на такую модель мы бы не стали.</p>
<p>Следующее допущение – остатки должны быть нормально распределены. Да, мы не проверяем на нормальность распределения ЗП, но вот остатки нужно проверить – иначе мы не сможем провести линия с расчетом метода нименьших квадратов, то есть пытаясь приблизиться ко всем нашим точкам сразу. Проверим это допущения, выведя второй график стандартной функции plot()</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="R_analysis.html#cb316-1" tabindex="-1"></a><span class="fu">plot</span>(lm_model1, <span class="dv">2</span>)</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-86-1.png" width="672" />
Или, как мы уже строили красивые графики для проверки нормальнсти через ggplot</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="R_analysis.html#cb317-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> lm_model1, <span class="fu">aes</span>(<span class="at">x =</span> lm_model1<span class="sc">$</span>residuals)) <span class="sc">+</span></span>
<span id="cb317-2"><a href="R_analysis.html#cb317-2" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>) <span class="sc">+</span></span>
<span id="cb317-3"><a href="R_analysis.html#cb317-3" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-87-1.png" width="672" /></p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="R_analysis.html#cb318-1" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> lm_model1, <span class="fu">aes</span>(<span class="at">sample =</span> lm_model1<span class="sc">$</span>residuals)) <span class="sc">+</span></span>
<span id="cb318-2"><a href="R_analysis.html#cb318-2" tabindex="-1"></a>  <span class="fu">stat_qq</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>) <span class="sc">+</span></span>
<span id="cb318-3"><a href="R_analysis.html#cb318-3" tabindex="-1"></a>  <span class="fu">geom_qq_line</span>() <span class="sc">+</span></span>
<span id="cb318-4"><a href="R_analysis.html#cb318-4" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-87-2.png" width="672" /></p>
<p>И так, мы соблюли все допущения для модели с одним предиктором! У нас осталось только допущения отсутствия мультиколлинеарности, но оно не применимо на модели с одним предиктором.</p>
<p>Теперь давайте еще раз посмотрим на результаты модели и вспомним, <a href="stats_criteria_linear.html#linreg_example">как их интерпретировать</a>. Ключевое, что нас интересует – это <a href="stats_criteria_linear.html#linreg_coef">коэффициенты линейной регрессии</a>, <span class="math inline">\(b_0\)</span>, интерцепт, место пересечения регрессионной прямой с осью y, и <span class="math inline">\(b_1\)</span>, слоуп, угол наклона прямой – так как <a href="stats_criteria_linear.html#linreg_null">нулевая гипотеза для линейной регрессии</a> заключается в равенстве их нулю. Еще одна не менее важная штука – <span class="math inline">\(R^2\)</span>, <a href="stats_criteria_linear.html#rsquared">коэффициент детерминации и процент объясненной дисперсии</a>.</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="R_analysis.html#cb319-1" tabindex="-1"></a>lm_model1</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Life_Ladder ~ Log_GDP_per_capita, data = .)
## 
## Coefficients:
##        (Intercept)  Log_GDP_per_capita  
##            -1.4066              0.7421</code></pre>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="R_analysis.html#cb321-1" tabindex="-1"></a><span class="fu">summary</span>(lm_model1)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Life_Ladder ~ Log_GDP_per_capita, data = .)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2.26515 -0.47805 -0.04913  0.54993  2.01866 
## 
## Coefficients:
##                    Estimate Std. Error t value            Pr(&gt;|t|)    
## (Intercept)         -1.4066     0.1467  -9.587 &lt;0.0000000000000002 ***
## Log_GDP_per_capita   0.7421     0.0158  46.973 &lt;0.0000000000000002 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.7016 on 1404 degrees of freedom
##   (15 observations deleted due to missingness)
## Multiple R-squared:  0.6111, Adjusted R-squared:  0.6109 
## F-statistic:  2206 on 1 and 1404 DF,  p-value: &lt; 0.00000000000000022</code></pre>
<p>Как обычно, смотрим на p-value у каждого коэффициента (и еще можем посмотреть на p-value всей модели: тут та же итория, как и с ANOVA – вся модель значима, когда значим хотя бы один из коэффициентов, и не значима, когда все коэффициенты не отличаются статистически значимо от нуля). Если коэффициент значим, значит, мы можем сказать, что он значимо вкладывается в объяснение дисперсии. <span class="math inline">\(b_0\)</span>, интерцепт, значимо отличен от нуля, поэтому можем заявить, что наша прямая будет начинаться не в начале координат, а смещена на -1.4 по оси y. <span class="math inline">\(b_1\)</span> у Log_GDP_per_capita значимо отличен от нуля, пэтому наша прямая будет иметь наклон – а это значит, что с увеличением Log_GDP_per_capita на 1 зависимая переменная Life_Ladder будет увеличиваться на 0.74!</p>
<p>Чему равен <span class="math inline">\(R^2\)</span>? Он равен 0.61, что очень хороший результат. То есть, 61% изменчивости наших данных по уровню стастья Life_Ladder определяются уровнем покупапательской способнсти Log_GDP_per_capita!</p>
<p>Уравнение регрессионной прямой я теперь могу записать так:</p>
<p align="center">
<span class="math inline">\(\hat Life\_Ladder = -1.4 + 0.74 \times Log\_GDP\_per\_capita\)</span>
</p>
<p>Давайте теперь визуалзируем нашу регрессионную прямую</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="R_analysis.html#cb323-1" tabindex="-1"></a>whr_tests_hw <span class="sc">%&gt;%</span> </span>
<span id="cb323-2"><a href="R_analysis.html#cb323-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Log_GDP_per_capita, <span class="at">y =</span> Life_Ladder)) <span class="sc">+</span></span>
<span id="cb323-3"><a href="R_analysis.html#cb323-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;#355C7D&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb323-4"><a href="R_analysis.html#cb323-4" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&#39;lm&#39;</span>, <span class="at">color =</span> <span class="st">&quot;violet&quot;</span>) <span class="sc">+</span></span>
<span id="cb323-5"><a href="R_analysis.html#cb323-5" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 15 rows containing non-finite values (`stat_smooth()`).</code></pre>
<pre><code>## Warning: Removed 15 rows containing missing values (`geom_point()`).</code></pre>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-89-1.png" width="672" /></p>
<p>Красота!</p>
</div>
<div id="линейная-регрессия-с-несколькими-предикторами-факторами" class="section level3 hasAnchor" number="14.15.2">
<h3><span class="header-section-number">14.15.2</span> Линейная регрессия с несколькими предикторами (факторами)<a href="R_analysis.html#линейная-регрессия-с-несколькими-предикторами-факторами" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Все то же самое, но теперь возьмем в модель второй предиктор – Freedom_to_make_life_choices.</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="R_analysis.html#cb326-1" tabindex="-1"></a>whr_tests_hw <span class="sc">%&gt;%</span></span>
<span id="cb326-2"><a href="R_analysis.html#cb326-2" tabindex="-1"></a>  <span class="fu">lm</span>(Life_Ladder <span class="sc">~</span> Log_GDP_per_capita <span class="sc">+</span> Freedom_to_make_life_choices, .) <span class="ot">-&gt;</span> lm_model3_multy</span>
<span id="cb326-3"><a href="R_analysis.html#cb326-3" tabindex="-1"></a>lm_model3_multy</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Life_Ladder ~ Log_GDP_per_capita + Freedom_to_make_life_choices, 
##     data = .)
## 
## Coefficients:
##                  (Intercept)            Log_GDP_per_capita  
##                      -2.0948                        0.6478  
## Freedom_to_make_life_choices  
##                       2.1544</code></pre>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="R_analysis.html#cb328-1" tabindex="-1"></a><span class="fu">summary</span>(lm_model3_multy)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Life_Ladder ~ Log_GDP_per_capita + Freedom_to_make_life_choices, 
##     data = .)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2.50100 -0.43131  0.02093  0.44158  1.83176 
## 
## Coefficients:
##                              Estimate Std. Error t value            Pr(&gt;|t|)
## (Intercept)                  -2.09478    0.14063  -14.90 &lt;0.0000000000000002
## Log_GDP_per_capita            0.64781    0.01562   41.46 &lt;0.0000000000000002
## Freedom_to_make_life_choices  2.15438    0.12663   17.01 &lt;0.0000000000000002
##                                 
## (Intercept)                  ***
## Log_GDP_per_capita           ***
## Freedom_to_make_life_choices ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.6403 on 1375 degrees of freedom
##   (43 observations deleted due to missingness)
## Multiple R-squared:  0.6791, Adjusted R-squared:  0.6787 
## F-statistic:  1455 on 2 and 1375 DF,  p-value: &lt; 0.00000000000000022</code></pre>
<p>Проверка допущений</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="R_analysis.html#cb330-1" tabindex="-1"></a><span class="fu">plot</span>(lm_model3_multy, <span class="dv">1</span>)</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-91-1.png" width="672" /></p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="R_analysis.html#cb331-1" tabindex="-1"></a><span class="fu">plot</span>(lm_model3_multy, <span class="dv">2</span>)</span></code></pre></div>
<p><img src="StatsForDA_files/figure-html/unnamed-chunk-91-2.png" width="672" /></p>
<p>Теперь нужно проверить еще допущение об отсутствии мультиколлинеарности – что среди предикторов (НП) нет сильной корреляции друг с другом, иначе наша модель будет немного бессмысленна. Проверять будем с помощью функции vif(), коэффициента вздутия дисперсии. Показатели довольно условные, но считается, если значения больше 5 – то это очень сильная корреляция между переменными, и нужно удалить сильно коррелирующую переменную.</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="R_analysis.html#cb332-1" tabindex="-1"></a>car<span class="sc">::</span><span class="fu">vif</span>(lm_model3_multy)</span></code></pre></div>
<pre><code>##           Log_GDP_per_capita Freedom_to_make_life_choices 
##                     1.153419                     1.153419</code></pre>
<p>У нас показания vif довольно низкие, поэтому ничего не будем менять.</p>
<p>Далее можем проинтерпретировать результаты (все коэффициенты значимы) и записать уравнение регрессионной прямой.</p>
<p align="center">
<span class="math inline">\(\hat Life\_Ladder = -2.09 + 0.64 \times Log\_GDP\_per\_capita + 2.15 \times Freedom\_to\_make\_life\_choices\)</span>
</p>
</div>
</div>
<div id="tasks_sem7" class="section level2 hasAnchor" number="14.16">
<h2><span class="header-section-number">14.16</span> Задания после семинара 7<a href="R_analysis.html#tasks_sem7" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>Отберите переменные, подходящие для построения линейной регрессии, в данных <code>whr_tests_hw.csv</code></li>
<li>Постройте линейную регрессию на этих переменных, с одним фактором (НП)</li>
<li>Постройте линейную регрессию на этих переменных, но уже хотя бы с двумя факторами (НП)</li>
<li>Постройте диагностические графики для каждой модели: насколько равной получилась дисперсия остатков для этих моделей? Можно ли доверять результатом этих моделей?</li>
<li>Определеите, какая модель лучше объясняет данные (то есть вариативность ЗП)?</li>
<li>Запишите уравнение линейной регрессии для обеих моделей.</li>
</ol>
</div>
<div id="логистическая-регрессия" class="section level2 hasAnchor" number="14.17">
<h2><span class="header-section-number">14.17</span> Логистическая регрессия<a href="R_analysis.html#логистическая-регрессия" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Перейдем от линейной регрессии к <a href="stats_criteria_categ.html#logreg">логистической</a>. Сначала вспомним, что это за метод, и когда используется – он используется, когда ЗП не количественная, а категориальная, и, как правило, имеет две градации. Это самый классический случай логистической регрессии, хотя ЗП в ней может иметь и большее количество градаций, чем две – тогда это будет уже <em>мультиномиальная логистическая регрессия</em>. На лог регрессии построено все машинное обучение – задачи, в которых нужно определить, относится ли изображение к определенному шаблону (например, распознавание текста), является ли кредитный заемщик благонадежным для выдачи кредиты (скоринговые модели в банках) и тд используют именно этот метод.</p>
<p>Мы рассмотрим его на все том же примере наших данных с World Happiness Report. Они не очень подходят для этого метода, поэтому задача будет немного искусственной – попроуем предсказать, будет ли попадать страна в первую или вторую половину рейтнга по уровню счастья (мы создавали специальную переменную для этого). Сначала я перекодирую эту переменную в 1 и 0, так как лог регрессия работает с численными значениями 0 и 1.</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="R_analysis.html#cb334-1" tabindex="-1"></a>whr_tests_hw <span class="sc">%&gt;%</span></span>
<span id="cb334-2"><a href="R_analysis.html#cb334-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean_position_bi =</span> <span class="fu">ifelse</span>(mean_position <span class="sc">==</span> <span class="st">&quot;upper&quot;</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="ot">-&gt;</span> whr_tests_hw</span></code></pre></div>
<p>Сначала построим самую простую модель, в которую будет входить только интерцепт. Эта модель, по сути, аналог хи квадрата – не имея никаких предикторов оценить, попадет ли страна в первую или вторую половину рейтинга, чисто на основании частоты встречаемости стран из первой и второй половины? Конкретно в этом примере частоты будут примерно одинаковыми, но прицнип работы этой модели примерно такой.</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="R_analysis.html#cb335-1" tabindex="-1"></a><span class="fu">table</span>(whr_tests_hw<span class="sc">$</span>mean_position)</span></code></pre></div>
<pre><code>## 
## lower upper 
##    78    75</code></pre>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="R_analysis.html#cb337-1" tabindex="-1"></a>whr_tests_hw <span class="sc">%&gt;%</span></span>
<span id="cb337-2"><a href="R_analysis.html#cb337-2" tabindex="-1"></a>  <span class="fu">glm</span>(mean_position_bi <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> ., <span class="at">family =</span> binomial) <span class="ot">-&gt;</span> lm_model_log1</span>
<span id="cb337-3"><a href="R_analysis.html#cb337-3" tabindex="-1"></a><span class="fu">summary</span>(lm_model_log1)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = mean_position_bi ~ 1, family = binomial, data = .)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.161  -1.161  -1.161   1.194   1.194  
## 
## Coefficients:
##             Estimate Std. Error z value Pr(&gt;|z|)
## (Intercept) -0.03922    0.16172  -0.243    0.808
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 212.04  on 152  degrees of freedom
## Residual deviance: 212.04  on 152  degrees of freedom
##   (1268 observations deleted due to missingness)
## AIC: 214.04
## 
## Number of Fisher Scoring iterations: 3</code></pre>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="R_analysis.html#cb339-1" tabindex="-1"></a><span class="fu">log</span>(<span class="dv">75</span><span class="sc">/</span><span class="dv">78</span>)</span></code></pre></div>
<pre><code>## [1] -0.03922071</code></pre>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="R_analysis.html#cb341-1" tabindex="-1"></a><span class="co"># log(p/1-p) = intercept</span></span></code></pre></div>
<p>Усложним модель и добавим в нее ВВП на душу населения в качестве предиктора</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="R_analysis.html#cb342-1" tabindex="-1"></a>whr_tests_hw <span class="sc">%&gt;%</span></span>
<span id="cb342-2"><a href="R_analysis.html#cb342-2" tabindex="-1"></a>  <span class="fu">glm</span>(mean_position_bi <span class="sc">~</span> Log_GDP_per_capita, ., <span class="at">family =</span> binomial) <span class="ot">-&gt;</span> lm_model_log2</span>
<span id="cb342-3"><a href="R_analysis.html#cb342-3" tabindex="-1"></a><span class="fu">summary</span>(lm_model_log2)</span></code></pre></div>
<pre><code>## 
## Call:
## glm(formula = mean_position_bi ~ Log_GDP_per_capita, family = binomial, 
##     data = .)
## 
## Deviance Residuals: 
##     Min       1Q   Median       3Q      Max  
## -1.9946  -0.4687  -0.0601   0.5165   2.1031  
## 
## Coefficients:
##                    Estimate Std. Error z value       Pr(&gt;|z|)    
## (Intercept)        -21.8266     3.5703  -6.113 0.000000000976 ***
## Log_GDP_per_capita   2.3186     0.3758   6.169 0.000000000685 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 207.84  on 149  degrees of freedom
## Residual deviance: 109.90  on 148  degrees of freedom
##   (1271 observations deleted due to missingness)
## AIC: 113.9
## 
## Number of Fisher Scoring iterations: 6</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="cluster_analysis.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["StatsForDA.pdf", "StatsForDA.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
